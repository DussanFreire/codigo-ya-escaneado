√A
ÄD:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Controllers\AuthController.cs
	namespace 	
BackEndAlbergue
 
. 
Controllers %
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
AuthController 
:  !
ControllerBase" 0
{ 
private 
IUserService 
userService (
;( )
public 
AuthController 
( 
IUserService *
userService+ 6
)6 7
{ 	
this 
. 
userService 
= 
userService *
;* +
} 	
[ 	
HttpPost	 
( 
$str 
) 
] 
public 
async 
Task 
< 
IActionResult '
>' (
RegisterAsync) 6
(6 7
[7 8
FromBody8 @
]@ A
RegisterViewModelB S
modelT Y
)Y Z
{ 	
if 
( 

ModelState 
. 
IsValid "
)" #
{   
var!! 
result!! 
=!! 
await!! "
userService!!# .
.!!. /
RegisterUserAsync!!/ @
(!!@ A
model!!A F
)!!F G
;!!G H
if## 
(## 
result## 
.## 
	IsSuccess## $
)##$ %
return$$ 
Ok$$ 
($$ 
result$$ $
)$$$ %
;$$% &
return&& 

BadRequest&& !
(&&! "
result&&" (
)&&( )
;&&) *
}'' 
return)) 

BadRequest)) 
()) 
$str)) =
)))= >
;))> ?
}** 	
[00 	
HttpPost00	 
(00 
$str00 
)00 
]00 
public11 
async11 
Task11 
<11 
IActionResult11 '
>11' (
CreateRolenAsync11) 9
(119 :
[11: ;
FromBody11; C
]11C D
CreateRoleViewModel11E X
model11Y ^
)11^ _
{22 	
if33 
(33 

ModelState33 
.33 
IsValid33 "
)33" #
{44 
var55 
result55 
=55 
await55 "
userService55# .
.55. /
CreateRoleAsync55/ >
(55> ?
model55? D
)55D E
;55E F
if77 
(77 
result77 
.77 
	IsSuccess77 $
)77$ %
{88 
return99 
Ok99 
(99 
result99 $
)99$ %
;99% &
}:: 
return<< 

BadRequest<< !
(<<! "
result<<" (
)<<( )
;<<) *
}== 
return>> 

BadRequest>> 
(>> 
$str>> =
)>>= >
;>>> ?
}?? 	
[EE 	
HttpPostEE	 
(EE 
$strEE 
)EE 
]EE 
publicFF 
asyncFF 
TaskFF 
<FF 
IActionResultFF '
>FF' ( 
CreateUserRolenAsyncFF) =
(FF= >
[FF> ?
FromBodyFF? G
]FFG H#
CreateUserRoleViewModelFFI `
modelFFa f
)FFf g
{GG 	
ifHH 
(HH 

ModelStateHH 
.HH 
IsValidHH "
)HH" #
{II 
varJJ 
resultJJ 
=JJ 
awaitJJ "
userServiceJJ# .
.JJ. /
CreateUserRoleAsyncJJ/ B
(JJB C
modelJJC H
)JJH I
;JJI J
ifLL 
(LL 
resultLL 
.LL 
	IsSuccessLL $
)LL$ %
{MM 
returnNN 
OkNN 
(NN 
resultNN $
)NN$ %
;NN% &
}OO 
returnQQ 

BadRequestQQ !
(QQ! "
resultQQ" (
)QQ( )
;QQ) *
}RR 
returnSS 

BadRequestSS 
(SS 
$strSS =
)SS= >
;SS> ?
}TT 	
[ZZ 	
HttpPostZZ	 
(ZZ 
$strZZ 
)ZZ 
]ZZ 
public[[ 
async[[ 
Task[[ 
<[[ 
IActionResult[[ '
>[[' (

LoginAsync[[) 3
([[3 4
[[[4 5
FromBody[[5 =
][[= >

LoginModel[[? I
model[[J O
)[[O P
{\\ 	
if]] 
(]] 

ModelState]] 
.]] 
IsValid]] "
)]]" #
{^^ 
var__ 
result__ 
=__ 
await__ "
userService__# .
.__. /
LoginUserAsync__/ =
(__= >
model__> C
)__C D
;__D E
ifaa 
(aa 
resultaa 
.aa 
	IsSuccessaa $
)aa$ %
{bb 
returncc 
Okcc 
(cc 
resultcc $
)cc$ %
;cc% &
}dd 
returnff 

BadRequestff !
(ff! "
resultff" (
)ff( )
;ff) *
}gg 
returnii 

BadRequestii 
(ii 
$strii =
)ii= >
;ii> ?
}jj 	
[pp 	
HttpGetpp	 
]pp 
publicqq 
ActionResultqq 
<qq 
IEnumerableqq '
<qq' (
	UserModelqq( 1
>qq1 2
>qq2 3
GetUsersAsyncqq4 A
(qqA B
)qqB C
{rr 	
tryss 
{tt 
returnuu 
Okuu 
(uu 
userServiceuu &
.uu& '
GetUsersAsyncuu' 4
(uu4 5
)uu5 6
)uu6 7
;uu7 8
}vv 
catchww 
(ww 
BadRequestExceptionww &
exww' )
)ww) *
{xx 
returnyy 

BadRequestyy !
(yy! "
exyy" $
)yy$ %
;yy% &
}zz 
catch{{ 
({{ 
	Exception{{ 
ex{{ 
){{  
{|| 
return~~ 

StatusCode~~ !
(~~! "
StatusCodes~~" -
.~~- .(
Status500InternalServerError~~. J
,~~J K
$"~~L N
$str~~N a
{~~a b
ex~~b d
.~~d e
Message~~e l
}~~l m
"~~m n
)~~n o
;~~o p
} 
}
ÄÄ 	
[
ÜÜ 	
HttpPut
ÜÜ	 
(
ÜÜ 
$str
ÜÜ 
)
ÜÜ 
]
ÜÜ 
public
áá 
async
áá 
Task
áá 
<
áá 
ActionResult
áá &
<
áá& '
bool
áá' +
>
áá+ ,
>
áá, -
UpdatePassword
áá. <
(
áá< =
[
áá= >
FromBody
áá> F
]
ááF G
RegisterViewModel
ááH Y
model
ááZ _
)
áá_ `
{
àà 	
try
ââ 
{
ää 
return
ãã 
Ok
ãã 
(
ãã 
await
ãã 
userService
ãã  +
.
ãã+ ,
UpdateUserAsync
ãã, ;
(
ãã; <
model
ãã< A
)
ããA B
)
ããB C
;
ããC D
}
åå 
catch
çç 
(
çç !
BadRequestException
çç &
ex
çç' )
)
çç) *
{
éé 
return
èè 

BadRequest
èè !
(
èè! "
ex
èè" $
)
èè$ %
;
èè% &
}
êê 
catch
ëë 
(
ëë 
	Exception
ëë 
ex
ëë 
)
ëë  
{
íí 
return
îî 

StatusCode
îî !
(
îî! "
StatusCodes
îî" -
.
îî- .*
Status500InternalServerError
îî. J
,
îîJ K
$"
îîL N
$str
îîN a
{
îîa b
ex
îîb d
.
îîd e
Message
îîe l
}
îîl m
"
îîm n
)
îîn o
;
îîo p
}
ïï 
}
óó 	
}
òò 
}ôô ¸X
ÇD:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Controllers\NoticeController.cs
	namespace 	
BackEndAlbergue
 
. 
Controllers %
{ 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
NoticeController !
:" #
ControllerBase$ 2
{ 
private 
INoticeService 
_noticeService -
;- .
private 
readonly 
IWebHostEnvironment ,
_webHostEnvironment- @
;@ A
public 
NoticeController 
(  
INoticeService  .
noticeService/ <
,< =
IWebHostEnvironment> Q
hostEnvironmentR a
)a b
{ 	
_noticeService 
= 
noticeService *
;* +
_webHostEnvironment 
=  !
hostEnvironment" 1
;1 2
} 	
[ 	
HttpGet	 
] 
public 
ActionResult 
< 
IEnumerable '
<' (
NoticeModel( 3
>3 4
>4 5

GetNotices6 @
(@ A
)A B
{   	
try!! 
{"" 
return## 
Ok## 
(## 
_noticeService## (
.##( )

GetNotices##) 3
(##3 4
)##4 5
)##5 6
;##6 7
}$$ 
catch%% 
(%% 
BadRequestException%% &
ex%%' )
)%%) *
{&& 
return'' 

BadRequest'' !
(''! "
ex''" $
)''$ %
;''% &
}(( 
catch)) 
()) 
	Exception)) 
ex)) 
)))  
{** 
return,, 

StatusCode,, !
(,,! "
StatusCodes,," -
.,,- .(
Status500InternalServerError,,. J
,,,J K
$",,L N
$str,,N a
{,,a b
ex,,b d
.,,d e
Message,,e l
},,l m
",,m n
),,n o
;,,o p
}-- 
}// 	
[55 	
	Authorize55	 
(55 
Roles55 
=55 
$str55 "
)55" #
]55# $
[66 	
HttpPost66	 
]66 
public77 
ActionResult77 
<77 
NoticeModel77 '
>77' (
CreateNotice77) 5
(775 6
[776 7
FromBody777 ?
]77? @
NoticeModel77A L
noticeModel77M X
)77X Y
{88 	
try99 
{:: 
if;; 
(;; 
!;; 

ModelState;; 
.;;  
IsValid;;  '
);;' (
{<< 
return== 

BadRequest== %
(==% &
noticeModel==& 1
)==1 2
;==2 3
}>> 
var?? 
url?? 
=?? 
HttpContext?? %
.??% &
Request??& -
.??- .
Host??. 2
;??2 3
return@@ 
Ok@@ 
(@@ 
_noticeService@@ (
.@@( )
CreateNotice@@) 5
(@@5 6
noticeModel@@6 A
)@@A B
)@@B C
;@@C D
}AA 
catchBB 
(BB 
	ExceptionBB 
exBB 
)BB  
{CC 
returnDD 

StatusCodeDD !
(DD! "
StatusCodesDD" -
.DD- .(
Status500InternalServerErrorDD. J
,DDJ K
$"DDL N
$strDDN a
{DDa b
exDDb d
.DDd e
MessageDDe l
}DDl m
"DDm n
)DDn o
;DDo p
}EE 
}FF 	
[LL 	
	AuthorizeLL	 
(LL 
RolesLL 
=LL 
$strLL "
)LL" #
]LL# $
[MM 	

HttpDeleteMM	 
(MM 
$strMM $
)MM$ %
]MM% &
publicNN 
ActionResultNN 
<NN 
boolNN  
>NN  !
DeleteNoticeNN" .
(NN. /
intNN/ 2
noticeIdNN3 ;
)NN; <
{OO 	
tryPP 
{QQ 
returnRR 
OkRR 
(RR 
_noticeServiceRR (
.RR( )
DeleteNoticeRR) 5
(RR5 6
noticeIdRR6 >
)RR> ?
)RR? @
;RR@ A
}SS 
catchTT 
(TT 
NotFoundExceptionTT $
exTT% '
)TT' (
{UU 
returnWW 
NotFoundWW 
(WW  
exWW  "
.WW" #
MessageWW# *
)WW* +
;WW+ ,
}XX 
catchYY 
(YY 
	ExceptionYY 
exYY 
)YY  
{ZZ 
return\\ 

StatusCode\\ !
(\\! "
StatusCodes\\" -
.\\- .(
Status500InternalServerError\\. J
,\\J K
$"\\L N
$str\\N a
{\\a b
ex\\b d
.\\d e
Message\\e l
}\\l m
"\\m n
)\\n o
;\\o p
}]] 
}^^ 	
[ee 	
	Authorizeee	 
(ee 
Rolesee 
=ee 
$stree "
)ee" #
]ee# $
[ff 	
HttpPutff	 
(ff 
$strff !
)ff! "
]ff" #
publicgg 
ActionResultgg 
<gg 
NoticeModelgg '
>gg' (
UpdateNoticegg) 5
(gg5 6
intgg6 9
noticeIdgg: B
,ggB C
[ggD E
FromBodyggE M
]ggM N
NoticeModelggO Z
noticeModelgg[ f
)ggf g
{hh 	
tryii 
{jj 
returnkk 
Okkk 
(kk 
_noticeServicekk (
.kk( )
UpdateNoticekk) 5
(kk5 6
noticeIdkk6 >
,kk> ?
noticeModelkk@ K
)kkK L
)kkL M
;kkM N
}ll 
catchnn 
(nn 
NotFoundExceptionnn $
exnn% '
)nn' (
{oo 
returnqq 
NotFoundqq 
(qq  
exqq  "
.qq" #
Messageqq# *
)qq* +
;qq+ ,
}rr 
catchss 
(ss 
	Exceptionss 
exss 
)ss  
{tt 
returnvv 

StatusCodevv !
(vv! "
StatusCodesvv" -
.vv- .(
Status500InternalServerErrorvv. J
,vvJ K
$"vvL N
$strvvN a
{vva b
exvvb d
.vvd e
Messagevve l
}vvl m
"vvm n
)vvn o
;vvo p
}ww 
}xx 	
[~~ 	
HttpPost~~	 
(~~ 
$str~~ 
)~~ 
]~~ 
public 
ActionResult 
< 
string "
>" #
photo$ )
() *
[* +
FromForm+ 3
]3 4
	IFormFile5 >
photo? D
)D E
{
ÄÄ 	
string
ÅÅ 
uniqueFileName
ÅÅ !
=
ÅÅ" #
null
ÅÅ$ (
;
ÅÅ( )
string
ÇÇ 
filePath
ÇÇ 
=
ÇÇ 
$str
ÇÇ  
;
ÇÇ  !
if
ÉÉ 
(
ÉÉ 
photo
ÉÉ 
!=
ÉÉ 
null
ÉÉ 
)
ÉÉ 
{
ÑÑ 
string
ÖÖ 
images_path
ÖÖ "
=
ÖÖ# $!
_webHostEnvironment
ÖÖ% 8
.
ÖÖ8 9
ContentRootPath
ÖÖ9 H
;
ÖÖH I
images_path
ÜÜ 
=
ÜÜ 
images_path
ÜÜ )
.
ÜÜ) *
	Substring
ÜÜ* 3
(
ÜÜ3 4
$num
ÜÜ4 5
,
ÜÜ5 6
images_path
ÜÜ7 B
.
ÜÜB C
Length
ÜÜC I
-
ÜÜJ K
$num
ÜÜL N
)
ÜÜN O
;
ÜÜO P
string
áá 
uploadsFolder
áá $
=
áá% &
Path
áá' +
.
áá+ ,
Combine
áá, 3
(
áá3 4
images_path
áá4 ?
,
áá? @
$"
ááA C
$str
ááC c
"
áác d
)
áád e
;
ááe f
uniqueFileName
àà 
=
àà  
Guid
àà! %
.
àà% &
NewGuid
àà& -
(
àà- .
)
àà. /
.
àà/ 0
ToString
àà0 8
(
àà8 9
)
àà9 :
+
àà; <
$str
àà= @
+
ààA B
photo
ààC H
.
ààH I
FileName
ààI Q
;
ààQ R
filePath
ââ 
=
ââ 
Path
ââ 
.
ââ  
Combine
ââ  '
(
ââ' (
uploadsFolder
ââ( 5
,
ââ5 6
uniqueFileName
ââ7 E
)
ââE F
;
ââF G
using
ää 
(
ää 
var
ää 

fileStream
ää %
=
ää& '
new
ää( +

FileStream
ää, 6
(
ää6 7
filePath
ää7 ?
,
ää? @
FileMode
ääA I
.
ääI J
Create
ääJ P
)
ääP Q
)
ääQ R
{
ãã 
photo
åå 
.
åå 
CopyTo
åå  
(
åå  !

fileStream
åå! +
)
åå+ ,
;
åå, -
}
çç 
}
éé 
return
õõ 
Ok
õõ 
(
õõ 
uniqueFileName
õõ $
)
õõ$ %
;
õõ% &
}
úú 	
[
¢¢ 	
HttpPost
¢¢	 
(
¢¢ 
$str
¢¢ 
)
¢¢  
]
¢¢  !
public
££ 
ActionResult
££ 
<
££ 
string
££ "
>
££" #
photoDelete
££$ /
(
££/ 0
[
££0 1
FromForm
££1 9
]
££9 :
string
££; A

photo_name
££B L
)
££L M
{
§§ 	
if
•• 
(
•• 

photo_name
•• 
!=
•• 
null
•• "
)
••" #
{
¶¶ 
string
ßß 
images_path
ßß "
=
ßß# $!
_webHostEnvironment
ßß% 8
.
ßß8 9
ContentRootPath
ßß9 H
;
ßßH I
images_path
®® 
=
®® 
images_path
®® )
.
®®) *
	Substring
®®* 3
(
®®3 4
$num
®®4 5
,
®®5 6
images_path
®®7 B
.
®®B C
Length
®®C I
-
®®J K
$num
®®L N
)
®®N O
;
®®O P
string
©© 
uploadsFolder
©© $
=
©©% &
Path
©©' +
.
©©+ ,
Combine
©©, 3
(
©©3 4
images_path
©©4 ?
,
©©? @
$"
©©A C
$str
©©C c
"
©©c d
)
©©d e
;
©©e f
var
™™ 
filePath
™™ 
=
™™ 
Path
™™ #
.
™™# $
Combine
™™$ +
(
™™+ ,
uploadsFolder
™™, 9
,
™™9 :

photo_name
™™; E
)
™™E F
;
™™F G
System
ÆÆ 
.
ÆÆ 
IO
ÆÆ 
.
ÆÆ 
File
ÆÆ 
.
ÆÆ 
Delete
ÆÆ %
(
ÆÆ% &
filePath
ÆÆ& .
)
ÆÆ. /
;
ÆÆ/ 0
}
ØØ 
return
∞∞ 
Ok
∞∞ 
(
∞∞ 
true
∞∞ 
)
∞∞ 
;
∞∞ 
}
±± 	
}
≤≤ 
}≥≥ ºm
D:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Controllers\PetController.cs
	namespace 	
BackEndAlbergue
 
. 
Controllers %
{ 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
PetController 
:  
ControllerBase! /
{ 
private 
IPetServices 
_petService (
;( )
private 
readonly 
IWebHostEnvironment ,
_webHostEnvironment- @
;@ A
public 
PetController 
( 
IPetServices )

petService* 4
,4 5
IWebHostEnvironment6 I
hostEnvironmentJ Y
)Y Z
{ 	
_petService 
= 

petService $
;$ %
_webHostEnvironment 
=  !
hostEnvironment" 1
;1 2
} 	
[ 	
HttpGet	 
] 
public   
ActionResult   
<   
IEnumerable   '
<  ' (
PetModel  ( 0
>  0 1
>  1 2
GetPets  3 :
(  : ;
)  ; <
{!! 	
try"" 
{## 
return$$ 
Ok$$ 
($$ 
_petService$$ %
.$$% &
GetPets$$& -
($$- .
)$$. /
)$$/ 0
;$$0 1
}%% 
catch&& 
(&& 
BadRequestException&& &
ex&&' )
)&&) *
{'' 
return(( 

BadRequest(( !
(((! "
ex((" $
)(($ %
;((% &
})) 
catch** 
(** 
	Exception** 
ex** 
)**  
{++ 
return-- 

StatusCode-- !
(--! "
StatusCodes--" -
.--- .(
Status500InternalServerError--. J
,--J K
$"--L N
$str--N a
{--a b
ex--b d
.--d e
Message--e l
}--l m
"--m n
)--n o
;--o p
}.. 
}00 	
[66 	
HttpGet66	 
(66 
$str66 
,66 
Name66  $
=66% &
$str66' /
)66/ 0
]660 1
public77 
ActionResult77 
<77 
PetModel77 $
>77$ %
GetPet77& ,
(77, -
int77- 0
petId771 6
)776 7
{88 	
try99 
{:: 
return;; 
Ok;; 
(;; 
_petService;; %
.;;% &
GetPet;;& ,
(;;, -
petId;;- 2
);;2 3
);;3 4
;;;4 5
}<< 
catch== 
(== 
NotFoundException== $
ex==% '
)==' (
{>> 
return?? 
NotFound?? 
(??  
ex??  "
.??" #
Message??# *
)??* +
;??+ ,
}@@ 
catchAA 
(AA 
	ExceptionAA 
exAA 
)AA  
{BB 
returnDD 

StatusCodeDD !
(DD! "
StatusCodesDD" -
.DD- .(
Status500InternalServerErrorDD. J
,DDJ K
$"DDL N
$strDDN a
{DDa b
exDDb d
.DDd e
MessageDDe l
}DDl m
"DDm n
)DDn o
;DDo p
}EE 
}FF 	
[LL 	
	AuthorizeLL	 
(LL 
RolesLL 
=LL 
$strLL "
)LL" #
]LL# $
[MM 	
HttpPostMM	 
]MM 
publicNN 
ActionResultNN 
<NN 
PetModelNN $
>NN$ %
	CreatePetNN& /
(NN/ 0
[NN0 1
FromBodyNN1 9
]NN9 :
PetModelNN; C
petModelNND L
)NNL M
{OO 	
tryPP 
{QQ 
ifRR 
(RR 
!RR 

ModelStateRR 
.RR  
IsValidRR  '
)RR' (
{SS 
returnTT 

BadRequestTT %
(TT% &
petModelTT& .
)TT. /
;TT/ 0
}UU 
varVV 
urlVV 
=VV 
HttpContextVV %
.VV% &
RequestVV& -
.VV- .
HostVV. 2
;VV2 3
varWW 

createdPetWW 
=WW  
_petServiceWW! ,
.WW, -
	CreatePetWW- 6
(WW6 7
petModelWW7 ?
)WW? @
;WW@ A
returnXX 
CreatedAtRouteXX %
(XX% &
$strXX& .
,XX. /
newXX0 3
{XX4 5
petIdXX6 ;
=XX< =

createdPetXX> H
.XXH I
IdXXI K
}XXL M
,XXM N

createdPetXXO Y
)XXY Z
;XXZ [
}YY 
catchZZ 
(ZZ 
	ExceptionZZ 
exZZ 
)ZZ  
{[[ 
return\\ 

StatusCode\\ !
(\\! "
StatusCodes\\" -
.\\- .(
Status500InternalServerError\\. J
,\\J K
$"\\L N
$str\\N a
{\\a b
ex\\b d
.\\d e
Message\\e l
}\\l m
"\\m n
)\\n o
;\\o p
}]] 
}^^ 	
[dd 	
	Authorizedd	 
(dd 
Rolesdd 
=dd 
$strdd "
)dd" #
]dd# $
[ee 	

HttpDeleteee	 
(ee 
$stree !
)ee! "
]ee" #
publicff 
ActionResultff 
<ff 
boolff  
>ff  !
	DeletePetff" +
(ff+ ,
intff, /
petIdff0 5
)ff5 6
{gg 	
tryhh 
{ii 
returnjj 
Okjj 
(jj 
_petServicejj %
.jj% &
	DeletePetjj& /
(jj/ 0
petIdjj0 5
)jj5 6
)jj6 7
;jj7 8
}kk 
catchll 
(ll 
NotFoundExceptionll $
exll% '
)ll' (
{mm 
returnoo 
NotFoundoo 
(oo  
exoo  "
.oo" #
Messageoo# *
)oo* +
;oo+ ,
}pp 
catchqq 
(qq 
	Exceptionqq 
exqq 
)qq  
{rr 
returntt 

StatusCodett !
(tt! "
StatusCodestt" -
.tt- .(
Status500InternalServerErrortt. J
,ttJ K
$"ttL N
$strttN a
{tta b
exttb d
.ttd e
Messagette l
}ttl m
"ttm n
)ttn o
;tto p
}uu 
}vv 	
[}} 	
	Authorize}}	 
(}} 
Roles}} 
=}} 
$str}} "
)}}" #
]}}# $
[~~ 	
HttpPut~~	 
(~~ 
$str~~ 
)~~ 
]~~  
public 
ActionResult 
< 
PetModelImpostor ,
>, -
	UpdatePet. 7
(7 8
int8 ;
petId< A
,A B
[C D
FromBodyD L
]L M
PetModelN V
petModelW _
)_ `
{
ÄÄ 	
try
ÅÅ 
{
ÇÇ 
if
ÉÉ 
(
ÉÉ 
!
ÉÉ 

ModelState
ÉÉ 
.
ÉÉ  
IsValid
ÉÉ  '
)
ÉÉ' (
{
ÑÑ 
foreach
ÖÖ 
(
ÖÖ 
var
ÖÖ  
pair
ÖÖ! %
in
ÖÖ& (

ModelState
ÖÖ) 3
)
ÖÖ3 4
{
ÜÜ 
if
áá 
(
áá 
pair
áá  
.
áá  !
Key
áá! $
==
áá% '
nameof
áá( .
(
áá. /
petModel
áá/ 7
.
áá7 8
Description
áá8 C
)
ááC D
&&
ááE G
pair
ááH L
.
ááL M
Value
ááM R
.
ááR S
Errors
ááS Y
.
ááY Z
Count
ááZ _
>
áá` a
$num
ááb c
)
áác d
{
àà 
return
ââ "

BadRequest
ââ# -
(
ââ- .
pair
ââ. 2
.
ââ2 3
Value
ââ3 8
.
ââ8 9
Errors
ââ9 ?
)
ââ? @
;
ââ@ A
}
ää 
}
ãã 
}
åå 
return
çç 
_petService
çç "
.
çç" #
	UpdatePet
çç# ,
(
çç, -
petId
çç- 2
,
çç2 3
petModel
çç4 <
)
çç< =
;
çç= >
}
éé 
catch
êê 
(
êê 
NotFoundException
êê $
ex
êê% '
)
êê' (
{
ëë 
return
ìì 
NotFound
ìì 
(
ìì  
ex
ìì  "
.
ìì" #
Message
ìì# *
)
ìì* +
;
ìì+ ,
}
îî 
catch
ïï 
(
ïï 
	Exception
ïï 
ex
ïï 
)
ïï  
{
ññ 
return
òò 

StatusCode
òò !
(
òò! "
StatusCodes
òò" -
.
òò- .*
Status500InternalServerError
òò. J
,
òòJ K
$"
òòL N
$str
òòN a
{
òòa b
ex
òòb d
.
òòd e
Message
òòe l
}
òòl m
"
òòm n
)
òòn o
;
òòo p
}
ôô 
}
öö 	
[
†† 	
HttpPost
††	 
(
†† 
$str
†† 
)
†† 
]
†† 
public
°° 
ActionResult
°° 
<
°° 
string
°° "
>
°°" #
photo
°°$ )
(
°°) *
[
°°* +
FromForm
°°+ 3
]
°°3 4
	IFormFile
°°5 >
photo
°°? D
)
°°D E
{
¢¢ 	
string
££ 
uniqueFileName
££ !
=
££" #
null
££$ (
;
££( )
string
§§ 
filePath
§§ 
=
§§ 
$str
§§  
;
§§  !
if
•• 
(
•• 
photo
•• 
!=
•• 
null
•• 
)
•• 
{
¶¶ 
string
ßß 
images_path
ßß "
=
ßß# $!
_webHostEnvironment
ßß% 8
.
ßß8 9
ContentRootPath
ßß9 H
;
ßßH I
images_path
®® 
=
®® 
images_path
®® )
.
®®) *
	Substring
®®* 3
(
®®3 4
$num
®®4 5
,
®®5 6
images_path
®®7 B
.
®®B C
Length
®®C I
-
®®J K
$num
®®L N
)
®®N O
;
®®O P
string
©© 
uploadsFolder
©© $
=
©©% &
Path
©©' +
.
©©+ ,
Combine
©©, 3
(
©©3 4
images_path
©©4 ?
,
©©? @
$"
©©A C
$str
©©C `
"
©©` a
)
©©a b
;
©©b c
uniqueFileName
™™ 
=
™™  
Guid
™™! %
.
™™% &
NewGuid
™™& -
(
™™- .
)
™™. /
.
™™/ 0
ToString
™™0 8
(
™™8 9
)
™™9 :
+
™™; <
$str
™™= @
+
™™A B
photo
™™C H
.
™™H I
FileName
™™I Q
;
™™Q R
filePath
´´ 
=
´´ 
Path
´´ 
.
´´  
Combine
´´  '
(
´´' (
uploadsFolder
´´( 5
,
´´5 6
uniqueFileName
´´7 E
)
´´E F
;
´´F G
using
¨¨ 
(
¨¨ 
var
¨¨ 

fileStream
¨¨ %
=
¨¨& '
new
¨¨( +

FileStream
¨¨, 6
(
¨¨6 7
filePath
¨¨7 ?
,
¨¨? @
FileMode
¨¨A I
.
¨¨I J
Create
¨¨J P
)
¨¨P Q
)
¨¨Q R
{
≠≠ 
photo
ÆÆ 
.
ÆÆ 
CopyTo
ÆÆ  
(
ÆÆ  !

fileStream
ÆÆ! +
)
ÆÆ+ ,
;
ÆÆ, -
}
ØØ 
}
∞∞ 
return
ΩΩ 
Ok
ΩΩ 
(
ΩΩ 
uniqueFileName
ΩΩ $
)
ΩΩ$ %
;
ΩΩ% &
}
ææ 	
[
«« 	
HttpPost
««	 
(
«« 
$str
«« 
)
««  
]
««  !
public
»» 
ActionResult
»» 
<
»» 
string
»» "
>
»»" #
photoDelete
»»$ /
(
»»/ 0
[
»»0 1
FromForm
»»1 9
]
»»9 :
string
»»; A

photo_name
»»B L
)
»»L M
{
…… 	
if
   
(
   

photo_name
   
!=
   
null
   "
)
  " #
{
ÀÀ 
string
ÃÃ 
images_path
ÃÃ "
=
ÃÃ# $!
_webHostEnvironment
ÃÃ% 8
.
ÃÃ8 9
ContentRootPath
ÃÃ9 H
;
ÃÃH I
images_path
ÕÕ 
=
ÕÕ 
images_path
ÕÕ )
.
ÕÕ) *
	Substring
ÕÕ* 3
(
ÕÕ3 4
$num
ÕÕ4 5
,
ÕÕ5 6
images_path
ÕÕ7 B
.
ÕÕB C
Length
ÕÕC I
-
ÕÕJ K
$num
ÕÕL N
)
ÕÕN O
;
ÕÕO P
string
ŒŒ 
uploadsFolder
ŒŒ $
=
ŒŒ% &
Path
ŒŒ' +
.
ŒŒ+ ,
Combine
ŒŒ, 3
(
ŒŒ3 4
images_path
ŒŒ4 ?
,
ŒŒ? @
$"
ŒŒA C
$str
ŒŒC `
"
ŒŒ` a
)
ŒŒa b
;
ŒŒb c
var
œœ 
filePath
œœ 
=
œœ 
Path
œœ #
.
œœ# $
Combine
œœ$ +
(
œœ+ ,
uploadsFolder
œœ, 9
,
œœ9 :

photo_name
œœ; E
)
œœE F
;
œœF G
System
”” 
.
”” 
IO
”” 
.
”” 
File
”” 
.
”” 
Delete
”” %
(
””% &
filePath
””& .
)
””. /
;
””/ 0
}
‘‘ 
return
’’ 
Ok
’’ 
(
’’ 
true
’’ 
)
’’ 
;
’’ 
}
÷÷ 	
}
◊◊ 
}ÿÿ Ìe
ÉD:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Controllers\ProductController.cs
	namespace 	
BackEndAlbergue
 
. 
Controllers %
{ 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
ProductController "
:# $
ControllerBase% 3
{ 
private 
IProductService 
_petShopService  /
;/ 0
private 
readonly 
IWebHostEnvironment ,
_webHostEnvironment- @
;@ A
public 
ProductController  
(  !
IProductService! 0
petShopService1 ?
,? @
IWebHostEnvironmentA T
hostEnvironmentU d
)d e
{ 	
_petShopService 
= 
petShopService ,
;, -
_webHostEnvironment 
=  !
hostEnvironment" 1
;1 2
} 	
[ 	
HttpGet	 
] 
public 
ActionResult 
< 
IEnumerable '
<' (
ProductModel( 4
>4 5
>5 6

GetPetShop7 A
(A B
)B C
{   	
try!! 
{"" 
return## 
Ok## 
(## 
_petShopService## )
.##) *
GetProducts##* 5
(##5 6
)##6 7
)##7 8
;##8 9
}$$ 
catch%% 
(%% 
BadRequestException%% &
ex%%' )
)%%) *
{&& 
return'' 

BadRequest'' !
(''! "
ex''" $
)''$ %
;''% &
}(( 
catch)) 
()) 
	Exception)) 
ex)) 
)))  
{** 
return,, 

StatusCode,, !
(,,! "
StatusCodes,," -
.,,- .(
Status500InternalServerError,,. J
,,,J K
$",,L N
$str,,N a
{,,a b
ex,,b d
.,,d e
Message,,e l
},,l m
",,m n
),,n o
;,,o p
}-- 
}// 	
[55 	
HttpGet55	 
(55 
$str55 &
,55& '
Name55( ,
=55- .
$str55/ ?
)55? @
]55@ A
public66 
ActionResult66 
<66 
PetModel66 $
>66$ % 
GetSinglePetShopItem66& :
(66: ;
int66; >
itemPetShopId66? L
)66L M
{77 	
try88 
{99 
return:: 
Ok:: 
(:: 
_petShopService:: )
.::) *

GetProduct::* 4
(::4 5
itemPetShopId::5 B
)::B C
)::C D
;::D E
};; 
catch<< 
(<< 
NotFoundException<< $
ex<<% '
)<<' (
{== 
return>> 
NotFound>> 
(>>  
ex>>  "
.>>" #
Message>># *
)>>* +
;>>+ ,
}?? 
catch@@ 
(@@ 
	Exception@@ 
ex@@ 
)@@  
{AA 
returnCC 

StatusCodeCC !
(CC! "
StatusCodesCC" -
.CC- .(
Status500InternalServerErrorCC. J
,CCJ K
$"CCL N
$strCCN a
{CCa b
exCCb d
.CCd e
MessageCCe l
}CCl m
"CCm n
)CCn o
;CCo p
}DD 
}EE 	
[KK 	
	AuthorizeKK	 
(KK 
RolesKK 
=KK 
$strKK "
)KK" #
]KK# $
[LL 	
HttpPostLL	 
]LL 
publicMM 
ActionResultMM 
<MM 
ProductModelMM (
>MM( )
CreateItemPetShopMM* ;
(MM; <
[MM< =
FromBodyMM= E
]MME F
ProductModelMMG S
petShopModelMMT `
)MM` a
{NN 	
tryOO 
{PP 
ifQQ 
(QQ 
!QQ 

ModelStateQQ 
.QQ  
IsValidQQ  '
)QQ' (
{RR 
returnSS 

BadRequestSS %
(SS% &
petShopModelSS& 2
)SS2 3
;SS3 4
}TT 
varUU 
urlUU 
=UU 
HttpContextUU %
.UU% &
RequestUU& -
.UU- .
HostUU. 2
;UU2 3
varVV 

createdPetVV 
=VV  
_petShopServiceVV! 0
.VV0 1
CreateProductVV1 >
(VV> ?
petShopModelVV? K
)VVK L
;VVL M
returnWW 
OkWW 
(WW 

createdPetWW $
)WW$ %
;WW% &
}XX 
catchYY 
(YY 
	ExceptionYY 
exYY 
)YY  
{ZZ 
return[[ 

StatusCode[[ !
([[! "
StatusCodes[[" -
.[[- .(
Status500InternalServerError[[. J
,[[J K
$"[[L N
$str[[N a
{[[a b
ex[[b d
.[[d e
Message[[e l
}[[l m
"[[m n
)[[n o
;[[o p
}\\ 
}]] 	
[cc 	
	Authorizecc	 
(cc 
Rolescc 
=cc 
$strcc "
)cc" #
]cc# $
[dd 	

HttpDeletedd	 
(dd 
$strdd )
)dd) *
]dd* +
publicee 
ActionResultee 
<ee 
boolee  
>ee  !
DeleteItemPetShopee" 3
(ee3 4
intee4 7
itemPetShopIdee8 E
)eeE F
{ff 	
trygg 
{hh 
returnii 
Okii 
(ii 
_petShopServiceii )
.ii) *
DeleteProductii* 7
(ii7 8
itemPetShopIdii8 E
)iiE F
)iiF G
;iiG H
}jj 
catchkk 
(kk 
NotFoundExceptionkk $
exkk% '
)kk' (
{ll 
returnnn 
NotFoundnn 
(nn  
exnn  "
.nn" #
Messagenn# *
)nn* +
;nn+ ,
}oo 
catchpp 
(pp 
	Exceptionpp 
expp 
)pp  
{qq 
returnss 

StatusCodess !
(ss! "
StatusCodesss" -
.ss- .(
Status500InternalServerErrorss. J
,ssJ K
$"ssL N
$strssN a
{ssa b
exssb d
.ssd e
Messagesse l
}ssl m
"ssm n
)ssn o
;sso p
}tt 
}uu 	
[|| 	
	Authorize||	 
(|| 
Roles|| 
=|| 
$str|| "
)||" #
]||# $
[}} 	
HttpPut}}	 
(}} 
$str}} &
)}}& '
]}}' (
public~~ 
ActionResult~~ 
<~~ 
PetModel~~ $
>~~$ %
	UpdatePet~~& /
(~~/ 0
int~~0 3
itemPetShopId~~4 A
,~~A B
[~~C D
FromBody~~D L
]~~L M
ProductModel~~N Z
petShopModel~~[ g
)~~g h
{ 	
try
ÄÄ 
{
ÅÅ 
return
ÇÇ 
Ok
ÇÇ 
(
ÇÇ 
_petShopService
ÇÇ )
.
ÇÇ) *
UpdateProduct
ÇÇ* 7
(
ÇÇ7 8
itemPetShopId
ÇÇ8 E
,
ÇÇE F
petShopModel
ÇÇG S
)
ÇÇS T
)
ÇÇT U
;
ÇÇU V
}
ÉÉ 
catch
ÖÖ 
(
ÖÖ 
NotFoundException
ÖÖ $
ex
ÖÖ% '
)
ÖÖ' (
{
ÜÜ 
return
àà 
NotFound
àà 
(
àà  
ex
àà  "
.
àà" #
Message
àà# *
)
àà* +
;
àà+ ,
}
ââ 
catch
ää 
(
ää 
	Exception
ää 
ex
ää 
)
ää  
{
ãã 
return
çç 

StatusCode
çç !
(
çç! "
StatusCodes
çç" -
.
çç- .*
Status500InternalServerError
çç. J
,
ççJ K
$"
ççL N
$str
ççN a
{
çça b
ex
ççb d
.
ççd e
Message
ççe l
}
ççl m
"
ççm n
)
ççn o
;
çço p
}
éé 
}
èè 	
[
ññ 	
HttpPost
ññ	 
(
ññ 
$str
ññ 
)
ññ 
]
ññ 
public
óó 
ActionResult
óó 
<
óó 
string
óó "
>
óó" #
photo
óó$ )
(
óó) *
[
óó* +
FromForm
óó+ 3
]
óó3 4
	IFormFile
óó5 >
photo
óó? D
)
óóD E
{
òò 	
string
•• 
uniqueFileName
•• !
=
••" #
null
••$ (
;
••( )
string
¶¶ 
filePath
¶¶ 
=
¶¶ 
$str
¶¶  
;
¶¶  !
if
ßß 
(
ßß 
photo
ßß 
!=
ßß 
null
ßß 
)
ßß 
{
®® 
string
©© 
images_path
©© "
=
©©# $!
_webHostEnvironment
©©% 8
.
©©8 9
ContentRootPath
©©9 H
;
©©H I
images_path
™™ 
=
™™ 
images_path
™™ )
.
™™) *
	Substring
™™* 3
(
™™3 4
$num
™™4 5
,
™™5 6
images_path
™™7 B
.
™™B C
Length
™™C I
-
™™J K
$num
™™L N
)
™™N O
;
™™O P
string
´´ 
uploadsFolder
´´ $
=
´´% &
Path
´´' +
.
´´+ ,
Combine
´´, 3
(
´´3 4
images_path
´´4 ?
,
´´? @
$"
´´A C
$str
´´C c
"
´´c d
)
´´d e
;
´´e f
uniqueFileName
¨¨ 
=
¨¨  
Guid
¨¨! %
.
¨¨% &
NewGuid
¨¨& -
(
¨¨- .
)
¨¨. /
.
¨¨/ 0
ToString
¨¨0 8
(
¨¨8 9
)
¨¨9 :
+
¨¨; <
$str
¨¨= @
+
¨¨A B
photo
¨¨C H
.
¨¨H I
FileName
¨¨I Q
;
¨¨Q R
filePath
≠≠ 
=
≠≠ 
Path
≠≠ 
.
≠≠  
Combine
≠≠  '
(
≠≠' (
uploadsFolder
≠≠( 5
,
≠≠5 6
uniqueFileName
≠≠7 E
)
≠≠E F
;
≠≠F G
using
ÆÆ 
(
ÆÆ 
var
ÆÆ 

fileStream
ÆÆ %
=
ÆÆ& '
new
ÆÆ( +

FileStream
ÆÆ, 6
(
ÆÆ6 7
filePath
ÆÆ7 ?
,
ÆÆ? @
FileMode
ÆÆA I
.
ÆÆI J
Create
ÆÆJ P
)
ÆÆP Q
)
ÆÆQ R
{
ØØ 
photo
∞∞ 
.
∞∞ 
CopyTo
∞∞  
(
∞∞  !

fileStream
∞∞! +
)
∞∞+ ,
;
∞∞, -
}
±± 
}
≤≤ 
return
≥≥ 
Ok
≥≥ 
(
≥≥ 
uniqueFileName
≥≥ $
)
≥≥$ %
;
≥≥% &
}
¥¥ 	
[
∫∫ 	
HttpPost
∫∫	 
(
∫∫ 
$str
∫∫ 
)
∫∫  
]
∫∫  !
public
ªª 
ActionResult
ªª 
<
ªª 
string
ªª "
>
ªª" #
photoDelete
ªª$ /
(
ªª/ 0
[
ªª0 1
FromForm
ªª1 9
]
ªª9 :
string
ªª; A

photo_name
ªªB L
)
ªªL M
{
ºº 	
if
ΩΩ 
(
ΩΩ 

photo_name
ΩΩ 
!=
ΩΩ 
null
ΩΩ "
)
ΩΩ" #
{
ææ 
string
øø 
images_path
øø "
=
øø# $!
_webHostEnvironment
øø% 8
.
øø8 9
ContentRootPath
øø9 H
;
øøH I
images_path
¿¿ 
=
¿¿ 
images_path
¿¿ )
.
¿¿) *
	Substring
¿¿* 3
(
¿¿3 4
$num
¿¿4 5
,
¿¿5 6
images_path
¿¿7 B
.
¿¿B C
Length
¿¿C I
-
¿¿J K
$num
¿¿L N
)
¿¿N O
;
¿¿O P
string
¡¡ 
uploadsFolder
¡¡ $
=
¡¡% &
Path
¡¡' +
.
¡¡+ ,
Combine
¡¡, 3
(
¡¡3 4
images_path
¡¡4 ?
,
¡¡? @
$"
¡¡A C
$str
¡¡C c
"
¡¡c d
)
¡¡d e
;
¡¡e f
var
¬¬ 
filePath
¬¬ 
=
¬¬ 
Path
¬¬ #
.
¬¬# $
Combine
¬¬$ +
(
¬¬+ ,
uploadsFolder
¬¬, 9
,
¬¬9 :

photo_name
¬¬; E
)
¬¬E F
;
¬¬F G
System
∆∆ 
.
∆∆ 
IO
∆∆ 
.
∆∆ 
File
∆∆ 
.
∆∆ 
Delete
∆∆ %
(
∆∆% &
filePath
∆∆& .
)
∆∆. /
;
∆∆/ 0
}
«« 
return
»» 
Ok
»» 
(
»» 
true
»» 
)
»» 
;
»» 
}
…… 	
}
   
}ÀÀ Ü
D:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Data\ApplicationDbContext.cs
	namespace 	
BackEndAlbergue
 
. 
Data 
{ 
public 

class  
ApplicationDbContext %
:& '
IdentityDbContext( 9
{ 
public 
DbSet 
< 
	PetEntity 
> 
pets  $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
DbSet 
< 
NoticeModel  
>  !
notice" (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 
DbSet 
< 
ProductModel !
>! "
petShop# *
{+ ,
get- 0
;0 1
set2 5
;5 6
}7 8
public  
ApplicationDbContext #
(# $
DbContextOptions$ 4
<4 5 
ApplicationDbContext5 I
>I J
optionsK R
)R S
: 
base 
( 
options 
) 
{ 	
} 	
	protected 
override 
void 
OnConfiguring  -
(- .#
DbContextOptionsBuilder. E
optionsBuilderF T
)T U
{ 	
base 
. 
OnConfiguring 
( 
optionsBuilder -
)- .
;. /
} 	
} 
} Æ
|D:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Data\AutoMapperProfile.cs
	namespace		 	
BackEndAlbergue		
 
.		 
Data		 
{

 
public 

class 
AutoMapperProfile "
:# $
Profile% ,
{ 
public 
AutoMapperProfile  
(  !
)! "
{ 	
this 
. 
	CreateMap 
< 
	PetEntity $
,$ %
PetModel& .
>. /
(/ 0
)0 1
. 

ReverseMap 
( 
) 
; 
this 
. 
	CreateMap 
< 
PetModel #
,# $
	PetEntity% .
>. /
(/ 0
)0 1
. 

ReverseMap 
( 
)  
;  !
this 
. 
	CreateMap 
< 
NoticeEntity '
,' (
NoticeModel) 4
>4 5
(5 6
)6 7
. 

ReverseMap 
(  
)  !
;! "
this 
. 
	CreateMap 
< 
NoticeModel &
,& '
NoticeEntity( 4
>4 5
(5 6
)6 7
. 

ReverseMap 
( 
)  
;  !
this 
. 
	CreateMap 
< 
ProductEntity (
,( )
ProductModel* 6
>6 7
(7 8
)8 9
. 

ReverseMap 
(  
)  !
;! "
this 
. 
	CreateMap 
< 
ProductModel '
,' (
ProductEntity) 6
>6 7
(7 8
)8 9
. 

ReverseMap 
( 
)  
;  !
this 
. 
	CreateMap 
< 
PetModelImpostor +
,+ ,
	PetEntity- 6
>6 7
(7 8
)8 9
. 

ReverseMap 
( 
)  
;  !
this   
.   
	CreateMap   
<   
	PetEntity   $
,  $ %
PetModelImpostor  & 6
>  6 7
(  7 8
)  8 9
.!! 

ReverseMap!! 
(!! 
)!! 
;!!  
}"" 	
}## 
}$$ ‚
ÄD:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Data\Entities\NoticeEntity.cs
	namespace 	
BackEndAlbergue
 
. 
Data 
. 
Entities '
{ 
public 

class 
NoticeEntity 
{		 
public

 
int

 
id

 
{

 
get

 
;

 
set

  
;

  !
}

" #
public 
string 
title 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
image 
{ 
get !
;! "
set# &
;& '
}( )
public 
DateTime 
? 
date 
{ 
get  #
;# $
set% (
;( )
}* +
} 
} ‘
}D:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Data\Entities\PetEntity.cs
	namespace 	
BackEndAlbergue
 
. 
Data 
. 
Entities '
{ 
public 

class 
	PetEntity 
{		 
public

 
int

 
Id

 
{

 
get

 
;

 
set

  
;

  !
}

" #
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
char 
? 
Sex 
{ 
get 
; 
set  #
;# $
}% &
public 
string 
Description !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 
Photo 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
Vaccines 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
bool 
? 
Sterilization "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 
Size 
{ 
get  
;  !
set" %
;% &
}' (
public 
DateTime 
? 
age 
{ 
get "
;" #
set$ '
;' (
}) *
public 
bool 
? 
	IsAdopted 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
int 
? 
previous 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
null- 1
;1 2
public 
int 
? 
next 
{ 
get 
; 
set  #
;# $
}% &
=' (
null) -
;- .
} 
} å
ÅD:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Data\Entities\ProductEntity.cs
	namespace 	
BackEndAlbergue
 
. 
Data 
. 
Entities '
{ 
public 

class 
ProductEntity 
{		 
public

 
int

 
Id

 
{

 
get

 
;

 
set

  
;

  !
}

" #
public 
string 
ProductName !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
char 
? 
Sex 
{ 
get 
; 
set  #
;# $
}% &
public 
string 
Photo 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
Category 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
	SizeOfPet 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
Price 
{ 
get !
;! "
set# &
;& '
}( )
public 
int 
? 
Stock 
{ 
get 
;  
set! $
;$ %
}& '
=( )
null* .
;. /
} 
} Ì
}D:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Data\Repository\IRefuge.cs
	namespace 	
BackEndAlbergue
 
. 
Data 
. 

Repository )
{		 
public

 

	interface

 
IRefuge

 
{ 
public 
IEnumerable 
< 
	PetEntity $
>$ %
GetPets& -
(- .
). /
;/ 0
public 
	PetEntity 
GetPet 
(  
int  #
PetId$ )
)) *
;* +
public 
	PetEntity 
	CreatePet "
(" #
	PetEntity# ,
	petEntity- 6
)6 7
;7 8
public 
bool 
	DeletePet 
( 
int !
PetId" '
)' (
;( )
public 
	PetEntity 
	UpdatePet "
(" #
	PetEntity# ,
	petEntity- 6
)6 7
;7 8
public 
IEnumerable 
< 
NoticeEntity '
>' (

GetNotices) 3
(3 4
)4 5
;5 6
public 
NoticeEntity 
	GetNotice %
(% &
int& )
NoticeId* 2
)2 3
;3 4
public 
NoticeEntity 
CreateNotice (
(( )
NoticeEntity) 5
noticeEntity6 B
)B C
;C D
public 
bool 
DeleteNotice  
(  !
int! $
NoticeId% -
)- .
;. /
public 
NoticeEntity 
UpdateNotice (
(( )
NoticeEntity) 5
noticeEntity6 B
)B C
;C D
public 
IEnumerable 
< 
ProductEntity (
>( )
GetProducts* 5
(5 6
)6 7
;7 8
public 
ProductEntity 

GetProduct '
(' (
int( +
ItemId, 2
)2 3
;3 4
public 
ProductEntity 
CreateProduct *
(* +
ProductEntity+ 8
productEntity9 F
)F G
;G H
public 
bool 
DeleteProduct !
(! "
int" %
ItemId& ,
), -
;- .
public 
ProductEntity 
UpdateProduct *
(* +
ProductEntity+ 8
productEntity9 F
)F G
;G H
public   
IEnumerable   
<   
	UserModel   $
>  $ %
GetUsers  & .
(  . /
)  / 0
;  0 1
}!! 
}"" äÎ
|D:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Data\Repository\Refuge.cs
	namespace		 	
BackEndAlbergue		
 
.		 
Data		 
.		 

Repository		 )
{

 
public 

class 
Refuge 
: 
IRefuge !
{ 
static 
string 
connectionString &
=' (
$str) u
;u v
static 
string 
query 
= 
$str 2
;2 3
private 
	PetEntity 
	_firstPet #
=$ %
null& *
;* +
private 
	PetEntity 
_lastPet "
=# $
null% )
;) *
public 
Refuge 
( 
) 
{ 	
	_firstPet 
= 
new 
	PetEntity %
(% &
)& '
;' (
_lastPet 
= 
new 
	PetEntity $
($ %
)% &
;& '
MySqlConnection 
databaseConnection .
=/ 0
new1 4
MySqlConnection5 D
(D E
connectionStringE U
)U V
;V W
string 
query 
= 
$" 
$str H
"H I
;I J
MySqlCommand 
commandDatabase (
=) *
new+ .
MySqlCommand/ ;
(; <
query< A
,A B
databaseConnectionC U
)U V
;V W
commandDatabase 
. 
CommandTimeout *
=+ ,
$num- /
;/ 0
databaseConnection 
. 
Open #
(# $
)$ %
;% &
MySqlDataReader 
_reader #
=$ %
commandDatabase& 5
.5 6
ExecuteReader6 C
(C D
)D E
;E F
if 
( 
_reader 
. 
HasRows 
)  
{ 
while 
( 
_reader 
. 
Read #
(# $
)$ %
)% &
{ 
	_firstPet   
.   
Id    
=  ! "
_reader  # *
.  * +
GetInt32  + 3
(  3 4
$num  4 5
)  5 6
;  6 7
	_firstPet!! 
.!! 
Name!! "
=!!# $
_reader!!% ,
.!!, -
	GetString!!- 6
(!!6 7
$num!!7 8
)!!8 9
;!!9 :
	_firstPet"" 
."" 
Sex"" !
=""" #
_reader""$ +
.""+ ,
GetChar"", 3
(""3 4
$num""4 5
)""5 6
;""6 7
	_firstPet## 
.## 
Description## )
=##* +
_reader##, 3
.##3 4
	GetString##4 =
(##= >
$num##> ?
)##? @
;##@ A
	_firstPet$$ 
.$$ 
Photo$$ #
=$$$ %
_reader$$& -
.$$- .
	GetString$$. 7
($$7 8
$num$$8 9
)$$9 :
;$$: ;
	_firstPet%% 
.%% 
Vaccines%% &
=%%' (
_reader%%) 0
.%%0 1
	GetString%%1 :
(%%: ;
$num%%; <
)%%< =
;%%= >
	_firstPet&& 
.&& 
Sterilization&& +
=&&, -
_reader&&. 5
.&&5 6

GetBoolean&&6 @
(&&@ A
$num&&A B
)&&B C
;&&C D
	_firstPet'' 
.'' 
Size'' "
=''# $
_reader''% ,
.'', -
	GetString''- 6
(''6 7
$num''7 8
)''8 9
;''9 :
	_firstPet(( 
.(( 
age(( !
=((" #
_reader(($ +
.((+ ,
GetDateTime((, 7
(((7 8
$num((8 9
)((9 :
;((: ;
	_firstPet)) 
.)) 
	IsAdopted)) '
=))( )
_reader))* 1
.))1 2

GetBoolean))2 <
())< =
$num))= >
)))> ?
;))? @
if** 
(** 
_reader** 
.**  
IsDBNull**  (
(**( )
$num**) +
)**+ ,
)**, -
{++ 
	_firstPet,, !
.,,! "
next,," &
=,,' (
null,,) -
;,,- .
}-- 
else.. 
{// 
	_firstPet00 !
.00! "
next00" &
=00' (
_reader00) 0
.000 1
GetInt32001 9
(009 :
$num00: <
)00< =
;00= >
}11 
if22 
(22 
_reader22 
.22  
IsDBNull22  (
(22( )
$num22) +
)22+ ,
)22, -
{33 
	_firstPet44 !
.44! "
previous44" *
=44+ ,
null44- 1
;441 2
}55 
else66 
{77 
	_firstPet88 !
.88! "
previous88" *
=88+ ,
_reader88- 4
.884 5
GetInt32885 =
(88= >
$num88> @
)88@ A
;88A B
}99 
}:: 
databaseConnection;; "
.;;" #
Close;;# (
(;;( )
);;) *
;;;* +
}<< 
if== 
(== 
	_firstPet== 
.== 
Name== 
==== !
null==" &
)==& '
{>> 
	_firstPet?? 
=?? 
null??  
;??  !
}@@ 
MySqlConnectionBB 
databaseConnection2BB /
=BB0 1
newBB2 5
MySqlConnectionBB6 E
(BBE F
connectionStringBBF V
)BBV W
;BBW X
stringCC 
query2CC 
=CC 
$"CC 
$strCC J
"CCJ K
;CCK L
MySqlCommandDD 
commandDatabase2DD )
=DD* +
newDD, /
MySqlCommandDD0 <
(DD< =
query2DD= C
,DDC D
databaseConnection2DDE X
)DDX Y
;DDY Z
commandDatabase2EE 
.EE 
CommandTimeoutEE +
=EE, -
$numEE. 0
;EE0 1
databaseConnection2FF 
.FF  
OpenFF  $
(FF$ %
)FF% &
;FF& '
MySqlDataReaderGG 
_reader2GG $
=GG% &
commandDatabase2GG' 7
.GG7 8
ExecuteReaderGG8 E
(GGE F
)GGF G
;GGG H
ifHH 
(HH 
_reader2HH 
.HH 
HasRowsHH  
)HH  !
{II 
whileJJ 
(JJ 
_reader2JJ 
.JJ  
ReadJJ  $
(JJ$ %
)JJ% &
)JJ& '
{KK 
_lastPetLL 
.LL 
IdLL 
=LL  !
_reader2LL" *
.LL* +
GetInt32LL+ 3
(LL3 4
$numLL4 5
)LL5 6
;LL6 7
_lastPetMM 
.MM 
NameMM !
=MM" #
_reader2MM$ ,
.MM, -
	GetStringMM- 6
(MM6 7
$numMM7 8
)MM8 9
;MM9 :
_lastPetNN 
.NN 
SexNN  
=NN! "
_reader2NN# +
.NN+ ,
GetCharNN, 3
(NN3 4
$numNN4 5
)NN5 6
;NN6 7
_lastPetOO 
.OO 
DescriptionOO (
=OO) *
_reader2OO+ 3
.OO3 4
	GetStringOO4 =
(OO= >
$numOO> ?
)OO? @
;OO@ A
_lastPetPP 
.PP 
PhotoPP "
=PP# $
_reader2PP% -
.PP- .
	GetStringPP. 7
(PP7 8
$numPP8 9
)PP9 :
;PP: ;
_lastPetQQ 
.QQ 
VaccinesQQ %
=QQ& '
_reader2QQ( 0
.QQ0 1
	GetStringQQ1 :
(QQ: ;
$numQQ; <
)QQ< =
;QQ= >
_lastPetRR 
.RR 
SterilizationRR *
=RR+ ,
_reader2RR- 5
.RR5 6

GetBooleanRR6 @
(RR@ A
$numRRA B
)RRB C
;RRC D
_lastPetSS 
.SS 
SizeSS !
=SS" #
_reader2SS$ ,
.SS, -
	GetStringSS- 6
(SS6 7
$numSS7 8
)SS8 9
;SS9 :
_lastPetTT 
.TT 
ageTT  
=TT! "
_reader2TT# +
.TT+ ,
GetDateTimeTT, 7
(TT7 8
$numTT8 9
)TT9 :
;TT: ;
_lastPetUU 
.UU 
	IsAdoptedUU &
=UU' (
_reader2UU) 1
.UU1 2

GetBooleanUU2 <
(UU< =
$numUU= >
)UU> ?
;UU? @
ifVV 
(VV 
_reader2VV  
.VV  !
IsDBNullVV! )
(VV) *
$numVV* ,
)VV, -
)VV- .
{WW 
_lastPetXX  
.XX  !
nextXX! %
=XX& '
nullXX( ,
;XX, -
}YY 
elseZZ 
{[[ 
_lastPet\\  
.\\  !
next\\! %
=\\& '
_reader2\\( 0
.\\0 1
GetInt32\\1 9
(\\9 :
$num\\: <
)\\< =
;\\= >
}]] 
if^^ 
(^^ 
_reader2^^  
.^^  !
IsDBNull^^! )
(^^) *
$num^^* ,
)^^, -
)^^- .
{__ 
_lastPet``  
.``  !
previous``! )
=``* +
null``, 0
;``0 1
}aa 
elsebb 
{cc 
_lastPetdd  
.dd  !
previousdd! )
=dd* +
_reader2dd, 4
.dd4 5
GetInt32dd5 =
(dd= >
$numdd> @
)dd@ A
;ddA B
}ee 
}ff 
databaseConnection2gg #
.gg# $
Closegg$ )
(gg) *
)gg* +
;gg+ ,
}hh 
ifii 
(ii 
_lastPetii 
.ii 
Nameii 
==ii  
nullii! %
)ii% &
{jj 
_lastPetkk 
=kk 
nullkk 
;kk  
}ll 
}nn 	
publicpp 
IEnumerablepp 
<pp 
	PetEntitypp $
>pp$ %
GetPetspp& -
(pp- .
)pp. /
{qq 	
Listrr 
<rr 
	PetEntityrr 
>rr 
petsrr  
=rr! "
newrr# &
Listrr' +
<rr+ ,
	PetEntityrr, 5
>rr5 6
(rr6 7
)rr7 8
;rr8 9
MySqlConnectionss 
databaseConnectionss .
=ss/ 0
newss1 4
MySqlConnectionss5 D
(ssD E
connectionStringssE U
)ssU V
;ssV W
MySqlCommandtt 
commandDatabasett (
=tt) *
newtt+ .
MySqlCommandtt/ ;
(tt; <
querytt< A
,ttA B
databaseConnectionttC U
)ttU V
;ttV W
commandDatabaseuu 
.uu 
CommandTimeoutuu *
=uu+ ,
$numuu- /
;uu/ 0
databaseConnectionvv 
.vv 
Openvv #
(vv# $
)vv$ %
;vv% &
MySqlDataReaderww 
_readerww #
=ww$ %
commandDatabaseww& 5
.ww5 6
ExecuteReaderww6 C
(wwC D
)wwD E
;wwE F
ifxx 
(xx 
_readerxx 
.xx 
HasRowsxx 
)xx  
{yy 
whilezz 
(zz 
_readerzz 
.zz 
Readzz #
(zz# $
)zz$ %
)zz% &
{{{ 
	PetEntity|| 
pet|| !
=||" #
new||$ '
	PetEntity||( 1
(||1 2
)||2 3
;||3 4
pet}} 
.}} 
Id}} 
=}} 
_reader}} $
.}}$ %
GetInt32}}% -
(}}- .
$num}}. /
)}}/ 0
;}}0 1
pet~~ 
.~~ 
Name~~ 
=~~ 
_reader~~ &
.~~& '
	GetString~~' 0
(~~0 1
$num~~1 2
)~~2 3
;~~3 4
pet 
. 
Sex 
= 
_reader %
.% &
GetChar& -
(- .
$num. /
)/ 0
;0 1
pet
ÄÄ 
.
ÄÄ 
Description
ÄÄ #
=
ÄÄ$ %
_reader
ÄÄ& -
.
ÄÄ- .
	GetString
ÄÄ. 7
(
ÄÄ7 8
$num
ÄÄ8 9
)
ÄÄ9 :
;
ÄÄ: ;
pet
ÅÅ 
.
ÅÅ 
Photo
ÅÅ 
=
ÅÅ 
_reader
ÅÅ  '
.
ÅÅ' (
	GetString
ÅÅ( 1
(
ÅÅ1 2
$num
ÅÅ2 3
)
ÅÅ3 4
;
ÅÅ4 5
pet
ÇÇ 
.
ÇÇ 
Vaccines
ÇÇ  
=
ÇÇ! "
_reader
ÇÇ# *
.
ÇÇ* +
	GetString
ÇÇ+ 4
(
ÇÇ4 5
$num
ÇÇ5 6
)
ÇÇ6 7
;
ÇÇ7 8
pet
ÉÉ 
.
ÉÉ 
Sterilization
ÉÉ %
=
ÉÉ& '
_reader
ÉÉ( /
.
ÉÉ/ 0

GetBoolean
ÉÉ0 :
(
ÉÉ: ;
$num
ÉÉ; <
)
ÉÉ< =
;
ÉÉ= >
pet
ÑÑ 
.
ÑÑ 
Size
ÑÑ 
=
ÑÑ 
_reader
ÑÑ &
.
ÑÑ& '
	GetString
ÑÑ' 0
(
ÑÑ0 1
$num
ÑÑ1 2
)
ÑÑ2 3
;
ÑÑ3 4
pet
ÖÖ 
.
ÖÖ 
age
ÖÖ 
=
ÖÖ 
_reader
ÖÖ %
.
ÖÖ% &
GetDateTime
ÖÖ& 1
(
ÖÖ1 2
$num
ÖÖ2 3
)
ÖÖ3 4
;
ÖÖ4 5
pet
ÜÜ 
.
ÜÜ 
	IsAdopted
ÜÜ !
=
ÜÜ" #
_reader
ÜÜ$ +
.
ÜÜ+ ,

GetBoolean
ÜÜ, 6
(
ÜÜ6 7
$num
ÜÜ7 8
)
ÜÜ8 9
;
ÜÜ9 :
pets
áá 
.
áá 
Add
áá 
(
áá 
pet
áá  
)
áá  !
;
áá! "
}
àà  
databaseConnection
ââ "
.
ââ" #
Close
ââ# (
(
ââ( )
)
ââ) *
;
ââ* +
}
ää 
return
ãã 
pets
ãã 
;
ãã 
}
åå 	
public
éé 
	PetEntity
éé 
GetPet
éé 
(
éé  
int
éé  #
petId
éé$ )
)
éé) *
{
èè 	
	PetEntity
êê 
pet
êê 
=
êê 
new
êê 
	PetEntity
êê  )
(
êê) *
)
êê* +
;
êê+ ,
MySqlConnection
ëë  
databaseConnection
ëë .
=
ëë/ 0
new
ëë1 4
MySqlConnection
ëë5 D
(
ëëD E
connectionString
ëëE U
)
ëëU V
;
ëëV W
string
íí 
query
íí 
=
íí 
$"
íí 
$str
íí ;
{
íí; <
petId
íí< A
}
ííA B
"
ííB C
;
ííC D
MySqlCommand
ìì 
commandDatabase
ìì (
=
ìì) *
new
ìì+ .
MySqlCommand
ìì/ ;
(
ìì; <
query
ìì< A
,
ììA B 
databaseConnection
ììC U
)
ììU V
;
ììV W
commandDatabase
îî 
.
îî 
CommandTimeout
îî *
=
îî+ ,
$num
îî- /
;
îî/ 0 
databaseConnection
ïï 
.
ïï 
Open
ïï #
(
ïï# $
)
ïï$ %
;
ïï% &
MySqlDataReader
ññ 
_reader
ññ #
=
ññ$ %
commandDatabase
ññ& 5
.
ññ5 6
ExecuteReader
ññ6 C
(
ññC D
)
ññD E
;
ññE F
if
óó 
(
óó 
_reader
óó 
.
óó 
HasRows
óó 
)
óó  
{
òò 
while
ôô 
(
ôô 
_reader
ôô 
.
ôô 
Read
ôô #
(
ôô# $
)
ôô$ %
)
ôô% &
{
öö 
pet
úú 
.
úú 
Id
úú 
=
úú 
_reader
úú $
.
úú$ %
GetInt32
úú% -
(
úú- .
$num
úú. /
)
úú/ 0
;
úú0 1
pet
ùù 
.
ùù 
Name
ùù 
=
ùù 
_reader
ùù &
.
ùù& '
	GetString
ùù' 0
(
ùù0 1
$num
ùù1 2
)
ùù2 3
;
ùù3 4
pet
ûû 
.
ûû 
Sex
ûû 
=
ûû 
_reader
ûû %
.
ûû% &
GetChar
ûû& -
(
ûû- .
$num
ûû. /
)
ûû/ 0
;
ûû0 1
pet
üü 
.
üü 
Description
üü #
=
üü$ %
_reader
üü& -
.
üü- .
	GetString
üü. 7
(
üü7 8
$num
üü8 9
)
üü9 :
;
üü: ;
pet
†† 
.
†† 
Photo
†† 
=
†† 
_reader
††  '
.
††' (
	GetString
††( 1
(
††1 2
$num
††2 3
)
††3 4
;
††4 5
pet
°° 
.
°° 
Vaccines
°°  
=
°°! "
_reader
°°# *
.
°°* +
	GetString
°°+ 4
(
°°4 5
$num
°°5 6
)
°°6 7
;
°°7 8
pet
¢¢ 
.
¢¢ 
Sterilization
¢¢ %
=
¢¢& '
_reader
¢¢( /
.
¢¢/ 0

GetBoolean
¢¢0 :
(
¢¢: ;
$num
¢¢; <
)
¢¢< =
;
¢¢= >
pet
££ 
.
££ 
Size
££ 
=
££ 
_reader
££ &
.
££& '
	GetString
££' 0
(
££0 1
$num
££1 2
)
££2 3
;
££3 4
pet
§§ 
.
§§ 
age
§§ 
=
§§ 
_reader
§§ %
.
§§% &
GetDateTime
§§& 1
(
§§1 2
$num
§§2 3
)
§§3 4
;
§§4 5
pet
•• 
.
•• 
	IsAdopted
•• !
=
••" #
_reader
••$ +
.
••+ ,

GetBoolean
••, 6
(
••6 7
$num
••7 8
)
••8 9
;
••9 :
if
¶¶ 
(
¶¶ 
_reader
¶¶ 
.
¶¶ 
IsDBNull
¶¶ '
(
¶¶' (
$num
¶¶( *
)
¶¶* +
)
¶¶+ ,
{
ßß 
pet
®® 
.
®® 
next
®®  
=
®®! "
null
®®# '
;
®®' (
}
©© 
else
™™ 
{
´´ 
pet
¨¨ 
.
¨¨ 
next
¨¨  
=
¨¨  !
_reader
¨¨! (
.
¨¨( )
GetInt32
¨¨) 1
(
¨¨1 2
$num
¨¨2 4
)
¨¨4 5
;
¨¨5 6
}
≠≠ 
if
ÆÆ 
(
ÆÆ 
_reader
ÆÆ 
.
ÆÆ  
IsDBNull
ÆÆ  (
(
ÆÆ( )
$num
ÆÆ) +
)
ÆÆ+ ,
)
ÆÆ, -
{
ØØ 
pet
∞∞ 
.
∞∞ 
previous
∞∞ $
=
∞∞% &
null
∞∞' +
;
∞∞+ ,
}
±± 
else
≤≤ 
{
≥≥ 
pet
¥¥ 
.
¥¥ 
previous
¥¥ $
=
¥¥% &
_reader
¥¥' .
.
¥¥. /
GetInt32
¥¥/ 7
(
¥¥7 8
$num
¥¥8 :
)
¥¥: ;
;
¥¥; <
}
µµ 
}
∂∂  
databaseConnection
∑∑ "
.
∑∑" #
Close
∑∑# (
(
∑∑( )
)
∑∑) *
;
∑∑* +
}
∏∏ 
return
ππ 
pet
ππ 
;
ππ 
}
∫∫ 	
public
ªª 
	PetEntity
ªª 
GetPetNullable
ªª '
(
ªª' (
int
ªª( +
?
ªª+ ,
petId
ªª- 2
)
ªª2 3
{
ºº 	
	PetEntity
ΩΩ 
pet
ΩΩ 
=
ΩΩ 
new
ΩΩ 
	PetEntity
ΩΩ  )
(
ΩΩ) *
)
ΩΩ* +
;
ΩΩ+ ,
MySqlConnection
ææ  
databaseConnection
ææ .
=
ææ/ 0
new
ææ1 4
MySqlConnection
ææ5 D
(
ææD E
connectionString
ææE U
)
ææU V
;
ææV W
string
øø 
query
øø 
=
øø 
$"
øø 
$str
øø ;
{
øø; <
petId
øø< A
}
øøA B
"
øøB C
;
øøC D
MySqlCommand
¿¿ 
commandDatabase
¿¿ (
=
¿¿) *
new
¿¿+ .
MySqlCommand
¿¿/ ;
(
¿¿; <
query
¿¿< A
,
¿¿A B 
databaseConnection
¿¿C U
)
¿¿U V
;
¿¿V W
commandDatabase
¡¡ 
.
¡¡ 
CommandTimeout
¡¡ *
=
¡¡+ ,
$num
¡¡- /
;
¡¡/ 0 
databaseConnection
¬¬ 
.
¬¬ 
Open
¬¬ #
(
¬¬# $
)
¬¬$ %
;
¬¬% &
MySqlDataReader
√√ 
_reader
√√ #
=
√√$ %
commandDatabase
√√& 5
.
√√5 6
ExecuteReader
√√6 C
(
√√C D
)
√√D E
;
√√E F
if
ƒƒ 
(
ƒƒ 
_reader
ƒƒ 
.
ƒƒ 
HasRows
ƒƒ 
)
ƒƒ  
{
≈≈ 
while
∆∆ 
(
∆∆ 
_reader
∆∆ 
.
∆∆ 
Read
∆∆ #
(
∆∆# $
)
∆∆$ %
)
∆∆% &
{
«« 
pet
»» 
.
»» 
Id
»» 
=
»» 
_reader
»» $
.
»»$ %
GetInt32
»»% -
(
»»- .
$num
»». /
)
»»/ 0
;
»»0 1
pet
…… 
.
…… 
Name
…… 
=
…… 
_reader
…… &
.
……& '
	GetString
……' 0
(
……0 1
$num
……1 2
)
……2 3
;
……3 4
pet
   
.
   
Sex
   
=
   
_reader
   %
.
  % &
GetChar
  & -
(
  - .
$num
  . /
)
  / 0
;
  0 1
pet
ÀÀ 
.
ÀÀ 
Description
ÀÀ #
=
ÀÀ$ %
_reader
ÀÀ& -
.
ÀÀ- .
	GetString
ÀÀ. 7
(
ÀÀ7 8
$num
ÀÀ8 9
)
ÀÀ9 :
;
ÀÀ: ;
pet
ÃÃ 
.
ÃÃ 
Photo
ÃÃ 
=
ÃÃ 
_reader
ÃÃ  '
.
ÃÃ' (
	GetString
ÃÃ( 1
(
ÃÃ1 2
$num
ÃÃ2 3
)
ÃÃ3 4
;
ÃÃ4 5
pet
ÕÕ 
.
ÕÕ 
Vaccines
ÕÕ  
=
ÕÕ! "
_reader
ÕÕ# *
.
ÕÕ* +
	GetString
ÕÕ+ 4
(
ÕÕ4 5
$num
ÕÕ5 6
)
ÕÕ6 7
;
ÕÕ7 8
pet
ŒŒ 
.
ŒŒ 
Sterilization
ŒŒ %
=
ŒŒ& '
_reader
ŒŒ( /
.
ŒŒ/ 0

GetBoolean
ŒŒ0 :
(
ŒŒ: ;
$num
ŒŒ; <
)
ŒŒ< =
;
ŒŒ= >
pet
œœ 
.
œœ 
Size
œœ 
=
œœ 
_reader
œœ &
.
œœ& '
	GetString
œœ' 0
(
œœ0 1
$num
œœ1 2
)
œœ2 3
;
œœ3 4
pet
–– 
.
–– 
age
–– 
=
–– 
_reader
–– %
.
––% &
GetDateTime
––& 1
(
––1 2
$num
––2 3
)
––3 4
;
––4 5
pet
—— 
.
—— 
	IsAdopted
—— !
=
——" #
_reader
——$ +
.
——+ ,

GetBoolean
——, 6
(
——6 7
$num
——7 8
)
——8 9
;
——9 :
if
““ 
(
““ 
_reader
““ 
.
““  
IsDBNull
““  (
(
““( )
$num
““) +
)
““+ ,
)
““, -
{
”” 
pet
‘‘ 
.
‘‘ 
next
‘‘  
=
‘‘! "
null
‘‘# '
;
‘‘' (
}
’’ 
else
÷÷ 
{
◊◊ 
pet
ÿÿ 
.
ÿÿ 
next
ÿÿ  
=
ÿÿ! "
_reader
ÿÿ# *
.
ÿÿ* +
GetInt32
ÿÿ+ 3
(
ÿÿ3 4
$num
ÿÿ4 6
)
ÿÿ6 7
;
ÿÿ7 8
}
ŸŸ 
if
⁄⁄ 
(
⁄⁄ 
_reader
⁄⁄ 
.
⁄⁄  
IsDBNull
⁄⁄  (
(
⁄⁄( )
$num
⁄⁄) +
)
⁄⁄+ ,
)
⁄⁄, -
{
€€ 
pet
‹‹ 
.
‹‹ 
previous
‹‹ $
=
‹‹% &
null
‹‹' +
;
‹‹+ ,
}
›› 
else
ﬁﬁ 
{
ﬂﬂ 
pet
‡‡ 
.
‡‡ 
previous
‡‡ $
=
‡‡% &
_reader
‡‡' .
.
‡‡. /
GetInt32
‡‡/ 7
(
‡‡7 8
$num
‡‡8 :
)
‡‡: ;
;
‡‡; <
}
‚‚ 
}
„„  
databaseConnection
‰‰ "
.
‰‰" #
Close
‰‰# (
(
‰‰( )
)
‰‰) *
;
‰‰* +
}
ÂÂ 
return
ÊÊ 
pet
ÊÊ 
;
ÊÊ 
}
ÁÁ 	
public
ËË 
	PetEntity
ËË 
	CreatePet
ËË "
(
ËË" #
	PetEntity
ËË# ,
	petEntity
ËË- 6
)
ËË6 7
{
ÈÈ 	
int
ÍÍ 
retorno
ÍÍ 
=
ÍÍ 
$num
ÍÍ 
;
ÍÍ 
int
ÎÎ 
sterilization
ÎÎ 
=
ÎÎ 
(
ÎÎ  !
bool
ÎÎ! %
)
ÎÎ% &
	petEntity
ÎÎ& /
.
ÎÎ/ 0
Sterilization
ÎÎ0 =
?
ÎÎ> ?
$num
ÎÎ@ A
:
ÎÎB C
$num
ÎÎD E
;
ÎÎE F
int
ÏÏ 
	isAdopted
ÏÏ 
=
ÏÏ 
(
ÏÏ 
bool
ÏÏ !
)
ÏÏ! "
	petEntity
ÏÏ" +
.
ÏÏ+ ,
	IsAdopted
ÏÏ, 5
?
ÏÏ6 7
$num
ÏÏ8 9
:
ÏÏ: ;
$num
ÏÏ< =
;
ÏÏ= >
MySqlConnection
ÌÌ  
databaseConnection
ÌÌ .
=
ÌÌ/ 0
new
ÌÌ1 4
MySqlConnection
ÌÌ5 D
(
ÌÌD E
connectionString
ÌÌE U
)
ÌÌU V
;
ÌÌV W 
databaseConnection
ÓÓ 
.
ÓÓ 
Open
ÓÓ #
(
ÓÓ# $
)
ÓÓ$ %
;
ÓÓ% &
MySqlCommand
ÔÔ 
commandDatabase
ÔÔ (
=
ÔÔ) *
new
ÔÔ+ .
MySqlCommand
ÔÔ/ ;
(
ÔÔ; <
$"
ÔÔ< >
$strÔÔ> °
{ÔÔ° ¢
	petEntityÔÔ¢ ´
.ÔÔ´ ¨
NameÔÔ¨ ∞
}ÔÔ∞ ±
$strÔÔ± ¥
{ÔÔ¥ µ
	petEntityÔÔµ æ
.ÔÔæ ø
SexÔÔø ¬
}ÔÔ¬ √
$strÔÔ√ «
{ÔÔ« »
	petEntityÔÔ» —
.ÔÔ— “
DescriptionÔÔ“ ›
}ÔÔ› ﬁ
$strÔÔﬁ ‚
{ÔÔ‚ „
	petEntityÔÔ„ Ï
.ÔÔÏ Ì
SizeÔÔÌ Ò
}ÔÔÒ Ú
$strÔÔÚ ˆ
{ÔÔˆ ˜
	petEntityÔÔ˜ Ä
.ÔÔÄ Å
VaccinesÔÔÅ â
}ÔÔâ ä
$strÔÔä ç
{ÔÔç é
sterilizationÔÔé õ
}ÔÔõ ú
$strÔÔú ü
{ÔÔü †
	petEntityÔÔ† ©
.ÔÔ© ™
ageÔÔ™ ≠
.ÔÔ≠ Æ
ValueÔÔÆ ≥
.ÔÔ≥ ¥
ToStringÔÔ¥ º
(ÔÔº Ω
$strÔÔΩ “
)ÔÔ“ ”
}ÔÔ” ‘
$strÔÔ‘ ◊
{ÔÔ◊ ÿ
	petEntityÔÔÿ ·
.ÔÔ· ‚
PhotoÔÔ‚ Á
}ÔÔÁ Ë
$strÔÔË Î
{ÔÔÎ Ï
	petEntityÔÔÏ ı
.ÔÔı ˆ
	IsAdoptedÔÔˆ ˇ
}ÔÔˇ Ä
$strÔÔÄ É
"ÔÔÉ Ñ
,ÔÔÑ Ö"
databaseConnectionÔÔÜ ò
)ÔÔò ô
;ÔÔô ö
retorno
 
=
 
commandDatabase
 %
.
% &
ExecuteNonQuery
& 5
(
5 6
)
6 7
;
7 8 
databaseConnection
ÒÒ 
.
ÒÒ 
Close
ÒÒ $
(
ÒÒ$ %
)
ÒÒ% &
;
ÒÒ& '
MySqlConnection
ÙÙ %
databaseConnectionGetId
ÙÙ 3
=
ÙÙ4 5
new
ÙÙ6 9
MySqlConnection
ÙÙ: I
(
ÙÙI J
connectionString
ÙÙJ Z
)
ÙÙZ [
;
ÙÙ[ \
string
ıı 
query
ıı 
=
ıı 
$"
ıı 
$str
ıı >
{
ıı> ?
	petEntity
ıı? H
.
ııH I
Name
ııI M
}
ııM N
$str
ııN Z
{
ııZ [
	petEntity
ıı[ d
.
ııd e
Sex
ııe h
}
ııh i
$str
ııi ~
{
ıı~ 
	petEntityıı à
.ııà â
Descriptionııâ î
}ııî ï
$strııï ó
"ııó ò
;ııò ô
MySqlCommand
ˆˆ "
commandDatabaseGetId
ˆˆ -
=
ˆˆ. /
new
ˆˆ0 3
MySqlCommand
ˆˆ4 @
(
ˆˆ@ A
query
ˆˆA F
,
ˆˆF G%
databaseConnectionGetId
ˆˆH _
)
ˆˆ_ `
;
ˆˆ` a"
commandDatabaseGetId
˜˜  
.
˜˜  !
CommandTimeout
˜˜! /
=
˜˜0 1
$num
˜˜2 4
;
˜˜4 5%
databaseConnectionGetId
¯¯ #
.
¯¯# $
Open
¯¯$ (
(
¯¯( )
)
¯¯) *
;
¯¯* +
MySqlDataReader
˘˘ 
_reader
˘˘ #
=
˘˘$ %"
commandDatabaseGetId
˘˘& :
.
˘˘: ;
ExecuteReader
˘˘; H
(
˘˘H I
)
˘˘I J
;
˘˘J K
if
˙˙ 
(
˙˙ 
_reader
˙˙ 
.
˙˙ 
HasRows
˙˙ 
)
˙˙  
{
˚˚ 
while
¸¸ 
(
¸¸ 
_reader
¸¸ 
.
¸¸ 
Read
¸¸ #
(
¸¸# $
)
¸¸$ %
)
¸¸% &
{
˝˝ 
	petEntity
˛˛ 
.
˛˛ 
Id
˛˛  
=
˛˛! "
_reader
˛˛# *
.
˛˛* +
GetInt32
˛˛+ 3
(
˛˛3 4
$num
˛˛4 5
)
˛˛5 6
;
˛˛6 7
}
ˇˇ %
databaseConnectionGetId
ÄÄ '
.
ÄÄ' (
Close
ÄÄ( -
(
ÄÄ- .
)
ÄÄ. /
;
ÄÄ/ 0
}
ÅÅ 
if
ÉÉ 
(
ÉÉ 
	_firstPet
ÉÉ 
==
ÉÉ 
null
ÉÉ 
&&
ÉÉ !
_lastPet
ÉÉ" *
==
ÉÉ* ,
null
ÉÉ, 0
)
ÉÉ0 1
{
ÑÑ 
	_firstPet
ÖÖ 
=
ÖÖ 
	petEntity
ÖÖ %
;
ÖÖ% &
_lastPet
ÜÜ 
=
ÜÜ 
	petEntity
ÜÜ $
;
ÜÜ$ %
}
áá 
else
àà 
{
ââ 
_lastPet
ää 
.
ää 
next
ää 
=
ää 
	petEntity
ää  )
.
ää) *
Id
ää* ,
;
ää, -
MySqlConnection
ãã &
databaseConnectionUpdate
ãã  8
=
ãã9 :
new
ãã; >
MySqlConnection
ãã? N
(
ããN O
connectionString
ããO _
)
ãã_ `
;
ãã` a&
databaseConnectionUpdate
åå (
.
åå( )
Open
åå) -
(
åå- .
)
åå. /
;
åå/ 0
MySqlCommand
çç 
comando
çç $
=
çç% &
new
çç' *
MySqlCommand
çç+ 7
(
çç7 8
$"
çç8 :
$str
çç: R
{
ççR S
	petEntity
ççS \
.
çç\ ]
Id
çç] _
}
çç_ `
$str
çç` n
{
ççn o
_lastPet
ççp x
.
ççx y
Id
ççy {
}
çç| }
"
çç} ~
,
çç~ (
databaseConnectionUpdateççÄ ò
)ççò ô
;ççô ö
retorno
éé 
=
éé 
comando
éé !
.
éé! "
ExecuteNonQuery
éé" 1
(
éé1 2
)
éé2 3
;
éé3 4&
databaseConnectionUpdate
èè (
.
èè( )
Close
èè) .
(
èè. /
)
èè/ 0
;
èè0 1
	petEntity
ëë 
.
ëë 
previous
ëë "
=
ëë# $
_lastPet
ëë% -
.
ëë- .
Id
ëë. 0
;
ëë0 1
MySqlConnection
íí '
databaseConnectionUpdate2
íí  9
=
íí: ;
new
íí< ?
MySqlConnection
íí@ O
(
ííO P
connectionString
ííP `
)
íí` a
;
íía b'
databaseConnectionUpdate2
ìì )
.
ìì) *
Open
ìì* .
(
ìì. /
)
ìì/ 0
;
ìì0 1
MySqlCommand
îî 
comando2
îî %
=
îî& '
new
îî( +
MySqlCommand
îî, 8
(
îî8 9
$"
îî9 ;
$str
îî; W
{
îîW X
_lastPet
îîX `
.
îî` a
Id
îîa c
}
îîc d
$str
îîd r
{
îîr s
	petEntity
îît }
.
îî} ~
Idîî~ Ä
}îîÅ Ç
"îîÇ É
,îîÉ Ñ)
databaseConnectionUpdate2îîÖ û
)îîû ü
;îîü †
retorno
ïï 
=
ïï 
comando2
ïï "
.
ïï" #
ExecuteNonQuery
ïï# 2
(
ïï2 3
)
ïï3 4
;
ïï4 5'
databaseConnectionUpdate2
ññ )
.
ññ) *
Close
ññ* /
(
ññ/ 0
)
ññ0 1
;
ññ1 2
_lastPet
óó 
=
óó 
	petEntity
óó $
;
óó$ %
}
òò 
return
öö 
	petEntity
öö 
;
öö 
}
õõ 	
public
ùù 
bool
ùù 
	DeletePet
ùù 
(
ùù 
int
ùù !
petId
ùù" '
)
ùù' (
{
ûû 	
int
üü 
retorno
üü 
=
üü 
$num
üü 
;
üü 
bool
†† 
res
†† 
=
†† 
false
†† 
;
†† 
	PetEntity
°° 
thisPet
°° 
=
°° 
GetPet
°°  &
(
°°& '
petId
°°' ,
)
°°, -
;
°°- .
if
§§ 
(
§§ 
thisPet
§§ 
.
§§ 
Id
§§ 
==
§§ 
_lastPet
§§ &
.
§§& '
Id
§§' )
&&
§§* ,
thisPet
§§- 4
.
§§4 5
Id
§§5 7
==
§§8 :
	_firstPet
§§; D
.
§§D E
Id
§§E G
)
§§G H
{
•• 
	_firstPet
¶¶ 
=
¶¶ 
null
¶¶  
;
¶¶  !
_lastPet
ßß 
=
ßß 
null
ßß 
;
ßß  
}
®® 
else
©© 
{
™™ 
if
´´ 
(
´´ 
thisPet
´´ 
.
´´ 
Id
´´ 
==
´´ !
_lastPet
´´" *
.
´´* +
Id
´´+ -
)
´´- .
{
¨¨ 
_lastPet
≠≠ 
=
≠≠ 
GetPetNullable
≠≠ -
(
≠≠- .
thisPet
≠≠. 5
.
≠≠5 6
previous
≠≠6 >
)
≠≠> ?
;
≠≠? @
_lastPet
ÆÆ 
.
ÆÆ 
next
ÆÆ !
=
ÆÆ" #
null
ÆÆ$ (
;
ÆÆ( )
MySqlConnection
∞∞ #'
databaseConnectionUpdate3
∞∞$ =
=
∞∞> ?
new
∞∞@ C
MySqlConnection
∞∞D S
(
∞∞S T
connectionString
∞∞T d
)
∞∞d e
;
∞∞e f'
databaseConnectionUpdate3
±± -
.
±±- .
Open
±±. 2
(
±±2 3
)
±±3 4
;
±±4 5
MySqlCommand
≤≤  
comando3
≤≤! )
=
≤≤* +
new
≤≤, /
MySqlCommand
≤≤0 <
(
≤≤< =
$"
≤≤= ?
$str
≤≤? g
{
≤≤g h
_lastPet
≤≤i q
.
≤≤q r
Id
≤≤r t
}
≤≤u v
"
≤≤v w
,
≤≤w x(
databaseConnectionUpdate3≤≤y í
)≤≤í ì
;≤≤ì î
retorno
≥≥ 
=
≥≥ 
comando3
≥≥ &
.
≥≥& '
ExecuteNonQuery
≥≥' 6
(
≥≥6 7
)
≥≥7 8
;
≥≥8 9'
databaseConnectionUpdate3
¥¥ -
.
¥¥- .
Close
¥¥. 3
(
¥¥3 4
)
¥¥4 5
;
¥¥5 6
}
µµ 
else
∂∂ 
{
∑∑ 
if
∏∏ 
(
∏∏ 
thisPet
∏∏ 
.
∏∏  
Id
∏∏  "
==
∏∏# %
	_firstPet
∏∏& /
.
∏∏/ 0
Id
∏∏0 2
)
∏∏2 3
{
ππ 
	_firstPet
∫∫ !
=
∫∫" #
GetPetNullable
∫∫$ 2
(
∫∫2 3
thisPet
∫∫3 :
.
∫∫: ;
next
∫∫; ?
)
∫∫? @
;
∫∫@ A
	_firstPet
ªª !
.
ªª! "
previous
ªª" *
=
ªª+ ,
null
ªª- 1
;
ªª1 2
MySqlConnection
ºº ''
databaseConnectionUpdate4
ºº( A
=
ººB C
new
ººD G
MySqlConnection
ººH W
(
ººW X
connectionString
ººX h
)
ººh i
;
ººi j'
databaseConnectionUpdate4
ΩΩ 1
.
ΩΩ1 2
Open
ΩΩ2 6
(
ΩΩ6 7
)
ΩΩ7 8
;
ΩΩ8 9
MySqlCommand
ææ $
comando4
ææ% -
=
ææ. /
new
ææ0 3
MySqlCommand
ææ4 @
(
ææ@ A
$"
ææA C
$str
ææC o
{
ææo p
	_firstPet
ææq z
.
ææz {
Id
ææ{ }
}
ææ~ 
"ææ Ä
,ææÄ Å)
databaseConnectionUpdate4ææÇ õ
)ææõ ú
;ææú ù
retorno
øø 
=
øø  !
comando4
øø" *
.
øø* +
ExecuteNonQuery
øø+ :
(
øø: ;
)
øø; <
;
øø< ='
databaseConnectionUpdate4
¿¿ 1
.
¿¿1 2
Close
¿¿2 7
(
¿¿7 8
)
¿¿8 9
;
¿¿9 :
}
¡¡ 
else
¬¬ 
{
√√ 
	PetEntity
ƒƒ !
thisPetNext
ƒƒ" -
=
ƒƒ. /
GetPetNullable
ƒƒ0 >
(
ƒƒ> ?
thisPet
ƒƒ? F
.
ƒƒF G
next
ƒƒG K
)
ƒƒK L
;
ƒƒL M
	PetEntity
≈≈ !
thisPetPrevious
≈≈" 1
=
≈≈2 3
GetPetNullable
≈≈4 B
(
≈≈B C
thisPet
≈≈C J
.
≈≈J K
previous
≈≈K S
)
≈≈S T
;
≈≈T U
thisPetNext
∆∆ #
.
∆∆# $
previous
∆∆$ ,
=
∆∆- .
thisPet
∆∆/ 6
.
∆∆6 7
previous
∆∆7 ?
;
∆∆? @
MySqlConnection
«« ''
databaseConnectionUpdate2
««( A
=
««B C
new
««D G
MySqlConnection
««H W
(
««W X
connectionString
««X h
)
««h i
;
««i j'
databaseConnectionUpdate2
»» 1
.
»»1 2
Open
»»2 6
(
»»6 7
)
»»7 8
;
»»8 9
MySqlCommand
…… $
comando2
……% -
=
……. /
new
……0 3
MySqlCommand
……4 @
(
……@ A
$"
……A C
$str
……C _
{
……_ `
thisPetPrevious
……` o
.
……o p
Id
……p r
}
……r s
$str……s Å
{……Å Ç
thisPetNext……É é
.……é è
Id……è ë
}……í ì
"……ì î
,……î ï)
databaseConnectionUpdate2……ñ Ø
)……Ø ∞
;……∞ ±
retorno
   
=
    !
comando2
  " *
.
  * +
ExecuteNonQuery
  + :
(
  : ;
)
  ; <
;
  < ='
databaseConnectionUpdate2
ÀÀ 1
.
ÀÀ1 2
Close
ÀÀ2 7
(
ÀÀ7 8
)
ÀÀ8 9
;
ÀÀ9 :
thisPetPrevious
ŒŒ '
.
ŒŒ' (
next
ŒŒ( ,
=
ŒŒ- .
thisPet
ŒŒ/ 6
.
ŒŒ6 7
next
ŒŒ7 ;
;
ŒŒ; <
MySqlConnection
œœ '&
databaseConnectionUpdate
œœ( @
=
œœA B
new
œœC F
MySqlConnection
œœG V
(
œœV W
connectionString
œœW g
)
œœg h
;
œœh i&
databaseConnectionUpdate
–– 0
.
––0 1
Open
––1 5
(
––5 6
)
––6 7
;
––7 8
MySqlCommand
—— $
comando
——% ,
=
——- .
new
——/ 2
MySqlCommand
——3 ?
(
——? @
$"
——@ B
$str
——B Z
{
——Z [
thisPetNext
——[ f
.
——f g
Id
——g i
}
——i j
$str
——j x
{
——x y
thisPetPrevious——z â
.——â ä
Id——ä å
}——ç é
"——é è
,——è ê(
databaseConnectionUpdate——ë ©
)——© ™
;——™ ´
retorno
““ 
=
““  !
comando
““" )
.
““) *
ExecuteNonQuery
““* 9
(
““9 :
)
““: ;
;
““; <&
databaseConnectionUpdate
”” 0
.
””0 1
Close
””1 6
(
””6 7
)
””7 8
;
””8 9
}
‘‘ 
}
’’ 
}
÷÷ 
MySqlConnection
⁄⁄  
databaseConnection
⁄⁄ .
=
⁄⁄/ 0
new
⁄⁄1 4
MySqlConnection
⁄⁄5 D
(
⁄⁄D E
connectionString
⁄⁄E U
)
⁄⁄U V
;
⁄⁄V W 
databaseConnection
€€ 
.
€€ 
Open
€€ #
(
€€# $
)
€€$ %
;
€€% &
string
‹‹ 
query
‹‹ 
=
‹‹ 
$"
‹‹ 
$str
‹‹ 8
{
‹‹8 9
petId
‹‹: ?
}
‹‹@ A
"
‹‹A B
;
‹‹B C
MySqlCommand
›› 
commandDatabase
›› (
=
››) *
new
››+ .
MySqlCommand
››/ ;
(
››; <
query
››< A
,
››A B 
databaseConnection
››C U
)
››U V
;
››V W
retorno
ﬁﬁ 
=
ﬁﬁ 
commandDatabase
ﬁﬁ %
.
ﬁﬁ% &
ExecuteNonQuery
ﬁﬁ& 5
(
ﬁﬁ5 6
)
ﬁﬁ6 7
;
ﬁﬁ7 8 
databaseConnection
ﬂﬂ 
.
ﬂﬂ 
Close
ﬂﬂ $
(
ﬂﬂ$ %
)
ﬂﬂ% &
;
ﬂﬂ& '
if
‡‡ 
(
‡‡ 
retorno
‡‡ 
==
‡‡ 
$num
‡‡ 
)
‡‡ 
res
·· 
=
·· 
true
·· 
;
·· 
return
‚‚ 
res
‚‚ 
;
‚‚ 
}
„„ 	
public
ÂÂ 
	PetEntity
ÂÂ 
	UpdatePet
ÂÂ "
(
ÂÂ" #
	PetEntity
ÂÂ# ,
	petEntity
ÂÂ- 6
)
ÂÂ6 7
{
ÊÊ 	
int
ÁÁ 
retorno
ÁÁ 
=
ÁÁ 
$num
ÁÁ 
;
ÁÁ 
var
ÈÈ 
petToUpdate
ÈÈ 
=
ÈÈ 
GetPet
ÈÈ $
(
ÈÈ$ %
	petEntity
ÈÈ% .
.
ÈÈ. /
Id
ÈÈ/ 1
)
ÈÈ1 2
;
ÈÈ2 3
petToUpdate
ÍÍ 
.
ÍÍ 
Name
ÍÍ 
=
ÍÍ 
	petEntity
ÍÍ (
.
ÍÍ( )
Name
ÍÍ) -
??
ÍÍ. 0
petToUpdate
ÍÍ1 <
.
ÍÍ< =
Name
ÍÍ= A
;
ÍÍA B
petToUpdate
ÎÎ 
.
ÎÎ 
Sex
ÎÎ 
=
ÎÎ 
	petEntity
ÎÎ '
.
ÎÎ' (
Sex
ÎÎ( +
??
ÎÎ, .
petToUpdate
ÎÎ/ :
.
ÎÎ: ;
Sex
ÎÎ; >
;
ÎÎ> ?
petToUpdate
ÏÏ 
.
ÏÏ 
Description
ÏÏ #
=
ÏÏ$ %
	petEntity
ÏÏ& /
.
ÏÏ/ 0
Description
ÏÏ0 ;
??
ÏÏ< >
petToUpdate
ÏÏ? J
.
ÏÏJ K
Description
ÏÏK V
;
ÏÏV W
petToUpdate
ÌÌ 
.
ÌÌ 
Size
ÌÌ 
=
ÌÌ 
	petEntity
ÌÌ (
.
ÌÌ( )
Size
ÌÌ) -
??
ÌÌ. 0
petToUpdate
ÌÌ1 <
.
ÌÌ< =
Size
ÌÌ= A
;
ÌÌA B
petToUpdate
ÓÓ 
.
ÓÓ 
Photo
ÓÓ 
=
ÓÓ 
	petEntity
ÓÓ  )
.
ÓÓ) *
Photo
ÓÓ* /
??
ÓÓ0 2
petToUpdate
ÓÓ3 >
.
ÓÓ> ?
Photo
ÓÓ? D
;
ÓÓD E
petToUpdate
ÔÔ 
.
ÔÔ 
Vaccines
ÔÔ  
=
ÔÔ! "
	petEntity
ÔÔ# ,
.
ÔÔ, -
Vaccines
ÔÔ- 5
??
ÔÔ6 8
petToUpdate
ÔÔ9 D
.
ÔÔD E
Vaccines
ÔÔE M
;
ÔÔM N
petToUpdate
 
.
 
Sterilization
 %
=
& '
	petEntity
( 1
.
1 2
Sterilization
2 ?
??
@ B
petToUpdate
C N
.
N O
Sterilization
O \
;
\ ]
petToUpdate
ÒÒ 
.
ÒÒ 
age
ÒÒ 
=
ÒÒ 
	petEntity
ÒÒ '
.
ÒÒ' (
age
ÒÒ( +
??
ÒÒ, .
petToUpdate
ÒÒ/ :
.
ÒÒ: ;
age
ÒÒ; >
;
ÒÒ> ?
petToUpdate
ÚÚ 
.
ÚÚ 
	IsAdopted
ÚÚ !
=
ÚÚ" #
	petEntity
ÚÚ$ -
.
ÚÚ- .
	IsAdopted
ÚÚ. 7
??
ÚÚ8 :
petToUpdate
ÚÚ; F
.
ÚÚF G
	IsAdopted
ÚÚG P
;
ÚÚP Q
int
ÙÙ 
sterilization
ÙÙ 
=
ÙÙ 
(
ÙÙ  !
bool
ÙÙ! %
)
ÙÙ% &
petToUpdate
ÙÙ& 1
.
ÙÙ1 2
Sterilization
ÙÙ2 ?
?
ÙÙ@ A
$num
ÙÙB C
:
ÙÙD E
$num
ÙÙF G
;
ÙÙG H
int
ıı 
	isAdopted
ıı 
=
ıı 
(
ıı 
bool
ıı !
)
ıı! "
petToUpdate
ıı" -
.
ıı- .
	IsAdopted
ıı. 7
?
ıı8 9
$num
ıı: ;
:
ıı< =
$num
ıı> ?
;
ıı? @
MySqlConnection
˜˜  
databaseConnection
˜˜ .
=
˜˜/ 0
new
˜˜1 4
MySqlConnection
˜˜5 D
(
˜˜D E
connectionString
˜˜E U
)
˜˜U V
;
˜˜V W 
databaseConnection
¯¯ 
.
¯¯ 
Open
¯¯ #
(
¯¯# $
)
¯¯$ %
;
¯¯% &
MySqlCommand
˘˘ 
comando
˘˘  
=
˘˘! "
new
˘˘# &
MySqlCommand
˘˘' 3
(
˘˘3 4
$"
˘˘4 6
$str
˘˘6 N
{
˘˘N O
petToUpdate
˘˘O Z
.
˘˘Z [
Name
˘˘[ _
}
˘˘_ `
$str
˘˘` h
{
˘˘h i
petToUpdate
˘˘j u
.
˘˘u v
Sex
˘˘v y
}
˘˘z {
$str˘˘{ ç
{˘˘ç é
petToUpdate˘˘é ô
.˘˘ô ö
Description˘˘ö •
}˘˘• ¶
$str˘˘¶ ±
{˘˘± ≤
petToUpdate˘˘≤ Ω
.˘˘Ω æ
Size˘˘æ ¬
}˘˘¬ √
$str˘˘√ –
{˘˘– —
petToUpdate˘˘— ‹
.˘˘‹ ›
Vaccines˘˘› Â
}˘˘Â Ê
$str˘˘Ê ˆ
{˘˘ˆ ˜
sterilization˘˘˜ Ñ
}˘˘Ñ Ö
$str˘˘Ö é
{˘˘é è
petToUpdate˘˘è ö
.˘˘ö õ
age˘˘õ û
.˘˘û ü
Value˘˘ü §
.˘˘§ •
ToString˘˘• ≠
(˘˘≠ Æ
$str˘˘Æ √
)˘˘√ ƒ
}˘˘ƒ ≈
$str˘˘≈ œ
{˘˘œ –
petToUpdate˘˘– €
.˘˘€ ‹
Photo˘˘‹ ·
}˘˘· ‚
$str˘˘‚ Ô
{˘˘Ô 
	isAdopted˘˘ ˘
}˘˘˘ ˙
$str˘˘˙ á
{˘˘á à
petToUpdate˘˘â î
.˘˘î ï
Id˘˘ï ó
}˘˘ò ô
"˘˘ô ö
,˘˘ö õ"
databaseConnection˘˘ú Æ
)˘˘Æ Ø
;˘˘Ø ∞
retorno
˙˙ 
=
˙˙ 
comando
˙˙ 
.
˙˙ 
ExecuteNonQuery
˙˙ -
(
˙˙- .
)
˙˙. /
;
˙˙/ 0 
databaseConnection
˚˚ 
.
˚˚ 
Close
˚˚ $
(
˚˚$ %
)
˚˚% &
;
˚˚& '
return
¸¸ 
	petEntity
¸¸ 
;
¸¸ 
}
˝˝ 	
public
˛˛ 
IEnumerable
˛˛ 
<
˛˛ 
NoticeEntity
˛˛ '
>
˛˛' (

GetNotices
˛˛) 3
(
˛˛3 4
)
˛˛4 5
{
ˇˇ 	
List
ÄÄ 
<
ÄÄ 
NoticeEntity
ÄÄ 
>
ÄÄ 
notices
ÄÄ &
=
ÄÄ' (
new
ÄÄ) ,
List
ÄÄ- 1
<
ÄÄ1 2
NoticeEntity
ÄÄ2 >
>
ÄÄ> ?
(
ÄÄ? @
)
ÄÄ@ A
;
ÄÄA B
MySqlConnection
ÅÅ  
databaseConnection
ÅÅ .
=
ÅÅ/ 0
new
ÅÅ1 4
MySqlConnection
ÅÅ5 D
(
ÅÅD E
connectionString
ÅÅE U
)
ÅÅU V
;
ÅÅV W
string
ÇÇ 
query
ÇÇ 
=
ÇÇ 
$"
ÇÇ 
$str
ÇÇ 1
"
ÇÇ1 2
;
ÇÇ2 3
MySqlCommand
ÉÉ 
commandDatabase
ÉÉ (
=
ÉÉ) *
new
ÉÉ+ .
MySqlCommand
ÉÉ/ ;
(
ÉÉ; <
query
ÉÉ< A
,
ÉÉA B 
databaseConnection
ÉÉC U
)
ÉÉU V
;
ÉÉV W
commandDatabase
ÑÑ 
.
ÑÑ 
CommandTimeout
ÑÑ *
=
ÑÑ+ ,
$num
ÑÑ- /
;
ÑÑ/ 0 
databaseConnection
ÖÖ 
.
ÖÖ 
Open
ÖÖ #
(
ÖÖ# $
)
ÖÖ$ %
;
ÖÖ% &
MySqlDataReader
ÜÜ 
_reader
ÜÜ #
=
ÜÜ$ %
commandDatabase
ÜÜ& 5
.
ÜÜ5 6
ExecuteReader
ÜÜ6 C
(
ÜÜC D
)
ÜÜD E
;
ÜÜE F
if
áá 
(
áá 
_reader
áá 
.
áá 
HasRows
áá 
)
áá  
{
àà 
while
ââ 
(
ââ 
_reader
ââ 
.
ââ 
Read
ââ #
(
ââ# $
)
ââ$ %
)
ââ% &
{
ää 
NoticeEntity
ãã  
notice
ãã! '
=
ãã( )
new
ãã* -
NoticeEntity
ãã. :
(
ãã: ;
)
ãã; <
;
ãã< =
notice
åå 
.
åå 
id
åå 
=
åå 
_reader
åå  '
.
åå' (
GetInt32
åå( 0
(
åå0 1
$num
åå1 2
)
åå2 3
;
åå3 4
notice
çç 
.
çç 
title
çç  
=
çç! "
_reader
çç# *
.
çç* +
	GetString
çç+ 4
(
çç4 5
$num
çç5 6
)
çç6 7
;
çç7 8
notice
éé 
.
éé 
image
éé  
=
éé! "
_reader
éé# *
.
éé* +
	GetString
éé+ 4
(
éé4 5
$num
éé5 6
)
éé6 7
;
éé7 8
notice
èè 
.
èè 
date
èè 
=
èè  !
_reader
èè" )
.
èè) *
GetDateTime
èè* 5
(
èè5 6
$num
èè6 7
)
èè7 8
;
èè8 9
notices
êê 
.
êê 
Add
êê 
(
êê  
notice
êê  &
)
êê& '
;
êê' (
}
ëë  
databaseConnection
íí "
.
íí" #
Close
íí# (
(
íí( )
)
íí) *
;
íí* +
}
ìì 
return
îî 
notices
îî 
;
îî 
}
ïï 	
public
ññ 
NoticeEntity
ññ 
	GetNotice
ññ %
(
ññ% &
int
ññ& )
noticeId
ññ* 2
)
ññ2 3
{
óó 	
NoticeEntity
òò 
notice
òò 
=
òò  !
new
òò" %
NoticeEntity
òò& 2
(
òò2 3
)
òò3 4
;
òò4 5
MySqlConnection
ôô  
databaseConnection
ôô .
=
ôô/ 0
new
ôô1 4
MySqlConnection
ôô5 D
(
ôôD E
connectionString
ôôE U
)
ôôU V
;
ôôV W
string
öö 
query
öö 
=
öö 
$"
öö 
$str
öö =
{
öö= >
noticeId
öö> F
}
ööF G
"
ööG H
;
ööH I
MySqlCommand
õõ 
commandDatabase
õõ (
=
õõ) *
new
õõ+ .
MySqlCommand
õõ/ ;
(
õõ; <
query
õõ< A
,
õõA B 
databaseConnection
õõC U
)
õõU V
;
õõV W
commandDatabase
úú 
.
úú 
CommandTimeout
úú *
=
úú+ ,
$num
úú- /
;
úú/ 0 
databaseConnection
ùù 
.
ùù 
Open
ùù #
(
ùù# $
)
ùù$ %
;
ùù% &
MySqlDataReader
ûû 
_reader
ûû #
=
ûû$ %
commandDatabase
ûû& 5
.
ûû5 6
ExecuteReader
ûû6 C
(
ûûC D
)
ûûD E
;
ûûE F
if
üü 
(
üü 
_reader
üü 
.
üü 
HasRows
üü 
)
üü  
{
†† 
while
°° 
(
°° 
_reader
°° 
.
°° 
Read
°° #
(
°°# $
)
°°$ %
)
°°% &
{
¢¢ 
notice
££ 
.
££ 
id
££ 
=
££ 
_reader
££  '
.
££' (
GetInt32
££( 0
(
££0 1
$num
££1 2
)
££2 3
;
££3 4
notice
§§ 
.
§§ 
title
§§  
=
§§! "
_reader
§§# *
.
§§* +
	GetString
§§+ 4
(
§§4 5
$num
§§5 6
)
§§6 7
;
§§7 8
notice
•• 
.
•• 
image
••  
=
••! "
_reader
••# *
.
••* +
	GetString
••+ 4
(
••4 5
$num
••5 6
)
••6 7
;
••7 8
notice
¶¶ 
.
¶¶ 
date
¶¶ 
=
¶¶  !
_reader
¶¶" )
.
¶¶) *
GetDateTime
¶¶* 5
(
¶¶5 6
$num
¶¶6 7
)
¶¶7 8
;
¶¶8 9
}
ßß  
databaseConnection
®® "
.
®®" #
Close
®®# (
(
®®( )
)
®®) *
;
®®* +
}
©© 
return
™™ 
notice
™™ 
;
™™ 
}
´´ 	
public
¨¨ 
NoticeEntity
¨¨ 
CreateNotice
¨¨ (
(
¨¨( )
NoticeEntity
¨¨) 5
noticeEntity
¨¨6 B
)
¨¨B C
{
≠≠ 	
int
ÆÆ 
retorno
ÆÆ 
=
ÆÆ 
$num
ÆÆ 
;
ÆÆ 
MySqlConnection
ØØ  
databaseConnection
ØØ .
=
ØØ/ 0
new
ØØ1 4
MySqlConnection
ØØ5 D
(
ØØD E
connectionString
ØØE U
)
ØØU V
;
ØØV W 
databaseConnection
∞∞ 
.
∞∞ 
Open
∞∞ #
(
∞∞# $
)
∞∞$ %
;
∞∞% &
MySqlCommand
±± 
commandDatabase
±± (
=
±±) *
new
±±+ .
MySqlCommand
±±/ ;
(
±±; <
$"
±±< >
$str
±±> o
{
±±o p
noticeEntity
±±p |
.
±±| }
title±±} Ç
}±±Ç É
$str±±É Ü
{±±Ü á
noticeEntity±±á ì
.±±ì î
image±±î ô
}±±ô ö
$str±±ö ù
{±±ù û
noticeEntity±±û ™
.±±™ ´
date±±´ Ø
.±±Ø ∞
Value±±∞ µ
.±±µ ∂
ToString±±∂ æ
(±±æ ø
$str±±ø ‘
)±±‘ ’
}±±’ ÷
$str±±÷ Ÿ
"±±Ÿ ⁄
,±±⁄ €"
databaseConnection±±‹ Ó
)±±Ó Ô
;±±Ô 
retorno
≤≤ 
=
≤≤ 
commandDatabase
≤≤ %
.
≤≤% &
ExecuteNonQuery
≤≤& 5
(
≤≤5 6
)
≤≤6 7
;
≤≤7 8 
databaseConnection
≥≥ 
.
≥≥ 
Close
≥≥ $
(
≥≥$ %
)
≥≥% &
;
≥≥& '
return
¥¥ 
noticeEntity
¥¥ 
;
¥¥  
}
µµ 	
public
∑∑ 
bool
∑∑ 
DeleteNotice
∑∑  
(
∑∑  !
int
∑∑! $
noticeId
∑∑% -
)
∑∑- .
{
∏∏ 	
int
ππ 
retorno
ππ 
;
ππ 
bool
∫∫ 
res
∫∫ 
=
∫∫ 
false
∫∫ 
;
∫∫ 
MySqlConnection
ªª  
databaseConnection
ªª .
=
ªª/ 0
new
ªª1 4
MySqlConnection
ªª5 D
(
ªªD E
connectionString
ªªE U
)
ªªU V
;
ªªV W 
databaseConnection
ºº 
.
ºº 
Open
ºº #
(
ºº# $
)
ºº$ %
;
ºº% &
string
ΩΩ 
query
ΩΩ 
=
ΩΩ 
$"
ΩΩ 
$str
ΩΩ :
{
ΩΩ: ;
noticeId
ΩΩ< D
}
ΩΩE F
"
ΩΩF G
;
ΩΩG H
MySqlCommand
ææ 
commandDatabase
ææ (
=
ææ) *
new
ææ+ .
MySqlCommand
ææ/ ;
(
ææ; <
query
ææ< A
,
ææA B 
databaseConnection
ææC U
)
ææU V
;
ææV W
retorno
øø 
=
øø 
commandDatabase
øø %
.
øø% &
ExecuteNonQuery
øø& 5
(
øø5 6
)
øø6 7
;
øø7 8 
databaseConnection
¿¿ 
.
¿¿ 
Close
¿¿ $
(
¿¿$ %
)
¿¿% &
;
¿¿& '
if
¡¡ 
(
¡¡ 
retorno
¡¡ 
==
¡¡ 
$num
¡¡ 
)
¡¡ 
res
¬¬ 
=
¬¬ 
true
¬¬ 
;
¬¬ 
return
√√ 
res
√√ 
;
√√ 
}
ƒƒ 	
public
∆∆ 
NoticeEntity
∆∆ 
UpdateNotice
∆∆ (
(
∆∆( )
NoticeEntity
∆∆) 5
noticeEntity
∆∆6 B
)
∆∆B C
{
«« 	
int
»» 
retorno
»» 
=
»» 
$num
»» 
;
»» 
var
…… 
noticeToUpdate
…… 
=
……  
	GetNotice
……! *
(
……* +
noticeEntity
……+ 7
.
……7 8
id
……8 :
)
……: ;
;
……; <
noticeToUpdate
   
.
   
title
    
=
  ! "
noticeEntity
  # /
.
  / 0
title
  0 5
??
  6 8
noticeToUpdate
  9 G
.
  G H
title
  H M
;
  M N
noticeToUpdate
ÀÀ 
.
ÀÀ 
image
ÀÀ  
=
ÀÀ! "
noticeEntity
ÀÀ# /
.
ÀÀ/ 0
image
ÀÀ0 5
??
ÀÀ6 8
noticeToUpdate
ÀÀ9 G
.
ÀÀG H
image
ÀÀH M
;
ÀÀM N
noticeToUpdate
ÃÃ 
.
ÃÃ 
date
ÃÃ 
=
ÃÃ  !
noticeEntity
ÃÃ" .
.
ÃÃ. /
date
ÃÃ/ 3
??
ÃÃ4 6
noticeToUpdate
ÃÃ7 E
.
ÃÃE F
date
ÃÃF J
;
ÃÃJ K
MySqlConnection
ŒŒ  
databaseConnection
ŒŒ .
=
ŒŒ/ 0
new
ŒŒ1 4
MySqlConnection
ŒŒ5 D
(
ŒŒD E
connectionString
ŒŒE U
)
ŒŒU V
;
ŒŒV W 
databaseConnection
œœ 
.
œœ 
Open
œœ #
(
œœ# $
)
œœ$ %
;
œœ% &
MySqlCommand
—— 
comando
——  
=
——! "
new
——# &
MySqlCommand
——' 3
(
——3 4
$"
——4 6
$str
——6 Q
{
——Q R
noticeToUpdate
——R `
.
——` a
title
——a f
}
——f g
$str
——g q
{
——q r
noticeToUpdate——r Ä
.——Ä Å
image——Å Ü
}——Ü á
$str——á í
{——í ì
noticeToUpdate——ì °
.——° ¢
date——¢ ¶
.——¶ ß
Value——ß ¨
.——¨ ≠
ToString——≠ µ
(——µ ∂
$str——∂ À
)——À Ã
}——Ã Õ
$str——Õ ⁄
{——⁄ €
noticeToUpdate——€ È
.——È Í
id——Í Ï
}——Ï Ì
"——Ì Ó
,——Ó Ô"
databaseConnection—— Ç
)——Ç É
;——É Ñ
retorno
““ 
=
““ 
comando
““ 
.
““ 
ExecuteNonQuery
““ -
(
““- .
)
““. /
;
““/ 0 
databaseConnection
”” 
.
”” 
Close
”” $
(
””$ %
)
””% &
;
””& '
return
‘‘ 
noticeEntity
‘‘ 
;
‘‘  
}
’’ 	
public
◊◊ 
IEnumerable
◊◊ 
<
◊◊ 
ProductEntity
◊◊ (
>
◊◊( )
GetProducts
◊◊* 5
(
◊◊5 6
)
◊◊6 7
{
ÿÿ 	
List
ŸŸ 
<
ŸŸ 
ProductEntity
ŸŸ 
>
ŸŸ 
petShopItems
ŸŸ  ,
=
ŸŸ- .
new
ŸŸ/ 2
List
ŸŸ3 7
<
ŸŸ7 8
ProductEntity
ŸŸ8 E
>
ŸŸE F
(
ŸŸF G
)
ŸŸG H
;
ŸŸH I
MySqlConnection
⁄⁄  
databaseConnection
⁄⁄ .
=
⁄⁄/ 0
new
⁄⁄1 4
MySqlConnection
⁄⁄5 D
(
⁄⁄D E
connectionString
⁄⁄E U
)
⁄⁄U V
;
⁄⁄V W
string
€€ 
query
€€ 
=
€€ 
$"
€€ 
$str
€€ 2
"
€€2 3
;
€€3 4
MySqlCommand
‹‹ 
commandDatabase
‹‹ (
=
‹‹) *
new
‹‹+ .
MySqlCommand
‹‹/ ;
(
‹‹; <
query
‹‹< A
,
‹‹A B 
databaseConnection
‹‹C U
)
‹‹U V
;
‹‹V W
commandDatabase
›› 
.
›› 
CommandTimeout
›› *
=
››+ ,
$num
››- /
;
››/ 0 
databaseConnection
ﬁﬁ 
.
ﬁﬁ 
Open
ﬁﬁ #
(
ﬁﬁ# $
)
ﬁﬁ$ %
;
ﬁﬁ% &
MySqlDataReader
ﬂﬂ 
_reader
ﬂﬂ #
=
ﬂﬂ$ %
commandDatabase
ﬂﬂ& 5
.
ﬂﬂ5 6
ExecuteReader
ﬂﬂ6 C
(
ﬂﬂC D
)
ﬂﬂD E
;
ﬂﬂE F
if
‡‡ 
(
‡‡ 
_reader
‡‡ 
.
‡‡ 
HasRows
‡‡ 
)
‡‡  
{
·· 
while
‚‚ 
(
‚‚ 
_reader
‚‚ 
.
‚‚ 
Read
‚‚ #
(
‚‚# $
)
‚‚$ %
)
‚‚% &
{
„„ 
ProductEntity
‰‰ !
petShopItem
‰‰" -
=
‰‰. /
new
‰‰0 3
ProductEntity
‰‰4 A
(
‰‰A B
)
‰‰B C
;
‰‰C D
petShopItem
ÂÂ 
.
ÂÂ  
Id
ÂÂ  "
=
ÂÂ# $
_reader
ÂÂ% ,
.
ÂÂ, -
GetInt32
ÂÂ- 5
(
ÂÂ5 6
$num
ÂÂ6 7
)
ÂÂ7 8
;
ÂÂ8 9
petShopItem
ÊÊ 
.
ÊÊ  
ProductName
ÊÊ  +
=
ÊÊ, -
_reader
ÊÊ. 5
.
ÊÊ5 6
	GetString
ÊÊ6 ?
(
ÊÊ? @
$num
ÊÊ@ A
)
ÊÊA B
;
ÊÊB C
petShopItem
ÁÁ 
.
ÁÁ  
Sex
ÁÁ  #
=
ÁÁ$ %
_reader
ÁÁ& -
.
ÁÁ- .
GetChar
ÁÁ. 5
(
ÁÁ5 6
$num
ÁÁ6 7
)
ÁÁ7 8
;
ÁÁ8 9
petShopItem
ËË 
.
ËË  
Photo
ËË  %
=
ËË& '
_reader
ËË( /
.
ËË/ 0
	GetString
ËË0 9
(
ËË9 :
$num
ËË: ;
)
ËË; <
;
ËË< =
petShopItem
ÈÈ 
.
ÈÈ  
Category
ÈÈ  (
=
ÈÈ) *
_reader
ÈÈ+ 2
.
ÈÈ2 3
	GetString
ÈÈ3 <
(
ÈÈ< =
$num
ÈÈ= >
)
ÈÈ> ?
;
ÈÈ? @
petShopItem
ÍÍ 
.
ÍÍ  
	SizeOfPet
ÍÍ  )
=
ÍÍ* +
_reader
ÍÍ, 3
.
ÍÍ3 4
	GetString
ÍÍ4 =
(
ÍÍ= >
$num
ÍÍ> ?
)
ÍÍ? @
;
ÍÍ@ A
petShopItem
ÎÎ 
.
ÎÎ  
Price
ÎÎ  %
=
ÎÎ& '
_reader
ÎÎ( /
.
ÎÎ/ 0
	GetString
ÎÎ0 9
(
ÎÎ9 :
$num
ÎÎ: ;
)
ÎÎ; <
;
ÎÎ< =
petShopItem
ÏÏ 
.
ÏÏ  
Stock
ÏÏ  %
=
ÏÏ& '
_reader
ÏÏ( /
.
ÏÏ/ 0
GetInt32
ÏÏ0 8
(
ÏÏ8 9
$num
ÏÏ9 :
)
ÏÏ: ;
;
ÏÏ; <
petShopItems
ÌÌ  
.
ÌÌ  !
Add
ÌÌ! $
(
ÌÌ$ %
petShopItem
ÌÌ% 0
)
ÌÌ0 1
;
ÌÌ1 2
}
ÓÓ  
databaseConnection
ÔÔ "
.
ÔÔ" #
Close
ÔÔ# (
(
ÔÔ( )
)
ÔÔ) *
;
ÔÔ* +
}
 
return
ÒÒ 
petShopItems
ÒÒ 
;
ÒÒ  
}
ÚÚ 	
public
ÛÛ 
ProductEntity
ÛÛ 

GetProduct
ÛÛ '
(
ÛÛ' (
int
ÛÛ( +
ItemId
ÛÛ, 2
)
ÛÛ2 3
{
ÙÙ 	
ProductEntity
ıı 
petShopItem
ıı %
=
ıı& '
new
ıı( +
ProductEntity
ıı, 9
(
ıı9 :
)
ıı: ;
;
ıı; <
MySqlConnection
ˆˆ  
databaseConnection
ˆˆ .
=
ˆˆ/ 0
new
ˆˆ1 4
MySqlConnection
ˆˆ5 D
(
ˆˆD E
connectionString
ˆˆE U
)
ˆˆU V
;
ˆˆV W
string
˜˜ 
query
˜˜ 
=
˜˜ 
$"
˜˜ 
$str
˜˜ >
{
˜˜> ?
ItemId
˜˜? E
}
˜˜E F
"
˜˜F G
;
˜˜G H
MySqlCommand
¯¯ 
commandDatabase
¯¯ (
=
¯¯) *
new
¯¯+ .
MySqlCommand
¯¯/ ;
(
¯¯; <
query
¯¯< A
,
¯¯A B 
databaseConnection
¯¯C U
)
¯¯U V
;
¯¯V W
commandDatabase
˘˘ 
.
˘˘ 
CommandTimeout
˘˘ *
=
˘˘+ ,
$num
˘˘- /
;
˘˘/ 0 
databaseConnection
˙˙ 
.
˙˙ 
Open
˙˙ #
(
˙˙# $
)
˙˙$ %
;
˙˙% &
MySqlDataReader
˚˚ 
_reader
˚˚ #
=
˚˚$ %
commandDatabase
˚˚& 5
.
˚˚5 6
ExecuteReader
˚˚6 C
(
˚˚C D
)
˚˚D E
;
˚˚E F
if
¸¸ 
(
¸¸ 
_reader
¸¸ 
.
¸¸ 
HasRows
¸¸ 
)
¸¸  
{
˝˝ 
while
˛˛ 
(
˛˛ 
_reader
˛˛ 
.
˛˛ 
Read
˛˛ #
(
˛˛# $
)
˛˛$ %
)
˛˛% &
{
ˇˇ 
petShopItem
ÄÄ 
.
ÄÄ  
Id
ÄÄ  "
=
ÄÄ# $
_reader
ÄÄ% ,
.
ÄÄ, -
GetInt32
ÄÄ- 5
(
ÄÄ5 6
$num
ÄÄ6 7
)
ÄÄ7 8
;
ÄÄ8 9
petShopItem
ÅÅ 
.
ÅÅ  
ProductName
ÅÅ  +
=
ÅÅ, -
_reader
ÅÅ. 5
.
ÅÅ5 6
	GetString
ÅÅ6 ?
(
ÅÅ? @
$num
ÅÅ@ A
)
ÅÅA B
;
ÅÅB C
petShopItem
ÇÇ 
.
ÇÇ  
Sex
ÇÇ  #
=
ÇÇ$ %
_reader
ÇÇ& -
.
ÇÇ- .
GetChar
ÇÇ. 5
(
ÇÇ5 6
$num
ÇÇ6 7
)
ÇÇ7 8
;
ÇÇ8 9
petShopItem
ÉÉ 
.
ÉÉ  
Photo
ÉÉ  %
=
ÉÉ& '
_reader
ÉÉ( /
.
ÉÉ/ 0
	GetString
ÉÉ0 9
(
ÉÉ9 :
$num
ÉÉ: ;
)
ÉÉ; <
;
ÉÉ< =
petShopItem
ÑÑ 
.
ÑÑ  
Category
ÑÑ  (
=
ÑÑ) *
_reader
ÑÑ+ 2
.
ÑÑ2 3
	GetString
ÑÑ3 <
(
ÑÑ< =
$num
ÑÑ= >
)
ÑÑ> ?
;
ÑÑ? @
petShopItem
ÖÖ 
.
ÖÖ  
	SizeOfPet
ÖÖ  )
=
ÖÖ* +
_reader
ÖÖ, 3
.
ÖÖ3 4
	GetString
ÖÖ4 =
(
ÖÖ= >
$num
ÖÖ> ?
)
ÖÖ? @
;
ÖÖ@ A
petShopItem
ÜÜ 
.
ÜÜ  
Price
ÜÜ  %
=
ÜÜ& '
_reader
ÜÜ( /
.
ÜÜ/ 0
	GetString
ÜÜ0 9
(
ÜÜ9 :
$num
ÜÜ: ;
)
ÜÜ; <
;
ÜÜ< =
petShopItem
áá 
.
áá  
Stock
áá  %
=
áá& '
_reader
áá( /
.
áá/ 0
GetInt32
áá0 8
(
áá8 9
$num
áá9 :
)
áá: ;
;
áá; <
}
àà  
databaseConnection
ââ "
.
ââ" #
Close
ââ# (
(
ââ( )
)
ââ) *
;
ââ* +
}
ää 
return
ãã 
petShopItem
ãã 
;
ãã 
}
åå 	
public
çç 
ProductEntity
çç 
CreateProduct
çç *
(
çç* +
ProductEntity
çç+ 8
petShopEntity
çç9 F
)
ççF G
{
éé 	
int
èè 
retorno
èè 
=
èè 
$num
èè 
;
èè 
MySqlConnection
êê  
databaseConnection
êê .
=
êê/ 0
new
êê1 4
MySqlConnection
êê5 D
(
êêD E
connectionString
êêE U
)
êêU V
;
êêV W 
databaseConnection
ëë 
.
ëë 
Open
ëë #
(
ëë# $
)
ëë$ %
;
ëë% &
MySqlCommand
íí 
commandDatabase
íí (
=
íí) *
new
íí+ .
MySqlCommand
íí/ ;
(
íí; <
$"
íí< >
$stríí> ò
{ííò ô
petShopEntityííô ¶
.íí¶ ß
ProductNameííß ≤
}íí≤ ≥
$stríí≥ ∂
{íí∂ ∑
petShopEntityíí∑ ƒ
.ííƒ ≈
Sexíí≈ »
}íí» …
$stríí… Ã
{ííÃ Õ
petShopEntityííÕ ⁄
.íí⁄ €
Photoíí€ ‡
}íí‡ ·
$stríí· ‰
{íí‰ Â
petShopEntityííÂ Ú
.ííÚ Û
CategoryííÛ ˚
}íí˚ ¸
$stríí¸ ˇ
{ííˇ Ä
petShopEntityííÄ ç
.ííç é
	SizeOfPetííé ó
}ííó ò
$strííò õ
{ííõ ú
petShopEntityííú ©
.íí© ™
Priceíí™ Ø
}ííØ ∞
$stríí∞ ≤
{íí≤ ≥
petShopEntityíí≥ ¿
.íí¿ ¡
Stockíí¡ ∆
}íí∆ «
$stríí« »
"íí» …
,íí…  "
databaseConnectionííÀ ›
)íí› ﬁ
;ííﬁ ﬂ
retorno
ìì 
=
ìì 
commandDatabase
ìì %
.
ìì% &
ExecuteNonQuery
ìì& 5
(
ìì5 6
)
ìì6 7
;
ìì7 8 
databaseConnection
îî 
.
îî 
Close
îî $
(
îî$ %
)
îî% &
;
îî& '
return
ïï 
petShopEntity
ïï  
;
ïï  !
}
ññ 	
public
òò 
bool
òò 
DeleteProduct
òò !
(
òò! "
int
òò" %
ItemId
òò& ,
)
òò, -
{
ôô 	
int
öö 
retorno
öö 
;
öö 
bool
õõ 
res
õõ 
=
õõ 
false
õõ 
;
õõ 
MySqlConnection
úú  
databaseConnection
úú .
=
úú/ 0
new
úú1 4
MySqlConnection
úú5 D
(
úúD E
connectionString
úúE U
)
úúU V
;
úúV W 
databaseConnection
ùù 
.
ùù 
Open
ùù #
(
ùù# $
)
ùù$ %
;
ùù% &
string
ûû 
query
ûû 
=
ûû 
$"
ûû 
$str
ûû ;
{
ûû; <
ItemId
ûû= C
}
ûûD E
"
ûûE F
;
ûûF G
MySqlCommand
üü 
commandDatabase
üü (
=
üü) *
new
üü+ .
MySqlCommand
üü/ ;
(
üü; <
query
üü< A
,
üüA B 
databaseConnection
üüC U
)
üüU V
;
üüV W
retorno
†† 
=
†† 
commandDatabase
†† %
.
††% &
ExecuteNonQuery
††& 5
(
††5 6
)
††6 7
;
††7 8 
databaseConnection
°° 
.
°° 
Close
°° $
(
°°$ %
)
°°% &
;
°°& '
if
¢¢ 
(
¢¢ 
retorno
¢¢ 
==
¢¢ 
$num
¢¢ 
)
¢¢ 
res
££ 
=
££ 
true
££ 
;
££ 
return
§§ 
res
§§ 
;
§§ 
}
•• 	
public
ßß 
ProductEntity
ßß 
UpdateProduct
ßß *
(
ßß* +
ProductEntity
ßß+ 8
petShopEntity
ßß9 F
)
ßßF G
{
®® 	
int
©© 
retorno
©© 
=
©© 
$num
©© 
;
©© 
var
™™ !
petShopItemToUpdate
™™ #
=
™™$ %

GetProduct
™™& 0
(
™™0 1
petShopEntity
™™1 >
.
™™> ?
Id
™™? A
)
™™A B
;
™™B C!
petShopItemToUpdate
´´ 
.
´´  
ProductName
´´  +
=
´´, -
petShopEntity
´´. ;
.
´´; <
ProductName
´´< G
??
´´H J!
petShopItemToUpdate
´´K ^
.
´´^ _
ProductName
´´_ j
;
´´j k!
petShopItemToUpdate
¨¨ 
.
¨¨  
Sex
¨¨  #
=
¨¨$ %
petShopEntity
¨¨& 3
.
¨¨3 4
Sex
¨¨4 7
??
¨¨8 :!
petShopItemToUpdate
¨¨; N
.
¨¨N O
Sex
¨¨O R
;
¨¨R S!
petShopItemToUpdate
≠≠ 
.
≠≠  
Photo
≠≠  %
=
≠≠& '
petShopEntity
≠≠( 5
.
≠≠5 6
Photo
≠≠6 ;
??
≠≠< >!
petShopItemToUpdate
≠≠? R
.
≠≠R S
Photo
≠≠S X
;
≠≠X Y!
petShopItemToUpdate
ÆÆ 
.
ÆÆ  
Category
ÆÆ  (
=
ÆÆ) *
petShopEntity
ÆÆ+ 8
.
ÆÆ8 9
Category
ÆÆ9 A
??
ÆÆB D!
petShopItemToUpdate
ÆÆE X
.
ÆÆX Y
Category
ÆÆY a
;
ÆÆa b!
petShopItemToUpdate
ØØ 
.
ØØ  
	SizeOfPet
ØØ  )
=
ØØ* +
petShopEntity
ØØ, 9
.
ØØ9 :
	SizeOfPet
ØØ: C
??
ØØD F!
petShopItemToUpdate
ØØG Z
.
ØØZ [
	SizeOfPet
ØØ[ d
;
ØØd e!
petShopItemToUpdate
∞∞ 
.
∞∞  
Price
∞∞  %
=
∞∞& '
petShopEntity
∞∞( 5
.
∞∞5 6
Price
∞∞6 ;
??
∞∞< >!
petShopItemToUpdate
∞∞? R
.
∞∞R S
Price
∞∞S X
;
∞∞X Y!
petShopItemToUpdate
±± 
.
±±  
Stock
±±  %
=
±±& '
petShopEntity
±±( 5
.
±±5 6
Stock
±±6 ;
??
±±< >!
petShopItemToUpdate
±±? R
.
±±R S
Stock
±±S X
;
±±X Y
MySqlConnection
≥≥  
databaseConnection
≥≥ .
=
≥≥/ 0
new
≥≥1 4
MySqlConnection
≥≥5 D
(
≥≥D E
connectionString
≥≥E U
)
≥≥U V
;
≥≥V W 
databaseConnection
¥¥ 
.
¥¥ 
Open
¥¥ #
(
¥¥# $
)
¥¥$ %
;
¥¥% &
MySqlCommand
µµ 
comando
µµ  
=
µµ! "
new
µµ# &
MySqlCommand
µµ' 3
(
µµ3 4
$"
µµ4 6
$str
µµ6 X
{
µµX Y!
petShopItemToUpdate
µµY l
.
µµl m
ProductName
µµm x
}
µµx y
$strµµy Å
{µµÅ Ç#
petShopItemToUpdateµµÇ ï
.µµï ñ
Sexµµñ ô
}µµô ö
$strµµö ¶
{µµ¶ ß#
petShopItemToUpdateµµß ∫
.µµ∫ ª
Photoµµª ¿
}µµ¿ ¡
$strµµ¡ –
{µµ– —#
petShopItemToUpdateµµ— ‰
.µµ‰ Â
CategoryµµÂ Ì
}µµÌ Ó
$strµµÓ ˛
{µµ˛ ˇ#
petShopItemToUpdateµµˇ í
.µµí ì
	SizeOfPetµµì ú
}µµú ù
$strµµù ©
{µµ© ™#
petShopItemToUpdateµµ™ Ω
.µµΩ æ
Priceµµæ √
}µµ√ ƒ
$strµµƒ –
{µµ– —#
petShopItemToUpdateµµ— ‰
.µµ‰ Â
StockµµÂ Í
}µµÍ Î
$strµµÎ ¯
{µµ¯ ˘#
petShopItemToUpdateµµ˘ å
.µµå ç
Idµµç è
}µµè ê
"µµê ë
,µµë í"
databaseConnectionµµì •
)µµ• ¶
;µµ¶ ß
retorno
∂∂ 
=
∂∂ 
comando
∂∂ 
.
∂∂ 
ExecuteNonQuery
∂∂ -
(
∂∂- .
)
∂∂. /
;
∂∂/ 0 
databaseConnection
∑∑ 
.
∑∑ 
Close
∑∑ $
(
∑∑$ %
)
∑∑% &
;
∑∑& '
return
∏∏ 
petShopEntity
∏∏  
;
∏∏  !
}
ππ 	
public
∫∫ 
IEnumerable
∫∫ 
<
∫∫ 
	UserModel
∫∫ $
>
∫∫$ %
GetUsers
∫∫& .
(
∫∫. /
)
∫∫/ 0
{
ªª 	
List
ºº 
<
ºº 
	UserModel
ºº 
>
ºº 
users
ºº !
=
ºº" #
new
ºº$ '
List
ºº( ,
<
ºº, -
	UserModel
ºº- 6
>
ºº6 7
(
ºº7 8
)
ºº8 9
;
ºº9 :
MySqlConnection
ΩΩ  
databaseConnection
ΩΩ .
=
ΩΩ/ 0
new
ΩΩ1 4
MySqlConnection
ΩΩ5 D
(
ΩΩD E
connectionString
ΩΩE U
)
ΩΩU V
;
ΩΩV W
string
ææ 
query
ææ 
=
ææ 
$"
ææ 
$str
ææ 6
"
ææ6 7
;
ææ7 8
MySqlCommand
øø 
commandDatabase
øø (
=
øø) *
new
øø+ .
MySqlCommand
øø/ ;
(
øø; <
query
øø< A
,
øøA B 
databaseConnection
øøC U
)
øøU V
;
øøV W
commandDatabase
¿¿ 
.
¿¿ 
CommandTimeout
¿¿ *
=
¿¿+ ,
$num
¿¿- /
;
¿¿/ 0 
databaseConnection
¡¡ 
.
¡¡ 
Open
¡¡ #
(
¡¡# $
)
¡¡$ %
;
¡¡% &
MySqlDataReader
¬¬ 
_reader
¬¬ #
=
¬¬$ %
commandDatabase
¬¬& 5
.
¬¬5 6
ExecuteReader
¬¬6 C
(
¬¬C D
)
¬¬D E
;
¬¬E F
if
√√ 
(
√√ 
_reader
√√ 
.
√√ 
HasRows
√√ 
)
√√  
{
ƒƒ 
while
≈≈ 
(
≈≈ 
_reader
≈≈ 
.
≈≈ 
Read
≈≈ #
(
≈≈# $
)
≈≈$ %
)
≈≈% &
{
∆∆ 
	UserModel
«« 
user
«« "
=
««# $
new
««% (
	UserModel
««) 2
(
««2 3
)
««3 4
;
««4 5
user
»» 
.
»» 
Id
»» 
=
»» 
_reader
»» %
.
»»% &
	GetString
»»& /
(
»»/ 0
$num
»»0 1
)
»»1 2
;
»»2 3
user
…… 
.
…… 
UserName
…… !
=
……" #
_reader
……$ +
.
……+ ,
	GetString
……, 5
(
……5 6
$num
……6 7
)
……7 8
;
……8 9
user
   
.
   
Email
   
=
    
_reader
  ! (
.
  ( )
	GetString
  ) 2
(
  2 3
$num
  3 4
)
  4 5
;
  5 6
user
ÀÀ 
.
ÀÀ 
PasswordHash
ÀÀ %
=
ÀÀ& '
_reader
ÀÀ( /
.
ÀÀ/ 0
	GetString
ÀÀ0 9
(
ÀÀ9 :
$num
ÀÀ: ;
)
ÀÀ; <
;
ÀÀ< =
users
ÃÃ 
.
ÃÃ 
Add
ÃÃ 
(
ÃÃ 
user
ÃÃ "
)
ÃÃ" #
;
ÃÃ# $
}
ÕÕ  
databaseConnection
ŒŒ "
.
ŒŒ" #
Close
ŒŒ# (
(
ŒŒ( )
)
ŒŒ) *
;
ŒŒ* +
}
œœ 
return
–– 
users
–– 
;
–– 
}
—— 	
}
”” 
}‘‘ Í
ÑD:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Exceptions\BadRequestException.cs
	namespace 	
BackEndAlbergue
 
. 

Exceptions $
{ 
public 

class 
BadRequestException $
:$ %
	Exception% .
{		 
public

 
BadRequestException

 "
(

" #
string

# )
ex

* ,
)

, -
:

- .
base

. 2
(

2 3
ex

3 5
)

5 6
{ 	
} 	
} 
} ‰
ÇD:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Exceptions\NotFoundException.cs
	namespace 	
BackEndAlbergue
 
. 

Exceptions $
{ 
public 

class 
NotFoundException "
:" #
	Exception# ,
{		 
public

 
NotFoundException

  
(

  !
string

! '
ex

( *
)

* +
:

+ ,
base

, 0
(

0 1
ex

1 3
)

3 4
{ 	
} 	
} 
} ˘/
ÑD:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Migrations\20210412171157_init.cs
	namespace 	
BackEndAlbergue
 
. 

Migrations $
{ 
public 

partial 
class 
init 
: 
	Migration  )
{ 
	protected		 
override		 
void		 
Up		  "
(		" #
MigrationBuilder		# 3
migrationBuilder		4 D
)		D E
{

 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
columns 
: 
table 
=> !
new" %
{ 
id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
nullable+ 3
:3 4
false5 :
): ;
. 

Annotation #
(# $
$str$ C
,C D(
MySqlValueGenerationStrategyE a
.a b
IdentityColumnb p
)p q
,q r
title 
= 
table !
.! "
Column" (
<( )
string) /
>/ 0
(0 1
nullable1 9
:9 :
false; @
)@ A
,A B
image 
= 
table !
.! "
Column" (
<( )
string) /
>/ 0
(0 1
nullable1 9
:9 :
true; ?
)? @
,@ A
date 
= 
table  
.  !
Column! '
<' (
DateTime( 0
>0 1
(1 2
nullable2 :
:: ;
false< A
)A B
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 0
,0 1
x2 3
=>4 6
x7 8
.8 9
id9 ;
); <
;< =
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
nullable+ 3
:3 4
false5 :
): ;
. 

Annotation #
(# $
$str$ C
,C D(
MySqlValueGenerationStrategyE a
.a b
IdentityColumnb p
)p q
,q r
Name   
=   
table    
.    !
Column  ! '
<  ' (
string  ( .
>  . /
(  / 0
nullable  0 8
:  8 9
false  : ?
)  ? @
,  @ A
Sex!! 
=!! 
table!! 
.!!  
Column!!  &
<!!& '
string!!' -
>!!- .
(!!. /
nullable!!/ 7
:!!7 8
true!!9 =
)!!= >
,!!> ?
Description"" 
=""  !
table""" '
.""' (
Column""( .
<"". /
string""/ 5
>""5 6
(""6 7
	maxLength""7 @
:""@ A
$num""B D
,""D E
nullable""F N
:""N O
true""P T
)""T U
,""U V
Photo## 
=## 
table## !
.##! "
Column##" (
<##( )
string##) /
>##/ 0
(##0 1
nullable##1 9
:##9 :
true##; ?
)##? @
,##@ A
Vaccines$$ 
=$$ 
table$$ $
.$$$ %
Column$$% +
<$$+ ,
string$$, 2
>$$2 3
($$3 4
nullable$$4 <
:$$< =
true$$> B
)$$B C
,$$C D
Sterilization%% !
=%%" #
table%%$ )
.%%) *
Column%%* 0
<%%0 1
bool%%1 5
>%%5 6
(%%6 7
nullable%%7 ?
:%%? @
true%%A E
)%%E F
,%%F G
Size&& 
=&& 
table&&  
.&&  !
Column&&! '
<&&' (
string&&( .
>&&. /
(&&/ 0
nullable&&0 8
:&&8 9
true&&: >
)&&> ?
,&&? @
age'' 
='' 
table'' 
.''  
Column''  &
<''& '
int''' *
>''* +
(''+ ,
nullable'', 4
:''4 5
true''6 :
)'': ;
,''; <
	IsAdopted(( 
=(( 
table((  %
.((% &
Column((& ,
<((, -
bool((- 1
>((1 2
(((2 3
nullable((3 ;
:((; <
true((= A
)((A B
})) 
,)) 
constraints** 
:** 
table** "
=>**# %
{++ 
table,, 
.,, 

PrimaryKey,, $
(,,$ %
$str,,% .
,,,. /
x,,0 1
=>,,2 4
x,,5 6
.,,6 7
Id,,7 9
),,9 :
;,,: ;
}-- 
)-- 
;-- 
}.. 	
	protected00 
override00 
void00 
Down00  $
(00$ %
MigrationBuilder00% 5
migrationBuilder006 F
)00F G
{11 	
migrationBuilder22 
.22 
	DropTable22 &
(22& '
name33 
:33 
$str33 
)33 
;33  
migrationBuilder55 
.55 
	DropTable55 &
(55& '
name66 
:66 
$str66 
)66 
;66 
}77 	
}88 
}99 ∑≤
çD:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Migrations\20210417233605_addedIdentity.cs
	namespace 	
BackEndAlbergue
 
. 

Migrations $
{ 
public 

partial 
class 
addedIdentity &
:' (
	Migration) 2
{ 
	protected		 
override		 
void		 
Up		  "
(		" #
MigrationBuilder		# 3
migrationBuilder		4 D
)		D E
{

 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str #
,# $
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
string& ,
>, -
(- .
nullable. 6
:6 7
false8 =
)= >
,> ?
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
	maxLength0 9
:9 :
$num; >
,> ?
nullable@ H
:H I
trueJ N
)N O
,O P
NormalizedName "
=# $
table% *
.* +
Column+ 1
<1 2
string2 8
>8 9
(9 :
	maxLength: C
:C D
$numE H
,H I
nullableJ R
:R S
trueT X
)X Y
,Y Z
ConcurrencyStamp $
=% &
table' ,
., -
Column- 3
<3 4
string4 :
>: ;
(; <
nullable< D
:D E
trueF J
)J K
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 5
,5 6
x7 8
=>9 ;
x< =
.= >
Id> @
)@ A
;A B
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str #
,# $
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
string& ,
>, -
(- .
nullable. 6
:6 7
false8 =
)= >
,> ?
UserName 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
	maxLength4 =
:= >
$num? B
,B C
nullableD L
:L M
trueN R
)R S
,S T
NormalizedUserName &
=' (
table) .
.. /
Column/ 5
<5 6
string6 <
>< =
(= >
	maxLength> G
:G H
$numI L
,L M
nullableN V
:V W
trueX \
)\ ]
,] ^
Email   
=   
table   !
.  ! "
Column  " (
<  ( )
string  ) /
>  / 0
(  0 1
	maxLength  1 :
:  : ;
$num  < ?
,  ? @
nullable  A I
:  I J
true  K O
)  O P
,  P Q
NormalizedEmail!! #
=!!$ %
table!!& +
.!!+ ,
Column!!, 2
<!!2 3
string!!3 9
>!!9 :
(!!: ;
	maxLength!!; D
:!!D E
$num!!F I
,!!I J
nullable!!K S
:!!S T
true!!U Y
)!!Y Z
,!!Z [
EmailConfirmed"" "
=""# $
table""% *
.""* +
Column""+ 1
<""1 2
bool""2 6
>""6 7
(""7 8
nullable""8 @
:""@ A
false""B G
)""G H
,""H I
PasswordHash##  
=##! "
table### (
.##( )
Column##) /
<##/ 0
string##0 6
>##6 7
(##7 8
nullable##8 @
:##@ A
true##B F
)##F G
,##G H
SecurityStamp$$ !
=$$" #
table$$$ )
.$$) *
Column$$* 0
<$$0 1
string$$1 7
>$$7 8
($$8 9
nullable$$9 A
:$$A B
true$$C G
)$$G H
,$$H I
ConcurrencyStamp%% $
=%%% &
table%%' ,
.%%, -
Column%%- 3
<%%3 4
string%%4 :
>%%: ;
(%%; <
nullable%%< D
:%%D E
true%%F J
)%%J K
,%%K L
PhoneNumber&& 
=&&  !
table&&" '
.&&' (
Column&&( .
<&&. /
string&&/ 5
>&&5 6
(&&6 7
nullable&&7 ?
:&&? @
true&&A E
)&&E F
,&&F G 
PhoneNumberConfirmed'' (
='') *
table''+ 0
.''0 1
Column''1 7
<''7 8
bool''8 <
>''< =
(''= >
nullable''> F
:''F G
false''H M
)''M N
,''N O
TwoFactorEnabled(( $
=((% &
table((' ,
.((, -
Column((- 3
<((3 4
bool((4 8
>((8 9
(((9 :
nullable((: B
:((B C
false((D I
)((I J
,((J K

LockoutEnd)) 
=))  
table))! &
.))& '
Column))' -
<))- .
DateTimeOffset)). <
>))< =
())= >
nullable))> F
:))F G
true))H L
)))L M
,))M N
LockoutEnabled** "
=**# $
table**% *
.*** +
Column**+ 1
<**1 2
bool**2 6
>**6 7
(**7 8
nullable**8 @
:**@ A
false**B G
)**G H
,**H I
AccessFailedCount++ %
=++& '
table++( -
.++- .
Column++. 4
<++4 5
int++5 8
>++8 9
(++9 :
nullable++: B
:++B C
false++D I
)++I J
},, 
,,, 
constraints-- 
:-- 
table-- "
=>--# %
{.. 
table// 
.// 

PrimaryKey// $
(//$ %
$str//% 5
,//5 6
x//7 8
=>//9 ;
x//< =
.//= >
Id//> @
)//@ A
;//A B
}00 
)00 
;00 
migrationBuilder22 
.22 
CreateTable22 (
(22( )
name33 
:33 
$str33 (
,33( )
columns44 
:44 
table44 
=>44 !
new44" %
{55 
Id66 
=66 
table66 
.66 
Column66 %
<66% &
int66& )
>66) *
(66* +
nullable66+ 3
:663 4
false665 :
)66: ;
.77 

Annotation77 #
(77# $
$str77$ C
,77C D(
MySqlValueGenerationStrategy77E a
.77a b
IdentityColumn77b p
)77p q
,77q r
RoleId88 
=88 
table88 "
.88" #
Column88# )
<88) *
string88* 0
>880 1
(881 2
nullable882 :
:88: ;
false88< A
)88A B
,88B C
	ClaimType99 
=99 
table99  %
.99% &
Column99& ,
<99, -
string99- 3
>993 4
(994 5
nullable995 =
:99= >
true99? C
)99C D
,99D E

ClaimValue:: 
=::  
table::! &
.::& '
Column::' -
<::- .
string::. 4
>::4 5
(::5 6
nullable::6 >
:::> ?
true::@ D
)::D E
};; 
,;; 
constraints<< 
:<< 
table<< "
=><<# %
{== 
table>> 
.>> 

PrimaryKey>> $
(>>$ %
$str>>% :
,>>: ;
x>>< =
=>>>> @
x>>A B
.>>B C
Id>>C E
)>>E F
;>>F G
table?? 
.?? 

ForeignKey?? $
(??$ %
name@@ 
:@@ 
$str@@ F
,@@F G
columnAA 
:AA 
xAA  !
=>AA" $
xAA% &
.AA& '
RoleIdAA' -
,AA- .
principalTableBB &
:BB& '
$strBB( 5
,BB5 6
principalColumnCC '
:CC' (
$strCC) -
,CC- .
onDeleteDD  
:DD  !
ReferentialActionDD" 3
.DD3 4
CascadeDD4 ;
)DD; <
;DD< =
}EE 
)EE 
;EE 
migrationBuilderGG 
.GG 
CreateTableGG (
(GG( )
nameHH 
:HH 
$strHH (
,HH( )
columnsII 
:II 
tableII 
=>II !
newII" %
{JJ 
IdKK 
=KK 
tableKK 
.KK 
ColumnKK %
<KK% &
intKK& )
>KK) *
(KK* +
nullableKK+ 3
:KK3 4
falseKK5 :
)KK: ;
.LL 

AnnotationLL #
(LL# $
$strLL$ C
,LLC D(
MySqlValueGenerationStrategyLLE a
.LLa b
IdentityColumnLLb p
)LLp q
,LLq r
UserIdMM 
=MM 
tableMM "
.MM" #
ColumnMM# )
<MM) *
stringMM* 0
>MM0 1
(MM1 2
nullableMM2 :
:MM: ;
falseMM< A
)MMA B
,MMB C
	ClaimTypeNN 
=NN 
tableNN  %
.NN% &
ColumnNN& ,
<NN, -
stringNN- 3
>NN3 4
(NN4 5
nullableNN5 =
:NN= >
trueNN? C
)NNC D
,NND E

ClaimValueOO 
=OO  
tableOO! &
.OO& '
ColumnOO' -
<OO- .
stringOO. 4
>OO4 5
(OO5 6
nullableOO6 >
:OO> ?
trueOO@ D
)OOD E
}PP 
,PP 
constraintsQQ 
:QQ 
tableQQ "
=>QQ# %
{RR 
tableSS 
.SS 

PrimaryKeySS $
(SS$ %
$strSS% :
,SS: ;
xSS< =
=>SS> @
xSSA B
.SSB C
IdSSC E
)SSE F
;SSF G
tableTT 
.TT 

ForeignKeyTT $
(TT$ %
nameUU 
:UU 
$strUU F
,UUF G
columnVV 
:VV 
xVV  !
=>VV" $
xVV% &
.VV& '
UserIdVV' -
,VV- .
principalTableWW &
:WW& '
$strWW( 5
,WW5 6
principalColumnXX '
:XX' (
$strXX) -
,XX- .
onDeleteYY  
:YY  !
ReferentialActionYY" 3
.YY3 4
CascadeYY4 ;
)YY; <
;YY< =
}ZZ 
)ZZ 
;ZZ 
migrationBuilder\\ 
.\\ 
CreateTable\\ (
(\\( )
name]] 
:]] 
$str]] (
,]]( )
columns^^ 
:^^ 
table^^ 
=>^^ !
new^^" %
{__ 
LoginProvider`` !
=``" #
table``$ )
.``) *
Column``* 0
<``0 1
string``1 7
>``7 8
(``8 9
nullable``9 A
:``A B
false``C H
)``H I
,``I J
ProviderKeyaa 
=aa  !
tableaa" '
.aa' (
Columnaa( .
<aa. /
stringaa/ 5
>aa5 6
(aa6 7
nullableaa7 ?
:aa? @
falseaaA F
)aaF G
,aaG H
ProviderDisplayNamebb '
=bb( )
tablebb* /
.bb/ 0
Columnbb0 6
<bb6 7
stringbb7 =
>bb= >
(bb> ?
nullablebb? G
:bbG H
truebbI M
)bbM N
,bbN O
UserIdcc 
=cc 
tablecc "
.cc" #
Columncc# )
<cc) *
stringcc* 0
>cc0 1
(cc1 2
nullablecc2 :
:cc: ;
falsecc< A
)ccA B
}dd 
,dd 
constraintsee 
:ee 
tableee "
=>ee# %
{ff 
tablegg 
.gg 

PrimaryKeygg $
(gg$ %
$strgg% :
,gg: ;
xgg< =
=>gg> @
newggA D
{ggE F
xggG H
.ggH I
LoginProviderggI V
,ggV W
xggX Y
.ggY Z
ProviderKeyggZ e
}ggf g
)ggg h
;ggh i
tablehh 
.hh 

ForeignKeyhh $
(hh$ %
nameii 
:ii 
$strii F
,iiF G
columnjj 
:jj 
xjj  !
=>jj" $
xjj% &
.jj& '
UserIdjj' -
,jj- .
principalTablekk &
:kk& '
$strkk( 5
,kk5 6
principalColumnll '
:ll' (
$strll) -
,ll- .
onDeletemm  
:mm  !
ReferentialActionmm" 3
.mm3 4
Cascademm4 ;
)mm; <
;mm< =
}nn 
)nn 
;nn 
migrationBuilderpp 
.pp 
CreateTablepp (
(pp( )
nameqq 
:qq 
$strqq '
,qq' (
columnsrr 
:rr 
tablerr 
=>rr !
newrr" %
{ss 
UserIdtt 
=tt 
tablett "
.tt" #
Columntt# )
<tt) *
stringtt* 0
>tt0 1
(tt1 2
nullablett2 :
:tt: ;
falsett< A
)ttA B
,ttB C
RoleIduu 
=uu 
tableuu "
.uu" #
Columnuu# )
<uu) *
stringuu* 0
>uu0 1
(uu1 2
nullableuu2 :
:uu: ;
falseuu< A
)uuA B
}vv 
,vv 
constraintsww 
:ww 
tableww "
=>ww# %
{xx 
tableyy 
.yy 

PrimaryKeyyy $
(yy$ %
$stryy% 9
,yy9 :
xyy; <
=>yy= ?
newyy@ C
{yyD E
xyyF G
.yyG H
UserIdyyH N
,yyN O
xyyP Q
.yyQ R
RoleIdyyR X
}yyY Z
)yyZ [
;yy[ \
tablezz 
.zz 

ForeignKeyzz $
(zz$ %
name{{ 
:{{ 
$str{{ E
,{{E F
column|| 
:|| 
x||  !
=>||" $
x||% &
.||& '
RoleId||' -
,||- .
principalTable}} &
:}}& '
$str}}( 5
,}}5 6
principalColumn~~ '
:~~' (
$str~~) -
,~~- .
onDelete  
:  !
ReferentialAction" 3
.3 4
Cascade4 ;
); <
;< =
table
ÄÄ 
.
ÄÄ 

ForeignKey
ÄÄ $
(
ÄÄ$ %
name
ÅÅ 
:
ÅÅ 
$str
ÅÅ E
,
ÅÅE F
column
ÇÇ 
:
ÇÇ 
x
ÇÇ  !
=>
ÇÇ" $
x
ÇÇ% &
.
ÇÇ& '
UserId
ÇÇ' -
,
ÇÇ- .
principalTable
ÉÉ &
:
ÉÉ& '
$str
ÉÉ( 5
,
ÉÉ5 6
principalColumn
ÑÑ '
:
ÑÑ' (
$str
ÑÑ) -
,
ÑÑ- .
onDelete
ÖÖ  
:
ÖÖ  !
ReferentialAction
ÖÖ" 3
.
ÖÖ3 4
Cascade
ÖÖ4 ;
)
ÖÖ; <
;
ÖÖ< =
}
ÜÜ 
)
ÜÜ 
;
ÜÜ 
migrationBuilder
àà 
.
àà 
CreateTable
àà (
(
àà( )
name
ââ 
:
ââ 
$str
ââ (
,
ââ( )
columns
ää 
:
ää 
table
ää 
=>
ää !
new
ää" %
{
ãã 
UserId
åå 
=
åå 
table
åå "
.
åå" #
Column
åå# )
<
åå) *
string
åå* 0
>
åå0 1
(
åå1 2
nullable
åå2 :
:
åå: ;
false
åå< A
)
ååA B
,
ååB C
LoginProvider
çç !
=
çç" #
table
çç$ )
.
çç) *
Column
çç* 0
<
çç0 1
string
çç1 7
>
çç7 8
(
çç8 9
nullable
çç9 A
:
ççA B
false
ççC H
)
ççH I
,
ççI J
Name
éé 
=
éé 
table
éé  
.
éé  !
Column
éé! '
<
éé' (
string
éé( .
>
éé. /
(
éé/ 0
nullable
éé0 8
:
éé8 9
false
éé: ?
)
éé? @
,
éé@ A
Value
èè 
=
èè 
table
èè !
.
èè! "
Column
èè" (
<
èè( )
string
èè) /
>
èè/ 0
(
èè0 1
nullable
èè1 9
:
èè9 :
true
èè; ?
)
èè? @
}
êê 
,
êê 
constraints
ëë 
:
ëë 
table
ëë "
=>
ëë# %
{
íí 
table
ìì 
.
ìì 

PrimaryKey
ìì $
(
ìì$ %
$str
ìì% :
,
ìì: ;
x
ìì< =
=>
ìì> @
new
ììA D
{
ììE F
x
ììG H
.
ììH I
UserId
ììI O
,
ììO P
x
ììQ R
.
ììR S
LoginProvider
ììS `
,
ìì` a
x
ììb c
.
ììc d
Name
ììd h
}
ììi j
)
ììj k
;
ììk l
table
îî 
.
îî 

ForeignKey
îî $
(
îî$ %
name
ïï 
:
ïï 
$str
ïï F
,
ïïF G
column
ññ 
:
ññ 
x
ññ  !
=>
ññ" $
x
ññ% &
.
ññ& '
UserId
ññ' -
,
ññ- .
principalTable
óó &
:
óó& '
$str
óó( 5
,
óó5 6
principalColumn
òò '
:
òò' (
$str
òò) -
,
òò- .
onDelete
ôô  
:
ôô  !
ReferentialAction
ôô" 3
.
ôô3 4
Cascade
ôô4 ;
)
ôô; <
;
ôô< =
}
öö 
)
öö 
;
öö 
migrationBuilder
úú 
.
úú 
CreateIndex
úú (
(
úú( )
name
ùù 
:
ùù 
$str
ùù 2
,
ùù2 3
table
ûû 
:
ûû 
$str
ûû )
,
ûû) *
column
üü 
:
üü 
$str
üü  
)
üü  !
;
üü! "
migrationBuilder
°° 
.
°° 
CreateIndex
°° (
(
°°( )
name
¢¢ 
:
¢¢ 
$str
¢¢ %
,
¢¢% &
table
££ 
:
££ 
$str
££ $
,
££$ %
column
§§ 
:
§§ 
$str
§§ (
,
§§( )
unique
•• 
:
•• 
true
•• 
)
•• 
;
•• 
migrationBuilder
ßß 
.
ßß 
CreateIndex
ßß (
(
ßß( )
name
®® 
:
®® 
$str
®® 2
,
®®2 3
table
©© 
:
©© 
$str
©© )
,
©©) *
column
™™ 
:
™™ 
$str
™™  
)
™™  !
;
™™! "
migrationBuilder
¨¨ 
.
¨¨ 
CreateIndex
¨¨ (
(
¨¨( )
name
≠≠ 
:
≠≠ 
$str
≠≠ 2
,
≠≠2 3
table
ÆÆ 
:
ÆÆ 
$str
ÆÆ )
,
ÆÆ) *
column
ØØ 
:
ØØ 
$str
ØØ  
)
ØØ  !
;
ØØ! "
migrationBuilder
±± 
.
±± 
CreateIndex
±± (
(
±±( )
name
≤≤ 
:
≤≤ 
$str
≤≤ 1
,
≤≤1 2
table
≥≥ 
:
≥≥ 
$str
≥≥ (
,
≥≥( )
column
¥¥ 
:
¥¥ 
$str
¥¥  
)
¥¥  !
;
¥¥! "
migrationBuilder
∂∂ 
.
∂∂ 
CreateIndex
∂∂ (
(
∂∂( )
name
∑∑ 
:
∑∑ 
$str
∑∑ "
,
∑∑" #
table
∏∏ 
:
∏∏ 
$str
∏∏ $
,
∏∏$ %
column
ππ 
:
ππ 
$str
ππ )
)
ππ) *
;
ππ* +
migrationBuilder
ªª 
.
ªª 
CreateIndex
ªª (
(
ªª( )
name
ºº 
:
ºº 
$str
ºº %
,
ºº% &
table
ΩΩ 
:
ΩΩ 
$str
ΩΩ $
,
ΩΩ$ %
column
ææ 
:
ææ 
$str
ææ ,
,
ææ, -
unique
øø 
:
øø 
true
øø 
)
øø 
;
øø 
}
¿¿ 	
	protected
¬¬ 
override
¬¬ 
void
¬¬ 
Down
¬¬  $
(
¬¬$ %
MigrationBuilder
¬¬% 5
migrationBuilder
¬¬6 F
)
¬¬F G
{
√√ 	
migrationBuilder
ƒƒ 
.
ƒƒ 
	DropTable
ƒƒ &
(
ƒƒ& '
name
≈≈ 
:
≈≈ 
$str
≈≈ (
)
≈≈( )
;
≈≈) *
migrationBuilder
«« 
.
«« 
	DropTable
«« &
(
««& '
name
»» 
:
»» 
$str
»» (
)
»»( )
;
»») *
migrationBuilder
   
.
   
	DropTable
   &
(
  & '
name
ÀÀ 
:
ÀÀ 
$str
ÀÀ (
)
ÀÀ( )
;
ÀÀ) *
migrationBuilder
ÕÕ 
.
ÕÕ 
	DropTable
ÕÕ &
(
ÕÕ& '
name
ŒŒ 
:
ŒŒ 
$str
ŒŒ '
)
ŒŒ' (
;
ŒŒ( )
migrationBuilder
–– 
.
–– 
	DropTable
–– &
(
––& '
name
—— 
:
—— 
$str
—— (
)
——( )
;
——) *
migrationBuilder
”” 
.
”” 
	DropTable
”” &
(
””& '
name
‘‘ 
:
‘‘ 
$str
‘‘ #
)
‘‘# $
;
‘‘$ %
migrationBuilder
÷÷ 
.
÷÷ 
	DropTable
÷÷ &
(
÷÷& '
name
◊◊ 
:
◊◊ 
$str
◊◊ #
)
◊◊# $
;
◊◊$ %
}
ÿÿ 	
}
ŸŸ 
}⁄⁄ «
åD:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Migrations\20210419004756_previousnext.cs
	namespace 	
BackEndAlbergue
 
. 

Migrations $
{ 
public 

partial 
class 
previousnext %
:& '
	Migration( 1
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{		 	
migrationBuilder

 
.

 
	AddColumn

 &
<

& '
int

' *
>

* +
(

+ ,
name 
: 
$str 
, 
table 
: 
$str 
, 
nullable 
: 
true 
) 
;  
migrationBuilder 
. 
	AddColumn &
<& '
int' *
>* +
(+ ,
name 
: 
$str  
,  !
table 
: 
$str 
, 
nullable 
: 
true 
) 
;  
migrationBuilder 
. 
AlterColumn (
<( )
DateTime) 1
>1 2
(2 3
name 
: 
$str 
, 
table 
: 
$str 
,  
nullable 
: 
true 
, 

oldClrType 
: 
typeof "
(" #
DateTime# +
)+ ,
,, -
oldType 
: 
$str &
)& '
;' (
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 

DropColumn '
(' (
name 
: 
$str 
, 
table   
:   
$str   
)   
;   
migrationBuilder"" 
."" 

DropColumn"" '
(""' (
name## 
:## 
$str##  
,##  !
table$$ 
:$$ 
$str$$ 
)$$ 
;$$ 
migrationBuilder&& 
.&& 
AlterColumn&& (
<&&( )
DateTime&&) 1
>&&1 2
(&&2 3
name'' 
:'' 
$str'' 
,'' 
table(( 
:(( 
$str(( 
,((  
type)) 
:)) 
$str)) #
,))# $
nullable** 
:** 
false** 
,**  

oldClrType++ 
:++ 
typeof++ "
(++" #
DateTime++# +
)+++ ,
,++, -
oldNullable,, 
:,, 
true,, !
),,! "
;,," #
}-- 	
}.. 
}// Ê
ãD:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Migrations\20210503025800_PetShopCRUD.cs
	namespace 	
BackEndAlbergue
 
. 

Migrations $
{ 
public 

partial 
class 
PetShopCRUD $
:% &
	Migration' 0
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{		 	
migrationBuilder

 
.

 
CreateTable

 (
(

( )
name 
: 
$str 
,  
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
nullable+ 3
:3 4
false5 :
): ;
. 

Annotation #
(# $
$str$ C
,C D(
MySqlValueGenerationStrategyE a
.a b
IdentityColumnb p
)p q
,q r
ProductName 
=  !
table" '
.' (
Column( .
<. /
string/ 5
>5 6
(6 7
nullable7 ?
:? @
falseA F
)F G
,G H
Sex 
= 
table 
.  
Column  &
<& '
string' -
>- .
(. /
nullable/ 7
:7 8
true9 =
)= >
,> ?
Photo 
= 
table !
.! "
Column" (
<( )
string) /
>/ 0
(0 1
nullable1 9
:9 :
true; ?
)? @
,@ A
Category 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
nullable4 <
:< =
true> B
)B C
,C D
	SizeOfPet 
= 
table  %
.% &
Column& ,
<, -
string- 3
>3 4
(4 5
nullable5 =
:= >
true? C
)C D
,D E
Price 
= 
table !
.! "
Column" (
<( )
string) /
>/ 0
(0 1
nullable1 9
:9 :
true; ?
)? @
,@ A
Stock 
= 
table !
.! "
Column" (
<( )
int) ,
>, -
(- .
nullable. 6
:6 7
true8 <
)< =
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 1
,1 2
x3 4
=>5 7
x8 9
.9 :
Id: <
)< =
;= >
} 
) 
; 
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder   
.   
	DropTable   &
(  & '
name!! 
:!! 
$str!! 
)!!  
;!!  !
}"" 	
}## 
}$$ Í#
ãD:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Migrations\20210503155255_datetimepet.cs
	namespace 	
BackEndAlbergue
 
. 

Migrations $
{ 
public 

partial 
class 
datetimepet $
:% &
	Migration' 0
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{		 	
migrationBuilder

 
.

 
AlterColumn

 (
<

( )
DateTime

) 1
>

1 2
(

2 3
name 
: 
$str 
, 
table 
: 
$str 
, 
nullable 
: 
true 
, 

oldClrType 
: 
typeof "
(" #
int# &
)& '
,' (
oldType 
: 
$str 
, 
oldNullable 
: 
true !
)! "
;" #
migrationBuilder 
. 
AlterColumn (
<( )
string) /
>/ 0
(0 1
name 
: 
$str 
, 
table 
: 
$str 
, 
nullable 
: 
true 
, 

oldClrType 
: 
typeof "
(" #
string# )
)) *
,* +
oldType 
: 
$str 9
)9 :
;: ;
migrationBuilder 
. 
AlterColumn (
<( )
string) /
>/ 0
(0 1
name 
: 
$str #
,# $
table 
: 
$str 
, 
nullable 
: 
true 
, 

oldClrType 
: 
typeof "
(" #
string# )
)) *
,* +
oldType 
: 
$str <
,< =
oldMaxLength 
: 
$num  
,  !
oldNullable   
:   
true   !
)  ! "
;  " #
}!! 	
	protected## 
override## 
void## 
Down##  $
(##$ %
MigrationBuilder##% 5
migrationBuilder##6 F
)##F G
{$$ 	
migrationBuilder%% 
.%% 
AlterColumn%% (
<%%( )
int%%) ,
>%%, -
(%%- .
name&& 
:&& 
$str&& 
,&& 
table'' 
:'' 
$str'' 
,'' 
type(( 
:(( 
$str(( 
,(( 
nullable)) 
:)) 
true)) 
,)) 

oldClrType** 
:** 
typeof** "
(**" #
DateTime**# +
)**+ ,
,**, -
oldNullable++ 
:++ 
true++ !
)++! "
;++" #
migrationBuilder-- 
.-- 
AlterColumn-- (
<--( )
string--) /
>--/ 0
(--0 1
name.. 
:.. 
$str.. 
,.. 
table// 
:// 
$str// 
,// 
type00 
:00 
$str00 6
,006 7
nullable11 
:11 
false11 
,11  

oldClrType22 
:22 
typeof22 "
(22" #
string22# )
)22) *
,22* +
oldNullable33 
:33 
true33 !
)33! "
;33" #
migrationBuilder55 
.55 
AlterColumn55 (
<55( )
string55) /
>55/ 0
(550 1
name66 
:66 
$str66 #
,66# $
table77 
:77 
$str77 
,77 
type88 
:88 
$str88 9
,889 :
	maxLength99 
:99 
$num99 
,99 
nullable:: 
::: 
true:: 
,:: 

oldClrType;; 
:;; 
typeof;; "
(;;" #
string;;# )
);;) *
,;;* +
oldNullable<< 
:<< 
true<< !
)<<! "
;<<" #
}== 	
}>> 
}?? ¢
ÜD:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Models\Auths\CreateRoleViewModel.cs
	namespace 	
BackEndAlbergue
 
. 
Models  
.  !
Auths! &
{ 
public		 

class		 
CreateRoleViewModel		 $
{

 
[ 	
Required	 
] 
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
[ 	
Required	 
] 
public 
string 
NormalizedName $
{% &
get' *
;* +
set, /
;/ 0
}1 2
} 
} º
äD:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Models\Auths\CreateUserRoleViewModel.cs
	namespace 	
BackEndAlbergue
 
. 
Models  
.  !
Auths! &
{ 
public 

class #
CreateUserRoleViewModel (
{		 
public

 
string

 
UserId

 
{

 
get

 "
;

" #
set

$ '
;

' (
}

) *
public 
string 
RoleId 
{ 
get "
;" #
set$ '
;' (
}) *
} 
} ›
}D:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Models\Auths\LoginModel.cs
	namespace 	
BackEndAlbergue
 
. 
Models  
.  !
Auths! &
{ 
public		 

class		 

LoginModel		 
{

 
[ 	
Required	 
] 
[ 	
StringLength	 
( 
$num 
) 
] 
[ 	
EmailAddress	 
] 
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
[ 	
Required	 
] 
[ 	
StringLength	 
( 
$num 
, 
MinimumLength '
=( )
$num* +
)+ ,
], -
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} ˆ
ÑD:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Models\Auths\RegisterViewModel.cs
	namespace 	
BackEndAlbergue
 
. 
Models  
.  !
Auths! &
{ 
public		 

class		 
RegisterViewModel		 "
{

 
[ 	
Required	 
] 
[ 	
StringLength	 
( 
$num 
) 
] 
[ 	
EmailAddress	 
] 
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
[ 	
Required	 
] 
[ 	
StringLength	 
( 
$num 
, 
MinimumLength '
=( )
$num* +
)+ ,
], -
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 	
Required	 
] 
[ 	
StringLength	 
( 
$num 
, 
MinimumLength '
=( )
$num* +
)+ ,
], -
public 
string 
ConfirmPassword %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
} 
} ∂
ÜD:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Models\Auths\UserManagerResponse.cs
	namespace 	
BackEndAlbergue
 
. 
Models  
.  !
Auths! &
{ 
public 

class 
UserManagerResponse $
{		 
public

 
string

 
Message

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
public 
bool 
	IsSuccess 
{ 
get  #
;# $
set% (
;( )
}* +
public 
IEnumerable 
< 
string !
>! "
Errors# )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
public 
DateTime 
? 

ExpireDate #
{$ %
get& )
;) *
set+ .
;. /
}0 1
} 
} ÷
|D:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Models\Auths\UserModel.cs
	namespace 	
BackEndAlbergue
 
. 
Models  
.  !
Auths! &
{ 
public 

class 
	UserModel 
{		 
public

 
string

 
Id

 
{

 
get

 
;

 
set

  #
;

# $
}

% &
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
PasswordHash "
{# $
get% (
;( )
set* -
;- .
}/ 0
} 
} å

xD:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Models\NoticeModel.cs
	namespace 	
BackEndAlbergue
 
. 
Models  
{ 
public		 

class		 
NoticeModel		 
{

 
public 
int 
id 
{ 
get 
; 
set  
;  !
}" #
[ 	
Required	 
] 
public 
string 
title 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
image 
{ 
get !
;! "
set# &
;& '
}( )
[ 	
DataType	 
( 
DataType 
. 
DateTime #
)# $
]$ %
[ 	
DisplayFormat	 
( 
DataFormatString '
=( )
$str* :
): ;
]; <
public 
DateTime 
? 
date 
{ 
get  #
;# $
set% (
;( )
}* +
} 
} ä
uD:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Models\PetModel.cs
	namespace 	
BackEndAlbergue
 
. 
Models  
{ 
public		 

class		 
PetModel		 
{

 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[ 	
Required	 
] 
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
char 
? 
Sex 
{ 
get 
; 
set  #
;# $
}% &
[ 	
StringLength	 
( 
$num 
, 
MinimumLength '
=( )
$num* +
)+ ,
], -
public 
string 
Description !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 
Photo 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
Vaccines 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
bool 
? 
Sterilization "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 
Size 
{ 
get  
;  !
set" %
;% &
}' (
public 
int 
? 
age 
{ 
get 
; 
set "
;" #
}$ %
public 
bool 
? 
	IsAdopted 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
int 
? 
previous 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
null, 0
;0 1
public 
int 
? 
next 
{ 
get 
; 
set  #
;# $
}% &
=' (
null) -
;- .
} 
} ¬
}D:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Models\PetModelImpostor.cs
	namespace		 	
BackEndAlbergue		
 
.		 
Models		  
{

 
public 

class 
PetModelImpostor !
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[ 	
Required	 
] 
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
char 
? 
Sex 
{ 
get 
; 
set  #
;# $
}% &
[ 	
StringLength	 
( 
$num 
, 
MinimumLength '
=( )
$num* +
)+ ,
], -
public 
string 
Description !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 
Photo 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
Vaccines 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
bool 
? 
Sterilization "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 
Size 
{ 
get  
;  !
set" %
;% &
}' (
[ 	
DataType	 
( 
DataType 
. 
DateTime #
)# $
]$ %
[ 	
DisplayFormat	 
( 
DataFormatString '
=( )
$str* :
): ;
]; <
public 
DateTime 
? 
age 
{ 
get "
;" #
set$ '
;' (
}) *
public 
bool 
? 
	IsAdopted 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
int 
? 
previous 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
null- 1
;1 2
public 
int 
? 
next 
{ 
get 
; 
set  #
;# $
}% &
=' (
null) -
;- .
} 
} „
yD:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Models\ProductModel.cs
	namespace 	
BackEndAlbergue
 
. 
Models  
{ 
public		 

class		 
ProductModel		 
{

 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[ 	
Required	 
] 
public 
string 
ProductName !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
char 
? 
Sex 
{ 
get 
; 
set  #
;# $
}% &
public 
string 
Photo 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
Category 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
	SizeOfPet 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
Price 
{ 
get !
;! "
set# &
;& '
}( )
public 
int 
? 
Stock 
{ 
get 
;  
set! $
;$ %
}& '
} 
}  

mD:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Program.cs
	namespace

 	
BackEndAlbergue


 
{ 
public 

class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	
CreateHostBuilder 
( 
args "
)" #
.# $
Build$ )
() *
)* +
.+ ,
Run, /
(/ 0
)0 1
;1 2
} 	
public 
static 
IHostBuilder "
CreateHostBuilder# 4
(4 5
string5 ;
[; <
]< =
args> B
)B C
=>D F
Host 
.  
CreateDefaultBuilder %
(% &
args& *
)* +
. $
ConfigureWebHostDefaults )
() *

webBuilder* 4
=>5 7
{ 

webBuilder 
. 

UseStartup )
<) *
Startup* 1
>1 2
(2 3
)3 4
;4 5
} 
) 
; 
} 
} ¨	
}D:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Services\INoticeService.cs
	namespace 	
BackEndAlbergue
 
. 
Services "
{ 
public		 

	interface		 
INoticeService		 #
{

 
public 
IEnumerable 
< 
NoticeModel &
>& '

GetNotices( 2
(2 3
)3 4
;4 5
public 
NoticeModel 
	GetNotice $
($ %
int% (
noticeId) 1
)1 2
;2 3
public 
NoticeModel 
CreateNotice '
(' (
NoticeModel( 3
noticeModel4 ?
)? @
;@ A
public 
bool 
DeleteNotice  
(  !
int! $
NoticeId% -
)- .
;. /
public 
NoticeModel 
UpdateNotice '
(' (
int( +
noticeId, 4
,4 5
NoticeModel6 A
noticeModelB M
)M N
;N O
} 
} à	
{D:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Services\IPetServices.cs
	namespace 	
BackEndAlbergue
 
. 
Services "
{ 
public		 

	interface		 
IPetServices		 !
{

 
public 
IEnumerable 
< 
PetModel #
># $
GetPets% ,
(, -
)- .
;. /
public 
PetModel 
GetPet 
( 
int "
PetId# (
)( )
;) *
public 
PetModelImpostor 
	CreatePet  )
() *
PetModel* 2
petModel3 ;
); <
;< =
public 
bool 
	DeletePet 
( 
int !
PetId" '
)' (
;( )
public 
PetModelImpostor 
	UpdatePet  )
() *
int* -
PetId. 3
,3 4
PetModel5 =
petModel> F
)F G
;G H
} 
}  	
~D:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Services\IProductService.cs
	namespace 	
BackEndAlbergue
 
. 
Services "
{ 
public		 

	interface		 
IProductService		 $
{

 
public 
IEnumerable 
< 
ProductModel '
>' (
GetProducts) 4
(4 5
)5 6
;6 7
public 
ProductModel 

GetProduct &
(& '
int' *
itemPetShopId+ 8
)8 9
;9 :
public 
ProductModel 
CreateProduct )
() *
ProductModel* 6
petShopModel7 C
)C D
;D E
public 
bool 
DeleteProduct !
(! "
int" %
itemPetShopId& 3
)3 4
;4 5
public 
ProductModel 
UpdateProduct )
() *
int* -
PetShopItemId. ;
,; <
ProductModel= I
petShopModelJ V
)V W
;W X
} 
} Û
{D:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Services\IUserService.cs
	namespace 	
BackEndAlbergue
 
. 
Services "
{ 
public		 

	interface		 
IUserService		 !
{

 
Task 
< 
UserManagerResponse  
>  !
RegisterUserAsync" 3
(3 4
RegisterViewModel4 E
modelF K
)K L
;L M
Task 
< 
UserManagerResponse  
>  !
CreateRoleAsync" 1
(1 2
CreateRoleViewModel2 E
modelF K
)K L
;L M
Task 
< 
UserManagerResponse  
>  !
LoginUserAsync" 0
(0 1

LoginModel1 ;
model< A
)A B
;B C
Task 
< 
UserManagerResponse  
>  !
CreateUserRoleAsync" 5
(5 6#
CreateUserRoleViewModel6 M
modelN S
)S T
;T U
public 
IEnumerable 
< 
	UserModel $
>$ %
GetUsersAsync& 3
(3 4
)4 5
;5 6
Task 
< 
bool 
> 
UpdateUserAsync "
(" #
RegisterViewModel# 4
model5 :
): ;
;; <
} 
} ¡$
|D:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Services\NoticeService.cs
	namespace 	
BackEndAlbergue
 
. 
Services "
{ 
public 

class 
NoticeService 
:  
INoticeService! /
{ 
private 
IRefuge 
_refugeRepository )
;) *
private 
IMapper 
_mapper 
;  
public 
NoticeService 
( 
IRefuge $
refugeRepository% 5
,5 6
IMapper7 >
_mapper? F
)F G
{ 	
this 
. 
_refugeRepository "
=# $
refugeRepository% 5
;5 6
this 
. 
_mapper 
= 
_mapper "
;" #
} 	
public 
NoticeModel 
	GetNotice $
($ %
int% (
noticeId) 1
)1 2
{ 	
var 
notice 
= 
_refugeRepository *
.* +
	GetNotice+ 4
(4 5
noticeId5 =
)= >
;> ?
if 
( 
notice 
== 
null 
) 
{ 
throw 
new 
NotFoundException +
(+ ,
$", .
$str. 6
{6 7
noticeId7 ?
}? @
$str@ d
"d e
)e f
;f g
} 
return   
_mapper   
.   
Map   
<   
NoticeModel   *
>  * +
(  + ,
notice  , 2
)  2 3
;  3 4
}!! 	
public"" 
IEnumerable"" 
<"" 
NoticeModel"" &
>""& '

GetNotices""( 2
(""2 3
)""3 4
{## 	
var$$ 

entityList$$ 
=$$ 
_refugeRepository$$ .
.$$. /

GetNotices$$/ 9
($$9 :
)$$: ;
;$$; <
var%% 
	modelList%% 
=%% 
_mapper%% #
.%%# $
Map%%$ '
<%%' (
IEnumerable%%( 3
<%%3 4
NoticeModel%%4 ?
>%%? @
>%%@ A
(%%A B

entityList%%B L
)%%L M
;%%M N
return&& 
	modelList&& 
;&& 
}'' 	
public(( 
NoticeModel(( 
CreateNotice(( '
(((' (
NoticeModel((( 3
noticeModel((4 ?
)((? @
{)) 	
var++ 
entityreturned++ 
=++  
_refugeRepository++! 2
.++2 3
CreateNotice++3 ?
(++? @
_mapper++@ G
.++G H
Map++H K
<++K L
NoticeEntity++L X
>++X Y
(++Y Z
noticeModel++Z e
)++e f
)++f g
;++g h
return-- 
_mapper-- 
.-- 
Map-- 
<-- 
NoticeModel-- *
>--* +
(--+ ,
entityreturned--, :
)--: ;
;--; <
}.. 	
public// 
bool// 
DeleteNotice//  
(//  !
int//! $
noticeId//% -
)//- .
{00 	
var11 

validation11 
=11 
	GetNotice11 &
(11& '
noticeId11' /
)11/ 0
;110 1
return22 
_refugeRepository22 $
.22$ %
DeleteNotice22% 1
(221 2
noticeId222 :
)22: ;
;22; <
}33 	
public55 
NoticeModel55 
UpdateNotice55 '
(55' (
int55( +
noticeId55, 4
,554 5
NoticeModel556 A
noticeModel55B M
)55M N
{66 	
noticeModel77 
.77 
id77 
=77 
noticeId77 %
;77% &
var88 
noticeToUpdate88 
=88  
_refugeRepository88! 2
.882 3
UpdateNotice883 ?
(88? @
_mapper88@ G
.88G H
Map88H K
<88K L
NoticeEntity88L X
>88X Y
(88Y Z
noticeModel88Z e
)88e f
)88f g
;88g h
return99 
_mapper99 
.99 
Map99 
<99 
NoticeModel99 *
>99* +
(99+ ,
noticeToUpdate99, :
)99: ;
;99; <
}:: 	
};; 
}<< ív
zD:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Services\PetServices.cs
	namespace 	
BackEndAlbergue
 
. 
Services "
{ 
public 

class 
PetServices 
: 
IPetServices +
{ 
private 
IRefuge 
_refugeRepository )
;) *
private 
IMapper 
_mapper 
;  
public 
PetServices 
( 
IRefuge "
refugeRepository# 3
,3 4
IMapper5 <
_mapper= D
)D E
{ 	
this 
. 
_refugeRepository "
=# $
refugeRepository% 5
;5 6
this 
. 
_mapper 
= 
_mapper "
;" #
} 	
public 
IEnumerable 
< 
PetModel #
># $
GetPets% ,
(, -
)- .
{ 	
var 

entityList 
= 
_refugeRepository .
.. /
GetPets/ 6
(6 7
)7 8
;8 9
var 
modelListImpostor !
=" #
_mapper$ +
.+ ,
Map, /
</ 0
IEnumerable0 ;
<; <
PetModelImpostor< L
>L M
>M N
(N O

entityListO Y
)Y Z
;Z [
List 
< 
PetModel 
> 
pets 
=  !
new" %
List& *
<* +
PetModel+ 3
>3 4
(4 5
)5 6
;6 7
foreach 
( 
var 
petimpostor $
in% '
modelListImpostor( 9
)9 :
{ 
PetModel   
pet   
=   
new   "
PetModel  # +
(  + ,
)  , -
;  - .
pet!! 
.!! 
Id!! 
=!! 
petimpostor!! $
.!!$ %
Id!!% '
;!!' (
pet"" 
."" 
Name"" 
="" 
petimpostor"" &
.""& '
Name""' +
;""+ ,
pet## 
.## 
Sex## 
=## 
petimpostor## %
.##% &
Sex##& )
;##) *
pet$$ 
.$$ 
Description$$ 
=$$  !
petimpostor$$" -
.$$- .
Description$$. 9
;$$9 :
pet%% 
.%% 
Photo%% 
=%% 
petimpostor%% '
.%%' (
Photo%%( -
;%%- .
pet&& 
.&& 
Vaccines&& 
=&& 
petimpostor&& *
.&&* +
Vaccines&&+ 3
;&&3 4
pet'' 
.'' 
Sterilization'' !
=''" #
petimpostor''$ /
.''/ 0
Sterilization''0 =
;''= >
pet(( 
.(( 
Size(( 
=(( 
petimpostor(( &
.((& '
Size((' +
;((+ ,
pet)) 
.)) 
previous)) 
=)) 
petimpostor)) *
.))* +
previous))+ 3
;))3 4
pet** 
.** 
next** 
=** 
petimpostor** &
.**& '
next**' +
;**+ ,
pet++ 
.++ 
	IsAdopted++ 
=++ 
petimpostor++  +
.+++ ,
	IsAdopted++, 5
;++5 6
DateTime-- 
DateNow--  
=--! "
DateTime--# +
.--+ ,
Now--, /
;--/ 0
DateTime.. 
?.. 
dateOri.. !
=.." #
petimpostor..$ /
.../ 0
age..0 3
;..3 4
var00 

difference00 
=00  
DateNow00! (
-00) *
dateOri00+ 2
;002 3
var11 
months11 
=11 
(11 
int11 !
)11! "
(11" #
(11# $

difference11$ .
)11. /
.11/ 0
Value110 5
.115 6
	TotalDays116 ?
/11@ A
$num11B G
)11G H
;11H I
pet22 
.22 
age22 
=22 
months22  
;22  !
pets33 
.33 
Add33 
(33 
pet33 
)33 
;33 
}55 
return77 
pets77 
;77 
}88 	
public99 
PetModel99 
GetPet99 
(99 
int99 "
petId99# (
)99( )
{:: 	
var;; 
petimpostor;; 
=;; 
_refugeRepository;; /
.;;/ 0
GetPet;;0 6
(;;6 7
petId;;7 <
);;< =
;;;= >
var<< 
pet<< 
=<< 
new<< 
PetModel<< "
(<<" #
)<<# $
;<<$ %
if>> 
(>> 
petimpostor>> 
==>> 
null>> #
)>># $
{?? 
throw@@ 
new@@ 
NotFoundException@@ +
(@@+ ,
$"@@, .
$str@@. 6
{@@6 7
petId@@7 <
}@@< =
$str@@= a
"@@a b
)@@b c
;@@c d
}AA 
petBB 
.BB 
IdBB 
=BB 
petimpostorBB  
.BB  !
IdBB! #
;BB# $
petCC 
.CC 
NameCC 
=CC 
petimpostorCC "
.CC" #
NameCC# '
;CC' (
petDD 
.DD 
SexDD 
=DD 
petimpostorDD !
.DD! "
SexDD" %
;DD% &
petEE 
.EE 
DescriptionEE 
=EE 
petimpostorEE )
.EE) *
DescriptionEE* 5
;EE5 6
petFF 
.FF 
PhotoFF 
=FF 
petimpostorFF #
.FF# $
PhotoFF$ )
;FF) *
petGG 
.GG 
VaccinesGG 
=GG 
petimpostorGG &
.GG& '
VaccinesGG' /
;GG/ 0
petHH 
.HH 
SterilizationHH 
=HH 
petimpostorHH  +
.HH+ ,
SterilizationHH, 9
;HH9 :
petII 
.II 
SizeII 
=II 
petimpostorII "
.II" #
SizeII# '
;II' (
petJJ 
.JJ 
previousJJ 
=JJ 
petimpostorJJ &
.JJ& '
previousJJ' /
;JJ/ 0
petKK 
.KK 
nextKK 
=KK 
petimpostorKK "
.KK" #
nextKK# '
;KK' (
petLL 
.LL 
	IsAdoptedLL 
=LL 
petimpostorLL %
.LL% &
	IsAdoptedLL& /
;LL/ 0
DateTimeNN 
DateNowNN 
=NN 
DateTimeNN '
.NN' (
NowNN( +
;NN+ ,
DateTimeOO 
?OO 
dateOriOO 
=OO 
petimpostorOO  +
.OO+ ,
ageOO, /
;OO/ 0
varQQ 

differenceQQ 
=QQ 
DateNowQQ $
-QQ% &
dateOriQQ' .
;QQ. /
varRR 
monthsRR 
=RR 
(RR 
intRR 
)RR 
(RR 
(RR  

differenceRR  *
)RR* +
.RR+ ,
ValueRR, 1
.RR1 2
	TotalDaysRR2 ;
/RR< =
$numRR> C
)RRC D
;RRD E
petSS 
.SS 
ageSS 
=SS 
monthsSS 
;SS 
returnUU 
_mapperUU 
.UU 
MapUU 
<UU 
PetModelUU '
>UU' (
(UU( )
petUU) ,
)UU, -
;UU- .
}WW 	
publicYY 
PetModelImpostorYY 
	CreatePetYY  )
(YY) *
PetModelYY* 2
petModelYY3 ;
)YY; <
{ZZ 	
var[[ 
impostor[[ 
=[[ 
new[[ 
PetModelImpostor[[ /
([[/ 0
)[[0 1
;[[1 2
impostor]] 
.]] 
Name]] 
=]] 
petModel]] $
.]]$ %
Name]]% )
;]]) *
impostor^^ 
.^^ 
Sex^^ 
=^^ 
petModel^^ #
.^^# $
Sex^^$ '
;^^' (
impostor__ 
.__ 
Description__  
=__! "
petModel__# +
.__+ ,
Description__, 7
;__7 8
impostor`` 
.`` 
	IsAdopted`` 
=``  
petModel``! )
.``) *
	IsAdopted``* 3
;``3 4
impostoraa 
.aa 
Photoaa 
=aa 
petModelaa %
.aa% &
Photoaa& +
;aa+ ,
impostorbb 
.bb 
Vaccinesbb 
=bb 
petModelbb  (
.bb( )
Vaccinesbb) 1
;bb1 2
impostorcc 
.cc 
Sterilizationcc "
=cc# $
petModelcc% -
.cc- .
Sterilizationcc. ;
;cc; <
impostordd 
.dd 
Sizedd 
=dd 
petModeldd $
.dd$ %
Sizedd% )
;dd) *
impostoree 
.ee 
previousee 
=ee 
petModelee  (
.ee( )
previousee) 1
;ee1 2
impostorff 
.ff 
nextff 
=ff 
petModelff $
.ff$ %
nextff% )
;ff) *
varhh 
DateNowhh 
=hh 
DateTimehh "
.hh" #
Nowhh# &
;hh& '
varii 
auxAgeii 
=ii 
(ii 
intii 
)ii 
petModelii &
.ii& '
ageii' *
*ii* +
$numii+ 0
*ii0 1
-ii1 2
$numii2 3
;ii3 4
varjj 
DateModifiedjj 
=jj 
DateNowjj &
.jj& '
AddDaysjj' .
(jj. /
auxAgejj0 6
)jj6 7
;jj7 8
impostorkk 
.kk 
agekk 
=kk 
DateModifiedkk '
;kk' (
varnn 
entityreturnednn 
=nn  
_refugeRepositorynn! 2
.nn2 3
	CreatePetnn3 <
(nn< =
_mappernn= D
.nnD E
MapnnE H
<nnH I
	PetEntitynnI R
>nnR S
(nnS T
impostornnT \
)nn\ ]
)nn] ^
;nn^ _
returnpp 
_mapperpp 
.pp 
Mappp 
<pp 
PetModelImpostorpp /
>pp/ 0
(pp0 1
entityreturnedpp1 ?
)pp? @
;pp@ A
}qq 	
publicss 
boolss 
	DeletePetss 
(ss 
intss !
petIdss" '
)ss' (
{tt 	
varuu 
breedToDeleteuu 
=uu 
GetPetuu  &
(uu& '
petIduu' ,
)uu, -
;uu- .
returnvv 
_refugeRepositoryvv $
.vv$ %
	DeletePetvv% .
(vv. /
petIdvv/ 4
)vv4 5
;vv5 6
}ww 	
publicyy 
PetModelImpostoryy 
	UpdatePetyy  )
(yy) *
intyy* -
PetIdyy. 3
,yy3 4
PetModelyy5 =
petModelyy> F
)yyF G
{zz 	
var|| 
impostor|| 
=|| 
new|| 
PetModelImpostor|| /
(||/ 0
)||0 1
;||1 2
impostor}} 
.}} 
Id}} 
=}} 
PetId}} 
;}}  
impostor~~ 
.~~ 
Name~~ 
=~~ 
petModel~~ $
.~~$ %
Name~~% )
;~~) *
impostor 
. 
Sex 
= 
petModel #
.# $
Sex$ '
;' (
impostor
ÄÄ 
.
ÄÄ 
Description
ÄÄ  
=
ÄÄ! "
petModel
ÄÄ# +
.
ÄÄ+ ,
Description
ÄÄ, 7
;
ÄÄ7 8
impostor
ÅÅ 
.
ÅÅ 
	IsAdopted
ÅÅ 
=
ÅÅ  
petModel
ÅÅ! )
.
ÅÅ) *
	IsAdopted
ÅÅ* 3
;
ÅÅ3 4
impostor
ÇÇ 
.
ÇÇ 
Photo
ÇÇ 
=
ÇÇ 
petModel
ÇÇ %
.
ÇÇ% &
Photo
ÇÇ& +
;
ÇÇ+ ,
impostor
ÉÉ 
.
ÉÉ 
Vaccines
ÉÉ 
=
ÉÉ 
petModel
ÉÉ  (
.
ÉÉ( )
Vaccines
ÉÉ) 1
;
ÉÉ1 2
impostor
ÑÑ 
.
ÑÑ 
Sterilization
ÑÑ "
=
ÑÑ# $
petModel
ÑÑ% -
.
ÑÑ- .
Sterilization
ÑÑ. ;
;
ÑÑ; <
impostor
ÖÖ 
.
ÖÖ 
Size
ÖÖ 
=
ÖÖ 
petModel
ÖÖ $
.
ÖÖ$ %
Size
ÖÖ% )
;
ÖÖ) *
impostor
ÜÜ 
.
ÜÜ 
previous
ÜÜ 
=
ÜÜ 
petModel
ÜÜ  (
.
ÜÜ( )
previous
ÜÜ) 1
;
ÜÜ1 2
impostor
áá 
.
áá 
next
áá 
=
áá 
petModel
áá $
.
áá$ %
next
áá% )
;
áá) *
if
àà 
(
àà 
impostor
àà 
.
àà 
age
àà 
!=
àà 
null
àà  $
)
àà$ %
{
ââ 
var
ää 
DateNow
ää 
=
ää 
DateTime
ää &
.
ää& '
Now
ää' *
;
ää* +
var
åå 
auxAge
åå 
=
åå 
(
åå 
int
åå !
)
åå! "
petModel
åå" *
.
åå* +
age
åå+ .
*
åå/ 0
$num
åå1 6
*
åå7 8
-
åå9 :
$num
åå: ;
;
åå; <
var
çç 
DateModified
çç  
=
çç! "
DateNow
çç# *
.
çç* +
AddDays
çç+ 2
(
çç2 3
auxAge
çç3 9
)
çç9 :
;
çç: ;
impostor
éé 
.
éé 
age
éé 
=
éé 
DateModified
éé +
;
éé+ ,
}
èè 
var
êê 
petToUpdate
êê 
=
êê 
_refugeRepository
êê /
.
êê/ 0
	UpdatePet
êê0 9
(
êê9 :
_mapper
êê: A
.
êêA B
Map
êêB E
<
êêE F
	PetEntity
êêF O
>
êêO P
(
êêP Q
impostor
êêQ Y
)
êêY Z
)
êêZ [
;
êê[ \
return
ëë 
_mapper
ëë 
.
ëë 
Map
ëë 
<
ëë 
PetModelImpostor
ëë /
>
ëë/ 0
(
ëë0 1
petToUpdate
ëë1 <
)
ëë< =
;
ëë= >
}
íí 	
}
ìì 
}îî ˘%
}D:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Services\ProductService.cs
	namespace 	
BackEndAlbergue
 
. 
Services "
{ 
public 

class 
ProductService 
:  !
IProductService" 1
{ 
private 
IRefuge 
_refugeRepository )
;) *
private 
IMapper 
_mapper 
;  
private 
object 
petModel 
;  
public 
ProductService 
( 
IRefuge %
refugeRepository& 6
,6 7
IMapper8 ?
_mapper@ G
)G H
{ 	
this 
. 
_refugeRepository "
=# $
refugeRepository% 5
;5 6
this 
. 
_mapper 
= 
_mapper "
;" #
} 	
public 
IEnumerable 
< 
ProductModel '
>' (
GetProducts) 4
(4 5
)5 6
{ 	
var 

entityList 
= 
_refugeRepository .
.. /
GetProducts/ :
(: ;
); <
;< =
var 
	modelList 
= 
_mapper #
.# $
Map$ '
<' (
IEnumerable( 3
<3 4
ProductModel4 @
>@ A
>A B
(B C

entityListC M
)M N
;N O
return 
	modelList 
; 
} 	
public 
ProductModel 

GetProduct &
(& '
int' *
itemPetShopId+ 8
)8 9
{   	
var!! 
petShopItem!! 
=!! 
_refugeRepository!! .
.!!. /

GetProduct!!/ 9
(!!9 :
itemPetShopId!!: G
)!!G H
;!!H I
if## 
(## 
petShopItem## 
==## 
null## #
)### $
{$$ 
throw%% 
new%% 
NotFoundException%% +
(%%+ ,
$"%%, .
$str%%. 7
{%%7 8
itemPetShopId%%8 E
}%%E F
$str%%F y
"%%y z
)%%z {
;%%{ |
}&& 
return(( 
_mapper(( 
.(( 
Map(( 
<(( 
ProductModel(( +
>((+ ,
(((, -
petShopItem((- 8
)((8 9
;((9 :
})) 	
public** 
ProductModel** 
CreateProduct** )
(**) *
ProductModel*** 6
petShopModel**7 C
)**C D
{++ 	
var,, 
entityreturned,, 
=,,  
_refugeRepository,,! 2
.,,2 3
CreateProduct,,3 @
(,,@ A
_mapper,,A H
.,,H I
Map,,I L
<,,L M
ProductEntity,,M Z
>,,Z [
(,,[ \
petShopModel,,\ h
),,h i
),,i j
;,,j k
return.. 
_mapper.. 
... 
Map.. 
<.. 
ProductModel.. +
>..+ ,
(.., -
entityreturned..- ;
)..; <
;..< =
}// 	
public11 
bool11 
DeleteProduct11 !
(11! "
int11" %
itemPetShopId11& 3
)113 4
{22 	
var33 
itemPetShopToDelete33 #
=33$ %

GetProduct33& 0
(330 1
itemPetShopId331 >
)33> ?
;33? @
return44 
_refugeRepository44 $
.44$ %
DeleteProduct44% 2
(442 3
itemPetShopId443 @
)44@ A
;44A B
}55 	
public66 
ProductModel66 
UpdateProduct66 )
(66) *
int66* -
PetShopItemId66. ;
,66; <
ProductModel66= I
petShopModel66J V
)66V W
{77 	
petShopModel88 
.88 
Id88 
=88 
PetShopItemId88 +
;88+ ,
var99 
petShopItemToUpdate99 #
=99$ %
_refugeRepository99& 7
.997 8
UpdateProduct998 E
(99E F
_mapper99F M
.99M N
Map99N Q
<99Q R
ProductEntity99R _
>99_ `
(99` a
petShopModel99a m
)99m n
)99n o
;99o p
return:: 
_mapper:: 
.:: 
Map:: 
<:: 
ProductModel:: +
>::+ ,
(::, -
petShopItemToUpdate::- @
)::@ A
;::A B
};; 	
}<< 
}== ˝É
zD:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Services\UserService.cs
	namespace 	
BackEndAlbergue
 
. 
Services "
{ 
public 

class 
UserService 
: 
IUserService +
{ 
private 
UserManager 
< 
IdentityUser (
>( )
userManager* 5
;5 6
private 
RoleManager 
< 
IdentityRole (
>( )
roleManager* 5
;5 6
private 
IConfiguration 
configuration ,
;, -
private 
IRefuge 
_refugeRepository )
;) *
public 
UserService 
( 
IRefuge "
refugeRepository# 3
,3 4
UserManager4 ?
<? @
IdentityUser@ L
>L M
userManagerN Y
,Y Z
RoleManager[ f
<f g
IdentityRoleg s
>s t
roleManager	u Ä
,
Ä Å
IConfiguration
Ç ê
configuration
ë û
)
û ü
{ 	
this 
. 
_refugeRepository "
=# $
refugeRepository% 5
;5 6
this 
. 
userManager 
= 
userManager *
;* +
this 
. 
roleManager 
= 
roleManager *
;* +
this 
. 
configuration 
=  
configuration! .
;. /
} 	
public 
async 
Task 
< 
UserManagerResponse -
>- .
CreateRoleAsync/ >
(> ?
CreateRoleViewModel? R
modelS X
)X Y
{ 	
var 
identityRole 
= 
new "
IdentityRole# /
(/ 0
)0 1
{   
Name!! 
=!! 
model!! 
.!! 
Name!! !
,!!! "
NormalizedName"" 
=""  
model""! &
.""& '
NormalizedName""' 5
}## 
;## 
var%% 
result%% 
=%% 
await%% 
roleManager%% *
.%%* +
CreateAsync%%+ 6
(%%6 7
identityRole%%7 C
)%%C D
;%%D E
if'' 
('' 
result'' 
.'' 
	Succeeded''  
)''  !
{(( 
return)) 
new)) 
UserManagerResponse)) .
{** 
Message++ 
=++ 
$str++ :
,++: ;
	IsSuccess,, 
=,, 
true,,  $
,,,$ %
}-- 
;-- 
}.. 
return00 
new00 
UserManagerResponse00 *
{11 
Message22 
=22 
$str22 /
,22/ 0
	IsSuccess33 
=33 
false33 !
,33! "
Errors44 
=44 
result44 
.44  
Errors44  &
.44& '
Select44' -
(44- .
e44. /
=>440 2
e443 4
.444 5
Description445 @
)44@ A
}55 
;55 
}66 	
public88 
async88 
Task88 
<88 
UserManagerResponse88 -
>88- .
CreateUserRoleAsync88/ B
(88B C#
CreateUserRoleViewModel88C Z
model88[ `
)88` a
{99 	
var:: 
role:: 
=:: 
await:: 
roleManager:: (
.::( )
FindByIdAsync::) 6
(::6 7
model::7 <
.::< =
RoleId::= C
)::C D
;::D E
if;; 
(;; 
role;; 
==;; 
null;; 
);; 
{<< 
return== 
new== 
UserManagerResponse== .
{>> 
Message?? 
=?? 
$str?? 3
,??3 4
	IsSuccess@@ 
=@@ 
false@@  %
}AA 
;AA 
}BB 
varDD 
userDD 
=DD 
awaitDD 
userManagerDD (
.DD( )
FindByIdAsyncDD) 6
(DD6 7
modelDD7 <
.DD< =
UserIdDD= C
)DDC D
;DDD E
ifEE 
(EE 
roleEE 
==EE 
nullEE 
)EE 
{FF 
returnGG 
newGG 
UserManagerResponseGG .
{HH 
MessageII 
=II 
$strII 3
,II3 4
	IsSuccessJJ 
=JJ 
falseJJ  %
}KK 
;KK 
}LL 
ifNN 
(NN 
awaitNN 
userManagerNN !
.NN! "
IsInRoleAsyncNN" /
(NN/ 0
userNN0 4
,NN4 5
roleNN6 :
.NN: ;
NameNN; ?
)NN? @
)NN@ A
{OO 
returnPP 
newPP 
UserManagerResponsePP .
{QQ 
MessageRR 
=RR 
$strRR 5
,RR5 6
	IsSuccessSS 
=SS 
falseSS  %
}TT 
;TT 
}UU 
varWW 
resultWW 
=WW 
awaitWW 
userManagerWW *
.WW* +
AddToRoleAsyncWW+ 9
(WW9 :
userWW: >
,WW> ?
roleWW@ D
.WWD E
NameWWE I
)WWI J
;WWJ K
ifYY 
(YY 
resultYY 
.YY 
	SucceededYY  
)YY  !
{ZZ 
return[[ 
new[[ 
UserManagerResponse[[ .
{\\ 
Message]] 
=]] 
$str]] -
,]]- .
	IsSuccess^^ 
=^^ 
true^^  $
}__ 
;__ 
}`` 
returnbb 
newbb 
UserManagerResponsebb *
{cc 
Messagedd 
=dd 
$strdd 0
,dd0 1
	IsSuccessee 
=ee 
falseee !
}ff 
;ff 
}gg 	
publicii 
asyncii 
Taskii 
<ii 
UserManagerResponseii -
>ii- .
LoginUserAsyncii/ =
(ii= >

LoginModelii> H
modeliiI N
)iiN O
{jj 	
varkk 
userkk 
=kk 
awaitkk 
userManagerkk (
.kk( )
FindByEmailAsynckk) 9
(kk9 :
modelkk: ?
.kk? @
Emailkk@ E
)kkE F
;kkF G
ifmm 
(mm 
usermm 
==mm 
nullmm 
)mm 
{nn 
returnoo 
newoo 
UserManagerResponseoo .
{pp 
Messageqq 
=qq 
$strqq H
,qqH I
	IsSuccessrr 
=rr 
falserr  %
,rr% &
}ss 
;ss 
}tt 
varww 
resultww 
=ww 
awaitww 
userManagerww *
.ww* +
CheckPasswordAsyncww+ =
(ww= >
userww> B
,wwB C
modelwwD I
.wwI J
PasswordwwJ R
)wwR S
;wwS T
ifyy 
(yy 
!yy 
resultyy 
)yy 
returnzz 
newzz 
UserManagerResponsezz .
{{{ 
Message|| 
=|| 
$str|| 0
,||0 1
	IsSuccess}} 
=}} 
false}}  %
,}}% &
}~~ 
;~~ 
var
ÄÄ 
roles
ÄÄ 
=
ÄÄ 
await
ÄÄ 
userManager
ÄÄ )
.
ÄÄ) *
GetRolesAsync
ÄÄ* 7
(
ÄÄ7 8
user
ÄÄ8 <
)
ÄÄ< =
;
ÄÄ= >
var
ÇÇ 
claims
ÇÇ 
=
ÇÇ 
new
ÇÇ 
List
ÇÇ !
<
ÇÇ! "
Claim
ÇÇ" '
>
ÇÇ' (
(
ÇÇ( )
)
ÇÇ) *
{
ÉÉ 
new
ÑÑ 
Claim
ÑÑ 
(
ÑÑ 
$str
ÑÑ !
,
ÑÑ! "
model
ÑÑ# (
.
ÑÑ( )
Email
ÑÑ) .
)
ÑÑ. /
,
ÑÑ/ 0
new
ÖÖ 
Claim
ÖÖ 
(
ÖÖ 

ClaimTypes
ÖÖ $
.
ÖÖ$ %
NameIdentifier
ÖÖ% 3
,
ÖÖ3 4
user
ÖÖ5 9
.
ÖÖ9 :
Id
ÖÖ: <
)
ÖÖ< =
,
ÖÖ= >
}
ÜÜ 
;
ÜÜ 
foreach
àà 
(
àà 
var
àà 
role
àà 
in
àà  
roles
àà! &
)
àà& '
{
ââ 
claims
ää 
.
ää 
Add
ää 
(
ää 
new
ää 
Claim
ää $
(
ää$ %

ClaimTypes
ää% /
.
ää/ 0
Role
ää0 4
,
ää4 5
role
ää6 :
)
ää: ;
)
ää; <
;
ää< =
}
ãã 
var
éé 
key
éé 
=
éé 
new
éé "
SymmetricSecurityKey
éé .
(
éé. /
Encoding
éé/ 7
.
éé7 8
UTF8
éé8 <
.
éé< =
GetBytes
éé= E
(
ééE F
configuration
ééF S
[
ééS T
$str
ééT f
]
ééf g
)
éég h
)
ééh i
;
ééi j
var
êê 
token
êê 
=
êê 
new
êê 
JwtSecurityToken
êê ,
(
êê, -
issuer
ëë 
:
ëë 
configuration
ëë %
[
ëë% &
$str
ëë& ;
]
ëë; <
,
ëë< =
audience
íí 
:
íí 
configuration
íí '
[
íí' (
$str
íí( ?
]
íí? @
,
íí@ A
claims
ìì 
:
ìì 
claims
ìì 
,
ìì 
expires
îî 
:
îî 
DateTime
îî !
.
îî! "
Now
îî" %
.
îî% &
AddHours
îî& .
(
îî. /
$num
îî/ 0
)
îî0 1
,
îî1 2 
signingCredentials
ïï "
:
ïï" #
new
ïï$ ' 
SigningCredentials
ïï( :
(
ïï: ;
key
ïï; >
,
ïï> ? 
SecurityAlgorithms
ïï@ R
.
ïïR S

HmacSha256
ïïS ]
)
ïï] ^
)
ïï^ _
;
ïï_ `
string
óó 
tokenAsString
óó  
=
óó! "
new
óó# &%
JwtSecurityTokenHandler
óó' >
(
óó> ?
)
óó? @
.
óó@ A

WriteToken
óóA K
(
óóK L
token
óóL Q
)
óóQ R
;
óóR S
return
ôô 
new
ôô !
UserManagerResponse
ôô *
{
öö 
Message
õõ 
=
õõ 
tokenAsString
õõ '
,
õõ' (
	IsSuccess
úú 
=
úú 
true
úú  
,
úú  !

ExpireDate
ùù 
=
ùù 
token
ùù "
.
ùù" #
ValidTo
ùù# *
}
ûû 
;
ûû 
}
üü 	
public
°° 
async
°° 
Task
°° 
<
°° !
UserManagerResponse
°° -
>
°°- .
RegisterUserAsync
°°/ @
(
°°@ A
RegisterViewModel
°°A R
model
°°S X
)
°°X Y
{
¢¢ 	
if
££ 
(
££ 
model
££ 
==
££ 
null
££ 
)
££ 
{
§§ 
throw
•• 
new
•• $
NullReferenceException
•• 0
(
••0 1
$str
••1 @
)
••@ A
;
••A B
}
¶¶ 
if
®® 
(
®® 
model
®® 
.
®® 
Password
®® 
!=
®® !
model
®®" '
.
®®' (
ConfirmPassword
®®( 7
)
®®7 8
return
©© 
new
©© !
UserManagerResponse
©© .
{
™™ 
Message
´´ 
=
´´ 
$str
´´ K
,
´´K L
	IsSuccess
¨¨ 
=
¨¨ 
false
¨¨  %
,
¨¨% &
}
≠≠ 
;
≠≠ 
var
ØØ 
identityUser
ØØ 
=
ØØ 
new
ØØ "
IdentityUser
ØØ# /
{
∞∞ 
Email
±± 
=
±± 
model
±± 
.
±± 
Email
±± #
,
±±# $
UserName
≤≤ 
=
≤≤ 
model
≤≤  
.
≤≤  !
Email
≤≤! &
}
≥≥ 
;
≥≥ 
var
µµ 
result
µµ 
=
µµ 
await
µµ 
userManager
µµ *
.
µµ* +
CreateAsync
µµ+ 6
(
µµ6 7
identityUser
µµ7 C
,
µµC D
model
µµE J
.
µµJ K
Password
µµK S
)
µµS T
;
µµT U
if
∑∑ 
(
∑∑ 
result
∑∑ 
.
∑∑ 
	Succeeded
∑∑  
)
∑∑  !
{
∏∏ 
return
ππ 
new
ππ !
UserManagerResponse
ππ .
{
∫∫ 
Message
ªª 
=
ªª 
$str
ªª :
,
ªª: ;
	IsSuccess
ºº 
=
ºº 
true
ºº  $
,
ºº$ %
}
ΩΩ 
;
ΩΩ 
}
ææ 
return
¿¿ 
new
¿¿ !
UserManagerResponse
¿¿ *
{
¡¡ 
Message
¬¬ 
=
¬¬ 
$str
¬¬ /
,
¬¬/ 0
	IsSuccess
√√ 
=
√√ 
false
√√ !
,
√√! "
Errors
ƒƒ 
=
ƒƒ 
result
ƒƒ 
.
ƒƒ  
Errors
ƒƒ  &
.
ƒƒ& '
Select
ƒƒ' -
(
ƒƒ- .
e
ƒƒ. /
=>
ƒƒ0 2
e
ƒƒ3 4
.
ƒƒ4 5
Description
ƒƒ5 @
)
ƒƒ@ A
}
≈≈ 
;
≈≈ 
}
∆∆ 	
public
«« 
IEnumerable
«« 
<
«« 
	UserModel
«« $
>
««$ %
GetUsersAsync
««& 3
(
««3 4
)
««4 5
{
»» 	
return
…… 
_refugeRepository
…… %
.
……% &
GetUsers
……& .
(
……. /
)
……/ 0
;
……0 1
}
   	
public
ÀÀ 
async
ÀÀ 
Task
ÀÀ 
<
ÀÀ 
bool
ÀÀ 
>
ÀÀ 
UpdateUserAsync
ÀÀ  /
(
ÀÀ/ 0
RegisterViewModel
ÀÀ0 A
model
ÀÀB G
)
ÀÀG H
{
ÃÃ 	
if
ÕÕ 
(
ÕÕ 
model
ÕÕ 
==
ÕÕ 
null
ÕÕ 
)
ÕÕ 
{
ŒŒ 
throw
œœ 
new
œœ $
NullReferenceException
œœ 0
(
œœ0 1
$str
œœ1 @
)
œœ@ A
;
œœA B
}
–– 
if
““ 
(
““ 
model
““ 
.
““ 
Password
““ 
!=
““ !
model
““" '
.
““' (
ConfirmPassword
““( 7
)
““7 8
throw
”” 
new
”” $
NullReferenceException
”” 0
(
””0 1
$str
””1 K
)
””K L
;
””L M
var
÷÷ 
identityUser
÷÷ 
=
÷÷ 
new
÷÷ "
IdentityUser
÷÷# /
{
◊◊ 
Email
ÿÿ 
=
ÿÿ 
model
ÿÿ 
.
ÿÿ 
Email
ÿÿ #
,
ÿÿ# $
UserName
ŸŸ 
=
ŸŸ 
model
ŸŸ  
.
ŸŸ  !
Email
ŸŸ! &
}
⁄⁄ 
;
⁄⁄ 
var
€€ 
user
€€ 
=
€€ 
await
€€ 
userManager
€€ (
.
€€( )
FindByEmailAsync
€€) 9
(
€€9 :
identityUser
€€: F
.
€€F G
Email
€€G L
)
€€L M
;
€€M N
var
›› 
token
›› 
=
›› 
await
›› 
userManager
›› )
.
››) *-
GeneratePasswordResetTokenAsync
››* I
(
››I J
user
››J N
)
››N O
;
››O P
var
ﬂﬂ 
result
ﬂﬂ 
=
ﬂﬂ 
await
ﬂﬂ 
userManager
ﬂﬂ *
.
ﬂﬂ* + 
ResetPasswordAsync
ﬂﬂ+ =
(
ﬂﬂ= >
user
ﬂﬂ> B
,
ﬂﬂB C
token
ﬂﬂD I
,
ﬂﬂI J
model
ﬂﬂK P
.
ﬂﬂP Q
Password
ﬂﬂQ Y
)
ﬂﬂY Z
;
ﬂﬂZ [
if
„„ 
(
„„ 
result
„„ 
.
„„ 
	Succeeded
„„  
)
„„  !
{
‰‰ 
return
ÂÂ 
true
ÂÂ 
;
ÂÂ 
}
ÊÊ 
else
ÁÁ 
{
ËË 
throw
ÈÈ 
new
ÈÈ $
NullReferenceException
ÈÈ 0
(
ÈÈ0 1
$str
ÈÈ1 F
)
ÈÈF G
;
ÈÈG H
}
ÍÍ 
}
ÎÎ 	
}
ÏÏ 
}ÌÌ íI
mD:\2021-Semestre 2\Gestion de Calidad de Sist\Practica 1\AlbergueBack\AlbergueBack\BackEndAlbergue\Startup.cs
	namespace 	
BackEndAlbergue
 
{ 
public 

class 
Startup 
{ 
public 
Startup 
( 
IConfiguration %
configuration& 3
)3 4
{ 	
Configuration 
= 
configuration )
;) *
}   	
public"" 
IConfiguration"" 
Configuration"" +
{"", -
get"". 1
;""1 2
}""3 4
public%% 
void%% 
ConfigureServices%% %
(%%% &
IServiceCollection%%& 8
services%%9 A
)%%A B
{&& 	
services'' 
.'' 
AddControllers'' #
(''# $
)''$ %
;''% &
services(( 
.(( 
AddTransient(( !
<((! "
IPetServices((" .
,((. /
PetServices((0 ;
>((; <
(((< =
)((= >
;((> ?
services)) 
.)) 
AddTransient)) !
<))! "
INoticeService))" 0
,))0 1
NoticeService))2 ?
>))? @
())@ A
)))A B
;))B C
services** 
.** 
AddTransient** !
<**! "
IProductService**" 1
,**1 2
ProductService**3 A
>**A B
(**B C
)**C D
;**D E
services++ 
.++ 
AddSingleton++ !
<++! "
IRefuge++" )
,++) *
Refuge+++ 1
>++1 2
(++2 3
)++3 4
;++4 5
services,, 
.,, 
	AddScoped,, 
<,, 
IUserService,, +
,,,+ ,
UserService,,- 8
>,,8 9
(,,9 :
),,: ;
;,,; <
services.. 
... 
AddDbContext.. !
<..! " 
ApplicationDbContext.." 6
>..6 7
(..7 8
options..8 ?
=>..@ B
{// 
options00 
.00 
UseMySql00  
(00  !
Configuration00! .
.00. /
GetConnectionString00/ B
(00B C
$str00C S
)00S T
)00T U
;00U V
}11 
)11 
;11 
services33 
.33 
AddIdentity33  
<33  !
IdentityUser33! -
,33- .
IdentityRole33/ ;
>33; <
(33< =
options33= D
=>33E G
{33S T
options44 
.44 
Password44  
.44  !
RequireDigit44! -
=44. /
true440 4
;444 5
options55 
.55 
Password55  
.55  !
RequireLowercase55! 1
=552 3
true554 8
;558 9
}77 
)77 
.77 $
AddEntityFrameworkStores77 '
<77' ( 
ApplicationDbContext77( <
>77< =
(77= >
)77> ?
.88 $
AddDefaultTokenProviders88 %
(88% &
)88& '
;88' (
services<< 
.<< 
AddAuthentication<< &
(<<& '
auth<<' +
=><<, .
{== 
auth>> 
.>> %
DefaultAuthenticateScheme>> .
=>>/ 0
JwtBearerDefaults>>1 B
.>>B C 
AuthenticationScheme>>C W
;>>W X
auth?? 
.?? "
DefaultChallengeScheme?? +
=??, -
JwtBearerDefaults??. ?
.??? @ 
AuthenticationScheme??@ T
;??T U
}@@ 
)@@ 
.@@ 
AddJwtBearer@@ 
(@@ 
options@@ #
=>@@$ &
{AA 
optionsBB 
.BB %
TokenValidationParametersBB 1
=BB2 3
newBB4 7
	MicrosoftBB8 A
.BBA B
IdentityModelBBB O
.BBO P
TokensBBP V
.BBV W%
TokenValidationParametersBBW p
{CC 
ValidateIssuerDD "
=DD# $
trueDD% )
,DD) *
ValidateAudienceEE $
=EE% &
trueEE' +
,EE+ ,
ValidAudienceFF !
=FF" #
ConfigurationFF$ 1
[FF1 2
$strFF2 I
]FFI J
,FFJ K
ValidIssuerGG 
=GG  !
ConfigurationGG" /
[GG/ 0
$strGG0 E
]GGE F
,GGF G!
RequireExpirationTimeHH )
=HH* +
trueHH, 0
,HH0 1
IssuerSigningKeyII $
=II% &
newII' * 
SymmetricSecurityKeyII+ ?
(II? @
EncodingII@ H
.IIH I
UTF8III M
.IIM N
GetBytesIIN V
(IIV W
ConfigurationIIW d
[IId e
$strIIe w
]IIw x
)IIx y
)IIy z
,IIz {$
ValidateIssuerSigningKeyJJ ,
=JJ- .
trueJJ/ 3
}KK 
;KK 
}LL 
)LL 
;LL 
servicesOO 
.OO 
AddCorsOO 
(OO 
cOO 
=>OO !
{PP 
cQQ 
.QQ 
	AddPolicyQQ 
(QQ 
$strQQ )
,QQ) *
optionsQQ+ 2
=>QQ3 5
{QQ6 7
optionsQQ8 ?
.QQ? @
AllowAnyOriginQQ@ N
(QQN O
)QQO P
;QQP Q
optionsQQR Y
.QQY Z
AllowAnyMethodQQZ h
(QQh i
)QQi j
;QQj k
optionsQQl s
.QQs t
AllowAnyHeader	QQt Ç
(
QQÇ É
)
QQÉ Ñ
;
QQÑ Ö
}
QQÜ á
)
QQá à
;
QQà â
}RR 
)RR 
;RR 
servicesSS 
.SS 
AddAutoMapperSS "
(SS" #
typeofSS# )
(SS) *
StartupSS* 1
)SS1 2
)SS2 3
;SS3 4
servicesUU 
.UU 
AddSwaggerGenUU "
(UU" #
cUU# $
=>UU% '
{VV 
cWW 
.WW 

SwaggerDocWW 
(WW 
$strWW !
,WW! "
newWW# &
OpenApiInfoWW' 2
{WW3 4
TitleWW5 :
=WW; <
$strWW= E
,WWE F
VersionWWG N
=WWO P
$strWWQ U
}WWV W
)WWW X
;WWX Y
varYY 
xmlFileYY 
=YY 
$"YY  
{YY  !
AssemblyYY! )
.YY) * 
GetExecutingAssemblyYY* >
(YY> ?
)YY? @
.YY@ A
GetNameYYA H
(YYH I
)YYI J
.YYJ K
NameYYK O
}YYO P
$strYYP T
"YYT U
;YYU V
varZZ 
xmlPathZZ 
=ZZ 
PathZZ "
.ZZ" #
CombineZZ# *
(ZZ* +

AppContextZZ+ 5
.ZZ5 6
BaseDirectoryZZ6 C
,ZZC D
xmlFileZZE L
)ZZL M
;ZZM N
c[[ 
.[[ 
IncludeXmlComments[[ $
([[$ %
xmlPath[[% ,
)[[, -
;[[- .
}\\ 
)\\ 
;\\ 
}]] 	
public`` 
void`` 
	Configure`` 
(`` 
IApplicationBuilder`` 1
app``2 5
,``5 6
IWebHostEnvironment``7 J
env``K N
)``N O
{aa 	
ifbb 
(bb 
envbb 
.bb 
IsDevelopmentbb !
(bb! "
)bb" #
)bb# $
{cc 
appdd 
.dd %
UseDeveloperExceptionPagedd -
(dd- .
)dd. /
;dd/ 0
}ee 
appff 
.ff 
UseCorsff 
(ff 
optionsff 
=>ff  "
{ff# $
optionsff% ,
.ff, -
AllowAnyOriginff- ;
(ff; <
)ff< =
;ff= >
optionsff? F
.ffF G
AllowAnyMethodffG U
(ffU V
)ffV W
;ffW X
optionsffY `
.ff` a
AllowAnyHeaderffa o
(ffo p
)ffp q
;ffq r
}ffs t
)fft u
;ffu v
appgg 
.gg 
UseHttpsRedirectiongg #
(gg# $
)gg$ %
;gg% &
appii 
.ii 

UseRoutingii 
(ii 
)ii 
;ii 
appjj 
.jj 
UseAuthenticationjj !
(jj! "
)jj" #
;jj# $
appkk 
.kk 
UseAuthorizationkk  
(kk  !
)kk! "
;kk" #
appmm 
.mm 
UseEndpointsmm 
(mm 
	endpointsmm &
=>mm' )
{nn 
	endpointsoo 
.oo 
MapControllersoo (
(oo( )
)oo) *
;oo* +
}pp 
)pp 
;pp 
appqq 
.qq 

UseSwaggerqq 
(qq 
)qq 
;qq 
appuu 
.uu 
UseSwaggerUIuu 
(uu 
cuu 
=>uu !
{vv 
cww 
.ww 
SwaggerEndpointww !
(ww! "
$strww" <
,ww< =
$strww> I
)wwI J
;wwJ K
}xx 
)xx 
;xx 
}yy 	
}zz 
}{{ 